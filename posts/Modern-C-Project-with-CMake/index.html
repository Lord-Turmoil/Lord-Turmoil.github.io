<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Modern C++ Project With CMake | TONY'S STUDIO</title><meta name="author" content="Tony Skywalker"><meta name="copyright" content="Tony Skywalker"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#300303"><meta name="description" content="Build modern C++ project with CMake">
<meta property="og:type" content="article">
<meta property="og:title" content="Modern C++ Project With CMake">
<meta property="og:url" content="https://blog.tonys-studio.top/posts/Modern-C-Project-with-CMake/">
<meta property="og:site_name" content="TONY&#39;S STUDIO">
<meta property="og:description" content="Build modern C++ project with CMake">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/banner/mando/23/04.jpeg">
<meta property="article:published_time" content="2024-12-24T08:12:08.000Z">
<meta property="article:modified_time" content="2025-02-02T13:30:06.880Z">
<meta property="article:author" content="Tony Skywalker">
<meta property="article:tag" content="Repo Available">
<meta property="article:tag" content="C&#x2F;C++">
<meta property="article:tag" content="CMake">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/banner/mando/23/04.jpeg"><link rel="shortcut icon" href="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/favicon.svg"><link rel="canonical" href="https://blog.tonys-studio.top/posts/Modern-C-Project-with-CMake/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//www.clarity.ms"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="codeva-R6O16YoeQt"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#300303')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')
          
          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?68629f5da0a0c3347b896920fbf164b5";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
btf.addGlobalFn('pjaxComplete', () => {
  _hmt.push(['_trackPageview',window.location.pathname])
}, 'baidu_analytics')
</script><script>(function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
})(window, document, "clarity", "script", "h2swkizghx");</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":10,"unescape":false,"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":256,"languages":{"author":"Author: Tony Skywalker","link":"Link: ","source":"Source: TONY'S STUDIO","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#871798","bgDark":"#C81025","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Modern C++ Project With CMake',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><link rel="stylesheet" href="/css/custom.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-butterfly-footer-beautify@1.0.6/lib/runtime.min.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/css/barber-shop.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/back_img.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/avatar/avatar.png" onerror="onerror=null;src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/missing.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">86</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">75</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">39</div></a></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-newspaper"></i><span> Posts</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/support/"><i class="fa-fw fas fa-hand-holding-heart"></i><span> Support</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-jedi fa-beat"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/banner/mando/23/04.jpeg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/logo.svg" alt="Logo"><span class="site-name">TONY'S STUDIO</span></a><a class="nav-page-title" href="/"><span class="site-name">Modern C++ Project With CMake</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-newspaper"></i><span> Posts</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/support/"><i class="fa-fw fas fa-hand-holding-heart"></i><span> Support</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-jedi fa-beat"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Modern C++ Project With CMake</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-12-24T08:12:08.000Z" title="Created Dec. 24th, 2024 - 16:12:08 16:12:08">Dec. 24th, 2024 - 16:12:08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-02-02T13:30:06.880Z" title="Updated Feb. 2nd, 2025 - 21:30:06 21:30:06">Feb. 2nd, 2025 - 21:30:06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Software-Engineering/">Software Engineering</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Software-Engineering/Best-Practices/">Best Practices</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">3.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>22mins</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span class="waline-pageview-count" data-path="/posts/Modern-C-Project-with-CMake/"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">Comments:</span><a href="/posts/Modern-C-Project-with-CMake/#post-comment"><span class="waline-comment-count" data-path="/posts/Modern-C-Project-with-CMake/"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p style="text-align: center">
    <i>&ldquo;Wondering child, so lost, so helpless,</i><br>
    <i>Yearning for my guidance.&rdquo;</i></p>
<p style="text-align: right"><i>&mdash; The Phantom of the Opera</i></p>

<h1 id="Prologue"><a href="#Prologue" class="headerlink" title="Prologue"></a>Prologue</h1><p>As a <a target="_blank" rel="noopener" href="https://visualstudio.microsoft.com/">Visual Studio</a> user from the age of <a target="_blank" rel="noopener" href="https://news.microsoft.com/1998/06/29/microsoft-introduces-visual-c-6-0/">Visual C++ 6.0</a>, I’ve always been using <code>.sln</code> (or as old as <code>.dsw</code>) to manage my C++ projects. It works pretty well with Visual Studio, but is not portable for other toolchains. When I started to program on Linux, I have to use other tools like <a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/manual/make.html">Make</a> and <a target="_blank" rel="noopener" href="https://cmake.org/">CMake</a>.🤔</p>
<p>Unlike Make, which is the <strong>low-level</strong> build tool, CMake is a <strong>high-level</strong> cross-platform build system generator. Take a look at some popular projects on <a target="_blank" rel="noopener" href="https://github.com/">GitHub</a>, you will find that most of them are using CMake to manage their projects. And all that that implies &mdash; CMake is the de-facto standard for building C++ code.😲</p>
<blockquote>
<p>Besides CMake, you may also notice a file called conanfile.txt. It is yet another modern C++ package manager called <a target="_blank" rel="noopener" href="https://conan.io/">Conan</a>. I haven’t get used to it yet, so it is not our topic today.</p>
</blockquote>
<p>Although it’s been a while since I first came across CMake, I still find my <code>CMakeLists.txt</code> extremely messy. Then one day, I found <a target="_blank" rel="noopener" href="https://github.com/gabime/spdlog">spdlog</a>, whose <code>CMakeLists.txt</code> is laconic and straightforward. All of a sudden, the vision is clear, and now I’m writing this article to share with you the best practices of managing a modern C++ project with CMake.😎</p>
<hr>
<h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><div class="note warning flat"><p>CMake is a project management tool, it only generate the build system. So you still need to install the underlying toolchain, e.g. Make on Linux or MSBuild (the one used by Visual Studio) on Windows.</p>
</div>

<h2 id="Install-CMake"><a href="#Install-CMake" class="headerlink" title="Install CMake"></a>Install CMake</h2><p>Not much to say, just download the installer from <a target="_blank" rel="noopener" href="https://cmake.org/download/">CMake official website</a>, and follow the instructions to install it. For convenience, I’ll do it on my Windows machine. Don’t worry if you are a Linux user, the <code>cmake</code> command is available everywhere. If you also use Windows installer, make sure you check the option to add CMake to the system PATH. Otherwise, you have to add it manually. After installation, run the following command to check if CMake is installed correctly.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake --version</span><br></pre></td></tr></table></figure>

<h2 id="About-CMakeLists-txt"><a href="#About-CMakeLists-txt" class="headerlink" title="About CMakeLists.txt"></a>About <code>CMakeLists.txt</code></h2><p>This is the most important file in your CMake project. One <code>CMakeLists.txt</code> takes care of the build process of a directory. If you have a large project, you may have multiple <code>CMakeLists.txt</code> files in different directories. <code>CMakeLists.txt</code> is written in some kind of script language instead of a bunch of configuration, therefore it is super flexible and powerful.</p>
<h2 id="Workspace"><a href="#Workspace" class="headerlink" title="Workspace"></a>Workspace</h2><p>Well, I bet you do not write code with notepad. Modern IDEs like Visual Studio and CLion have built-in support for CMake, making it easier to interact with CMake. However, CMake itself is not limited to any IDE, so I recommend you use a code editor with fewer integration to go through the original CMake experience at first. Yes, I’m talking about <a target="_blank" rel="noopener" href="https://code.visualstudio.com/">Visual Studio Code</a>. However, we’re not primitives. <a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cmake-tools">CMake Tools</a> and <a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=hbenl.vscode-test-explorer">Test Explorer UI</a> are good extensions to make this process more enjoyable.</p>
<h2 id="Attached-Repository"><a href="#Attached-Repository" class="headerlink" title="Attached Repository"></a>Attached Repository</h2><p>All projects of this article is available at <a target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil/CMakeDemo">Lord-Turmoil&#x2F;CMakeDemo</a>. You can build each project separately, or all together. See <a target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil/CMakeDemo/blob/main/README.md">README.md</a> for more information.</p>
<hr>
<h1 id="Getting-Started-with-CMake"><a href="#Getting-Started-with-CMake" class="headerlink" title="Getting Started with CMake"></a>Getting Started with CMake</h1><div class="note success flat"><p>All projects in this chapter are placed under <code>chapter_1</code>.</p>
</div>

<p>In this chapter, I’ll show you the very basic set up with CMake, which should be sufficient for small projects, and large projects that do not require much configuration.</p>
<h2 id="Your-First-CMake-Project"><a href="#Your-First-CMake-Project" class="headerlink" title="Your First CMake Project"></a>Your First CMake Project</h2><div class="note success flat"><p>Project of this section is under <code>chapter_1/demo_11</code>.</p>
</div>

<p>So, let’s start with a single file project to see how CMake works. First, prepare two files in your workspace.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|-- main.cpp</span><br><span class="line">`-- CMakeLists.txt</span><br></pre></td></tr></table></figure>

<p>In <code>main.cpp</code>, write whatever you like. Or you can copy this to save some time.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Welcome to the world of CMake!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, it comes to <code>CMakeLists.txt</code>. For this simplest project, three lines are enough.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.16</span>)</span><br><span class="line"><span class="keyword">project</span>(demo_11)</span><br><span class="line"><span class="keyword">add_executable</span>(demo_11 main.cpp)</span><br></pre></td></tr></table></figure>

<p>If you use Visual Studio Code, you can get the documentation when you hover on the commands. But for the first time, I’ll list them below.</p>
<ul>
<li><code>cmake_minimum_required()</code>: Require a minimum version of CMake.</li>
<li><code>project()</code>: Sets the name of the project, and stores it in the variable <code>PROJECT_NAME</code>. When called from the top-level <code>CMakeLists.txt</code> also stores the project name in the variable <code>CMAKE_PROJECT_NAME</code>.</li>
<li><code>add_executable()</code>: Add an executable to the project using the specified source files.</li>
</ul>
<p>Now, you can see that CMake commands are quite intuitive. However, you may find some new terms like “variable”, which I’ll cover later.</p>
<h2 id="Build-with-CMake"><a href="#Build-with-CMake" class="headerlink" title="Build with CMake"></a>Build with CMake</h2><p>Now, how to build our project? If you use the CMake extension, you can easily find the “Build” button and run it with a few clicks. Command line build is also simple. When you build your project for the first time, or after you modify the <code>CMakeLists.txt</code>, you need to (re)generate the build system.</p>
<p>The complete command to do this is as follows. Basically <code>cmake</code> needs to know the source path and build path.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmake [options] &lt;path-to-source&gt;</span><br><span class="line">cmake [options] &lt;path-to-existing-build&gt;</span><br><span class="line">cmake [options] -S &lt;path-to-source&gt; -B &lt;path-to-build&gt;</span><br></pre></td></tr></table></figure>

<p>Personally, I prefer the following command. You just run it under the project directory.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmake -Bbuild</span><br><span class="line"><span class="comment"># or </span></span><br><span class="line">cmake -B build</span><br></pre></td></tr></table></figure>

<p>Or, you can specify source path instead. It does the same thing, but takes extra commands.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake ..</span><br></pre></td></tr></table></figure>

<p>Then, to actually build our project, we can run the following command under project directory.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake --build build</span><br></pre></td></tr></table></figure>

<p>After this, you can find the output executable file somewhere under <code>build</code> directory (usually <code>build/Debug</code>).</p>
<p>Since CMake itself only manages our project, it invokes related tools to build our project. For example, it may use Make on Linux and MSBuild on Windows. And if you are a curious reader, you may already found this by looking into the <code>build</code> directory. Therefore, some folks may directly use the underlying toolchain instead of <code>cmake</code> to build their project.</p>
<blockquote>
<p>A fun tip for you. If you want to speed up the build speed, you can specify compile flags after build. On Linux, CMake uses Make, so you can specify <code>-j [N]</code> to utilize your many cores. Note that Make uses infinite jobs if <code>N</code> is missing.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake --build build -- -j</span><br></pre></td></tr></table></figure>

<p>For MSBuild, you need to use <code>/m[:N]</code>. Also, you can let it choose automatically without <code>N</code>.</p>
<figure class="highlight pwsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake <span class="literal">--build</span> build <span class="literal">--</span> /m</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="Classic-Project-Structure"><a href="#Classic-Project-Structure" class="headerlink" title="Classic Project Structure"></a>Classic Project Structure</h2><div class="note success flat"><p>Project of this section is placed under <code>chapter_1/demo_12</code>.</p>
</div>

<p>I suppose no one write projects with only one file. So it’s time to consider a proper way to organize our source files and header files. A classic project structure is shown below. We put header files into <code>include</code> and source files into <code>src</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">demo_12</span><br><span class="line">|-- include</span><br><span class="line">|   `-- demo_12</span><br><span class="line">|       `-- app.h</span><br><span class="line">|-- src</span><br><span class="line">|   |-- app.cpp</span><br><span class="line">|   `-- main.cpp</span><br><span class="line">`-- CMakeLists.txt</span><br></pre></td></tr></table></figure>

<div class="note info flat"><p>When your project includes many libraries, it is likely that some header files happen to have the same name. In this case, we add an extra directory under <code>include</code> (here is <code>demo_12</code>). In this case, we will include our header file as <code>demo_12/app.h</code> so as to tell header files from different projects.</p>
</div>

<p>Now, how should we write the <code>CMakeLists.txt</code>? Only one more line of script. Note that we only need to add source files, header files will be included into source file when the compilation happens. However, you can include header files in it.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.16</span>)</span><br><span class="line"><span class="keyword">project</span>(demo_12)</span><br><span class="line"><span class="keyword">add_executable</span>(demo_12 src/main.cpp src/app.cpp)</span><br><span class="line"><span class="keyword">target_include_directories</span>(demo_12 PRIVATE <span class="keyword">include</span>)</span><br></pre></td></tr></table></figure>

<p>After we call <code>add_executable()</code>, we add a target called <code>demo_12</code>. Then we use <code>target_include_directories</code> to set the include directory of this target. Here, after the target name, we have a <code>PRIVATE</code> keyword. It means that the include directory (<code>include</code>) is private to this target, and won’t be inherited by targets that depend on it.</p>
<div class="note info flat"><p>Here our target is an executable, which apparently cannot be referenced, so it doesn’t matter whether it is <code>PRIVATE</code> or <code>PUBLIC</code>. It is usually a consideration for library project and you’ll see it later.</p>
</div>

<p>Because we’ve set the target include directory, we can use absolute include path for <code>#include</code>. Although both <code>&quot;&quot;</code> and <code>&lt;&gt;</code> are OK here, we usually use the former as it is a custom header.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;demo_12/app.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>Tada! You project looks organized now!😆</p>
<h2 id="It’s-Getting-Larger"><a href="#It’s-Getting-Larger" class="headerlink" title="It’s Getting Larger"></a>It’s Getting Larger</h2><p>Everything looks great, until there are too many source files. Adding them one by one is really tiring. So in this case, you can use the following command to automatically find source files in your project.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">file</span>(GLOB_RECURSE SRC_LIST CONFIGURE_DEPENDS <span class="string">&quot;$&#123;PROJECT_SOURCE_DIR&#125;/src/*.cpp&quot;</span>)</span><br><span class="line"><span class="keyword">add_executable</span>(demo_12 <span class="variable">$&#123;SRC_LIST&#125;</span>)</span><br></pre></td></tr></table></figure>

<p>Here, <code>SRC_LIST</code> is a custom variable, which stores all <code>.cpp</code> files under <code>$&#123;PROJECT_SOURCE_DIR&#125;</code>, which is a built-in variable as its literal meaning.</p>
<hr>
<h1 id="Use-CMake-Like-a-Pro"><a href="#Use-CMake-Like-a-Pro" class="headerlink" title="Use CMake Like a Pro"></a>Use CMake Like a Pro</h1><div class="note success flat"><p>All projects in this chapter are placed under <code>chapter_2</code>.</p>
</div>

<p>In the last chapter, we learned the basic use of CMake. And now, let’s take a step further to become “professional”.</p>
<h2 id="Your-First-CMake-Library"><a href="#Your-First-CMake-Library" class="headerlink" title="Your First CMake Library"></a>Your First CMake Library</h2><div class="note success flat"><p>Project of this section is under <code>chapter_2/demo_21</code>.</p>
</div>

<p>Not all projects are executables. Sometimes a library is a better choice to reuse our code. Or we just divide our logic into several libraries. So in section, I’ll talk about the basic structure of a library project. More specifically, static library.</p>
<p>In this project, our final target is an executable, but we depends on a library called <code>app</code>. The <code>app</code> library has both public headers and private ones. In this case, a good project structure is as follows.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">demo_21</span><br><span class="line">|-- CMakeLists.txt</span><br><span class="line">|-- lib</span><br><span class="line">|   |-- CMakeLists.txt</span><br><span class="line">|   `-- app</span><br><span class="line">|       |-- CMakeLists.txt</span><br><span class="line">|       |-- include/app</span><br><span class="line">|       |   |-- detail</span><br><span class="line">|       |   |   `-- app_public.h</span><br><span class="line">|       |   `-- app.h</span><br><span class="line">|       `-- src</span><br><span class="line">|           |-- app_private.h</span><br><span class="line">|           |-- app_private.cpp</span><br><span class="line">|           `-- app_public.cpp</span><br><span class="line">`-- src</span><br><span class="line">    `-- main.cpp</span><br></pre></td></tr></table></figure>

<p>Since all our dependencies are moved into the library, the top-level <code>include</code> directory is omitted. The <code>lib/app</code> directory is a complete CMake library project, which has its own <code>include</code> and <code>src</code>.</p>
<p>Usually, for a library, we will have an all-in-one header, so that client can get access to all functions with one include. For example, this is our <code>app.h</code>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;app/detail/app_public.h&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>Then in our <code>main.cpp</code>, we can simply write one line of <code>#include</code>. Here we use <code>&lt;&gt;</code> because we can take library as external code.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;app/app.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<div class="note info flat"><p>Usually, it is OK to make all header files public. However, if you do care about privacy, you can place private headers in <code>src</code> directory along with source files.</p>
</div>

<p>First, let’s see the <code>CMakeLists.txt</code> under <code>lib/app</code>. This time, we use <code>add_library</code> to make it a library instead of an executable. Also, we use the built-in <code>$&#123;PROJECT_NAME&#125;</code> to avoid writing <code>app</code> everywhere. Then, for the <code>target_include_directories()</code>, we set it more carefully by separating public and private headers.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span>(app)</span><br><span class="line"></span><br><span class="line"><span class="keyword">file</span>(GLOB_RECURSE SRC_LIST CONFIGURE_DEPENDS <span class="string">&quot;$&#123;PROJECT_SOURCE_DIR&#125;/src/*.cpp&quot;</span>)</span><br><span class="line"><span class="keyword">add_library</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> <span class="variable">$&#123;SRC_LIST&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_include_directories</span>(</span><br><span class="line">    <span class="variable">$&#123;PROJECT_NAME&#125;</span></span><br><span class="line">    PUBLIC <span class="variable">$&#123;CMAKE_CURRENT_LIST_DIR&#125;</span>/<span class="keyword">include</span></span><br><span class="line">    PRIVATE <span class="variable">$&#123;CMAKE_CURRENT_LIST_DIR&#125;</span>/src</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<div class="note warning flat"><p>Since library can be referenced by other projects, we can use <code>${CMAKE_CURRENT_LIST_DIR}</code> to make it always points to the path in our library. Or you can use <code>${CMAKE_CURRENT_SOURCE_DIR}</code>.</p>
</div>

<p>Then, in <code>lib/CMakeLists.txt</code>, we simply use <code>add_subdirectory</code> to include our library.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_subdirectory</span>(app)</span><br></pre></td></tr></table></figure>

<p>This is something new. By executing <code>add_subdirectory</code>, we go into that directory and run <code>CMakeLists.txt</code> there. This way, we can build large projects recursively. When there are more libraries, you can put them all here, so that we can add them all by executing <code>add_subdirectory(lib)</code>.</p>
<p>Finally, our top-level <code>CMakeLists.txt</code>, we first add <code>lib</code>, and finally link <code>app</code> to our executable. The <code>PRIVATE</code> here has the same meaning as that of <code>target_include_directories()</code>.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span>(demo_21)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Dependencies</span></span><br><span class="line"><span class="keyword">add_subdirectory</span>(lib)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Main executable</span></span><br><span class="line"><span class="keyword">add_executable</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> src/main.cpp)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Link the app library</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> PRIVATE app)</span><br></pre></td></tr></table></figure>

<p>This is how you build a project with library dependency.</p>
<h2 id="No-Source-File"><a href="#No-Source-File" class="headerlink" title="No Source File?"></a>No Source File?</h2><div class="note success flat"><p>Project of this section is placed under <code>chapter_2/demo_22</code>.</p>
</div>

<p>Sometimes, a library may only contain a bunch of header files, which is known as header-only libarary. In this case, there is no source file to be added to the target. Therefore, CMake provides a special target called <code>INTERFACE</code>. Now, we convert our library <code>app</code> in the last section into a header-only library.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">demo_22</span><br><span class="line">|-- CMakeLists.txt</span><br><span class="line">|-- lib</span><br><span class="line">|   |-- CMakeLists.txt</span><br><span class="line">|   `-- app_ho</span><br><span class="line">|       |-- CMakeLists.txt</span><br><span class="line">|       `-- include/app</span><br><span class="line">|           |-- detail</span><br><span class="line">|           |   `-- app_public.h</span><br><span class="line">|           `-- app.h</span><br><span class="line">`-- src</span><br><span class="line">    `-- main.cpp</span><br></pre></td></tr></table></figure>

<p>Except the changes in source code, only <code>app_ho/CMakeLists.txt</code> is slightly different. Now, instead of listing source files in <code>add_library()</code>, we use <code>INTERFACE</code> to indicate that it is header-only. Then, we also need to specify <code>INTERFACE</code> in <code>target_include_directories()</code>.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span>(app_ho)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> INTERFACE)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_include_directories</span>(</span><br><span class="line">    <span class="variable">$&#123;PROJECT_NAME&#125;</span> INTERFACE <span class="variable">$&#123;CMAKE_CURRENT_LIST_DIR&#125;</span>/<span class="keyword">include</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>That’s it. You can reference this library in the same way.</p>
<h2 id="Unit-Test-with-CMake"><a href="#Unit-Test-with-CMake" class="headerlink" title="Unit Test with CMake"></a>Unit Test with CMake</h2><div class="note success flat"><p>Project of this section is placed under <code>chapter_2/demo_23</code>.</p>
</div>

<p>As a final step, I’d like to talk about unit testing with CMake. You may already heard about unit testing somewhere else. It is especially useful for library projects. To add unit test to your project, first you need to add <code>enable_testing()</code> in your <strong>top-level</strong> <code>CMakeLists.txt</code>.</p>
<div class="note danger flat"><p><code>enable_testing()</code> must be placed top-level before you add the test directory. Otherwise, it will be ignored.</p>
</div>

<p>Usually, we place our unit tests under <code>tests</code>. And the complete project structure looks like this.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">fawefdemo_23</span><br><span class="line">|-- CMakeLists.txt</span><br><span class="line">|-- lib</span><br><span class="line">|   |-- CMakeLists.txt</span><br><span class="line">|   `-- add</span><br><span class="line">|       |-- CMakeLists.txt</span><br><span class="line">|       `-- include/add</span><br><span class="line">|           |-- detail</span><br><span class="line">|           |   `-- add.h</span><br><span class="line">|           `-- add.h</span><br><span class="line">|-- src</span><br><span class="line">|   `-- main.cpp</span><br><span class="line">`-- tests</span><br><span class="line">    |-- CMakeLists.txt</span><br><span class="line">    `-- add_test.cpp</span><br></pre></td></tr></table></figure>

<p>The content of <code>tests/CMakeLists.txt</code> is as follows. The unit test is in fact an executable, and we add it as a test. You can add more as you wish.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(<span class="keyword">add_test</span> <span class="keyword">add_test</span>.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(<span class="keyword">add_test</span> PRIVATE add)</span><br><span class="line"><span class="keyword">add_test</span>(NAME <span class="keyword">add_test</span> <span class="keyword">COMMAND</span> <span class="keyword">add_test</span>)</span><br></pre></td></tr></table></figure>

<p>Whether a test passes is indicated by its return value. Here, our test contains one assertion. If the assertion fails, it will return non-zero value, thus the unit test will fail.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;add/add.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">assert</span>(<span class="built_in">add</span>(<span class="number">22</span>, <span class="number">44</span>) == <span class="number">66</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Unit test is backed by <code>ctest</code>. You can run them simply with the following command.</p>
<figure class="highlight pwsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; ctest <span class="literal">--test-dir</span> build</span><br><span class="line">Test project F:/Development/Trivial/CMakeDemo/build</span><br><span class="line">    <span class="built_in">Start</span> <span class="number">1</span>: add_test</span><br><span class="line"><span class="number">1</span>/<span class="number">1</span> Test <span class="comment">#1: add_test .........................   Passed    0.01 sec</span></span><br><span class="line"></span><br><span class="line"><span class="number">100</span>% tests passed, <span class="number">0</span> tests failed out of <span class="number">1</span></span><br><span class="line"></span><br><span class="line">Total Test time (real) =   <span class="number">0.02</span> sec</span><br></pre></td></tr></table></figure>

<blockquote>
<p>If you have build type specified, you may need to pass configuration argument to <code>ctest</code>, for example:</p>
<figure class="highlight pwsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctest <span class="literal">--test-dir</span> build <span class="literal">-C</span> Debug</span><br></pre></td></tr></table></figure>
</blockquote>
<p>Or if you have Test Explorer UI extension installed, you can view test cases in the sidebar of Visual Studio Code.</p>
<p>Now, I believe you are capable of managing a nice CMake project.😉</p>
<hr>
<h1 id="CMake-Best-Practices"><a href="#CMake-Best-Practices" class="headerlink" title="CMake Best Practices"></a>CMake Best Practices</h1><div class="note success flat"><p>Project of this chapter is under <code>chapter_3</code>.</p>
</div>

<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>First of all, it is a library project with dependencies, a demo and a set of unit tests, which makes it a comprehensive example. As you’ve already learned the essential of CMake in the previous chapters, I’ll focus on more advanced topics here, showing below.</p>
<ul>
<li>Automatically version your project.</li>
<li>Using options to allow more flexible build.</li>
<li>Managing compiler flags.</li>
<li>Simplifying your <code>CMakeLists.txt</code> with loop.</li>
</ul>
<h2 id="Auto-Versioning"><a href="#Auto-Versioning" class="headerlink" title="Auto Versioning"></a>Auto Versioning</h2><p>It is a bad habit to copy code in your project, as it causes duplication, making it hard to maintain in the long run. One example is the project version. Usually, you will have a version in your code, but you have to write the same version again in the project configuration file, e.g. <code>CMakeLists.txt</code>. Fortunately, CMake is able to read files, so that you can automatically extract version from your code.</p>
<p>First, you can set the version of your project using MACROS in one of your header files. Here, I put it in <code>c3/include/version.h</code>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> C3_VERSION_MAJOR 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> C3_VERSION_MINOR 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> C3_VERSION_PATCH 0</span></span><br></pre></td></tr></table></figure>

<p>Then, in your <code>CMakeLists.txt</code>, define a function called <code>c3_extract_version</code> to extract version from our header file via regex.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>(c3_extract_version)</span><br><span class="line">    <span class="keyword">file</span>(READ <span class="string">&quot;$&#123;CMAKE_CURRENT_LIST_DIR&#125;/c3/include/version.h&quot;</span> file_contents)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">string</span>(REGEX MATCH <span class="string">&quot;C3_VERSION_MAJOR ([0-9]+)&quot;</span> _ <span class="string">&quot;$&#123;file_contents&#125;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">NOT</span> CMAKE_MATCH_COUNT <span class="keyword">EQUAL</span> <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">message</span>(FATAL_ERROR <span class="string">&quot;Could not extract major version number&quot;</span>)</span><br><span class="line">    <span class="keyword">endif</span>()</span><br><span class="line">    <span class="keyword">set</span>(major_version <span class="variable">$&#123;CMAKE_MATCH_1&#125;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">string</span>(REGEX MATCH <span class="string">&quot;C3_VERSION_MINOR ([0-9]+)&quot;</span> _ <span class="string">&quot;$&#123;file_contents&#125;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">NOT</span> CMAKE_MATCH_COUNT <span class="keyword">EQUAL</span> <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">message</span>(FATAL_ERROR <span class="string">&quot;Could not extract minor version number&quot;</span>)</span><br><span class="line">    <span class="keyword">endif</span>()</span><br><span class="line">    <span class="keyword">set</span>(minor_version <span class="variable">$&#123;CMAKE_MATCH_1&#125;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">string</span>(REGEX MATCH <span class="string">&quot;C3_VERSION_PATCH ([0-9]+)&quot;</span> _ <span class="string">&quot;$&#123;file_contents&#125;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">NOT</span> CMAKE_MATCH_COUNT <span class="keyword">EQUAL</span> <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">message</span>(FATAL_ERROR <span class="string">&quot;Could not extract patch version number&quot;</span>)</span><br><span class="line">    <span class="keyword">endif</span>()</span><br><span class="line">    <span class="keyword">set</span>(patch_version <span class="variable">$&#123;CMAKE_MATCH_1&#125;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">set</span>(C3_VERSION_MAJOR <span class="variable">$&#123;major_version&#125;</span> PARENT_SCOPE)</span><br><span class="line">    <span class="keyword">set</span>(C3_VERSION_MINOR <span class="variable">$&#123;minor_version&#125;</span> PARENT_SCOPE)</span><br><span class="line">    <span class="keyword">set</span>(C3_VERSION_PATCH <span class="variable">$&#123;patch_version&#125;</span> PARENT_SCOPE)</span><br><span class="line">    <span class="keyword">set</span>(C3_VERSION <span class="string">&quot;$&#123;major_version&#125;.$&#123;minor_version&#125;.$&#123;patch_version&#125;&quot;</span> PARENT_SCOPE)</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br></pre></td></tr></table></figure>

<p>This function is quite long, and may fill up your main <code>CMakeLists.txt</code>. So, usually we will create a <code>cmake</code> directory and store such functions to <code>utils.cmake</code>. Then, we just need to include it before we use it. Note that if sub-directories will inherit the inclusion.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(cmake/utils.cmake)</span><br></pre></td></tr></table></figure>

<h2 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h2><p>Not all targets are needed when we build a project. For example, we may only build tests under development. Or, you may want to disable assertion for some builds. In this case, you can use <code>option()</code> command.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">option</span>(C3_BUILD_TEST <span class="string">&quot;Build unit tests&quot;</span> <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">option</span>(C3_ENABLE_ASSERTION <span class="string">&quot;Enable assertion&quot;</span> <span class="keyword">OFF</span>)</span><br></pre></td></tr></table></figure>

<div class="note info flag flat"><p>To demonstrate assertion, I placed a 💣 in the source code. If you compile and run it with assertion enabled, you will see 💥.</p>
</div>

<p>We can override the choice in command line using <code>-D</code>.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake -Bbuild -DC3_BUILD_TEST=<span class="keyword">OFF</span> -DC3_ENABLE_ASSERTION=<span class="keyword">ON</span></span><br></pre></td></tr></table></figure>

<p>Then, the options can be directly used in <code>if()</code> command.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(C3_ENABLE_ASSERTION)</span><br><span class="line">    <span class="keyword">target_compile_definitions</span>(<span class="variable">$&#123;TARGET_NAME&#125;</span> PUBLIC C3_ENABLE_ASSERT)</span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">    <span class="keyword">message</span>(WARNING <span class="string">&quot;Assertion disabled for $&#123;PROJECT_NAME&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(C3_BUILD_TEST)</span><br><span class="line">    <span class="keyword">enable_testing</span>()</span><br><span class="line">    <span class="keyword">add_subdirectory</span>(tests)</span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">    <span class="keyword">message</span>(STATUS <span class="string">&quot;Skipping $&#123;PROJECT_FULLNAME&#125; unit tests&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<h2 id="Compiler-Flags"><a href="#Compiler-Flags" class="headerlink" title="Compiler Flags"></a>Compiler Flags</h2><p>To force yourself a better programming habit, you can enable more warnings for your project. Likewise, you can also turn off annoying warnings from 3rd-party dependencies. To achieve this, you can write some utility functions.</p>
<p><code>target_compile_options()</code> will add compiler flags to the given target. It is always recommended to specify target to avoid unwanted pollution. Here I have to complain about MSVC, it has incompatible flags.☹️</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Turn on warnings on the given target</span></span><br><span class="line"><span class="keyword">function</span>(c3_enable_warnings target_name)</span><br><span class="line">    <span class="keyword">get_target_property</span>(type <span class="variable">$&#123;target_name&#125;</span> TYPE)</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">NOT</span> <span class="variable">$&#123;type&#125;</span> <span class="keyword">STREQUAL</span> <span class="string">&quot;INTERFACE_LIBRARY&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(MSVC)</span><br><span class="line">            <span class="keyword">target_compile_options</span>(<span class="variable">$&#123;target_name&#125;</span> PRIVATE /W4)</span><br><span class="line">        <span class="keyword">else</span>()</span><br><span class="line">            <span class="keyword">target_compile_options</span>(<span class="variable">$&#123;target_name&#125;</span> PRIVATE -Wall -Wextra -Werror)</span><br><span class="line">        <span class="keyword">endif</span>()</span><br><span class="line">    <span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Turn off warnings on the given target </span></span><br><span class="line"><span class="keyword">function</span>(c3_disable_warnings target_name)</span><br><span class="line">    <span class="keyword">get_target_property</span>(type <span class="variable">$&#123;target_name&#125;</span> TYPE)</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">NOT</span> <span class="variable">$&#123;type&#125;</span> <span class="keyword">STREQUAL</span> <span class="string">&quot;INTERFACE_LIBRARY&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(MSVC)</span><br><span class="line">            <span class="keyword">target_compile_options</span>(<span class="variable">$&#123;target_name&#125;</span> PRIVATE /W0)</span><br><span class="line">        <span class="keyword">else</span>()</span><br><span class="line">            <span class="keyword">target_compile_options</span>(<span class="variable">$&#123;target_name&#125;</span> PRIVATE -w)</span><br><span class="line">        <span class="keyword">endif</span>()</span><br><span class="line">    <span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br></pre></td></tr></table></figure>

<div class="note warning flat"><p>Since header file will be compiled with the source files that include it, a header-only library will not invoke compilation. Therefore, we cannot set compile options for interface library.</p>
</div>

<h2 id="Final-Touch"><a href="#Final-Touch" class="headerlink" title="Final Touch"></a>Final Touch</h2><p>Now, your CMake project should look professional already.😁However, there is still some tips I’d like to share with you.</p>
<p><strong>C&#x2F;C++ standard</strong></p>
<p>You can specify desired language standard by setting the built-in variable.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>) <span class="comment"># for C++</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_C_STANDARD <span class="number">17</span>)   <span class="comment"># for C</span></span><br></pre></td></tr></table></figure>

<p><strong>Am I the Master?</strong></p>
<p>When we develop a project, usually a library, we build it as the master project. That is to say, its <code>CMakeLists.txt</code> is at the top-level. However, after it is done, it will be referenced by another project, making it a sub-project. For this, we can write a simple function to detect whether it is built as a master project or not.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># a helper variable to check if the project is built as a master project</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">NOT</span> <span class="keyword">DEFINED</span> C3_MASTER_PROJECT)</span><br><span class="line">    <span class="keyword">if</span>(CMAKE_CURRENT_SOURCE_DIR <span class="keyword">STREQUAL</span> CMAKE_SOURCE_DIR)</span><br><span class="line">        <span class="keyword">set</span>(C3_MASTER_PROJECT <span class="keyword">ON</span>)</span><br><span class="line">        <span class="keyword">message</span>(STATUS <span class="string">&quot;$&#123;PROJECT_NAME&#125; is built as the master project&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>()</span><br><span class="line">        <span class="keyword">set</span>(C3_MASTER_PROJECT <span class="keyword">OFF</span>)</span><br><span class="line">        <span class="keyword">message</span>(STATUS <span class="string">&quot;$&#123;PROJECT_NAME&#125; is built as a sub-project&quot;</span>)</span><br><span class="line">    <span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<p>Then, we can optionally enable strict warnings when built as the master project.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># enable extra warnings if build as master project</span></span><br><span class="line"><span class="keyword">if</span>(C3_MASTER_PROJECT)</span><br><span class="line">    c3_enable_warnings(<span class="variable">$&#123;TARGET_NAME&#125;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<p><strong>How’s it going?</strong></p>
<p>Can not help from wondering what CMake is doing? You can use <code>message()</code> command for logging.</p>
<hr>
<h1 id="Epilogue"><a href="#Epilogue" class="headerlink" title="Epilogue"></a>Epilogue</h1><p>Finally, it comes to an end, but there is still much to learn. For modern C++ projects, the most important part missing here is package management. CMake has <code>install()</code> and <code>find_package()</code> commands, and there are other tools like <a target="_blank" rel="noopener" href="https://conan.io/">Conan</a> and <a target="_blank" rel="noopener" href="https://vcpkg.io/">vcpkg</a> for this purpose.</p>
<p>Anyway, this article is only a beginning of your CMake journey. Good luck, and have fun! ᓚᘏᗢ</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://tonys-studio.top">Tony Skywalker</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.tonys-studio.top/posts/Modern-C-Project-with-CMake/">https://blog.tonys-studio.top/posts/Modern-C-Project-with-CMake/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Repo-Available/">Repo Available</a><a class="post-meta__tags" href="/tags/C-C/">C/C++</a><a class="post-meta__tags" href="/tags/CMake/">CMake</a></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/Into-the-Atomic-World-of-C/" title="Into the Atomic World of C++"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/banner/ahsoka/06.jpeg" onerror="onerror=null;src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/404.png'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Into the Atomic World of C++</div></div><div class="info-2"><div class="info-item-1">Understanding atomic operations in C++</div></div></div></a><a class="pagination-related" href="/posts/Understanding-TypeScript-Philosophy/" title="Understanding TypeScript Philosophy"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/banner/mando/24/10.jpeg" onerror="onerror=null;src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/404.png'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Understanding TypeScript Philosophy</div></div><div class="info-2"><div class="info-item-1">Some thoughts on TypeScript</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/Dungeon/" title="Dungeon"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/top/special/dungeon.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Jan. 4th, 2023 - 21:45:04</div><div class="info-item-2">Dungeon</div></div><div class="info-2"><div class="info-item-1">A rogue-like game developed with EasyX and FMOD in C++.</div></div></div></a><a class="pagination-related" href="/posts/Getting-Started-with-CUDA/" title="Getting Started With CUDA"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/banner/boba/01/11.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Jun. 4th, 2024 - 14:05:56</div><div class="info-item-2">Getting Started With CUDA</div></div><div class="info-2"><div class="info-item-1">Take your first step into CUDA&reg; to unleash the power of your GPU!</div></div></div></a><a class="pagination-related" href="/posts/Introduction-to-C-Game-Development/" title="Introduction to C++ Game Development"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/banner/boba/06/02.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Aug. 12th, 2023 - 11:53:56</div><div class="info-item-2">Introduction to C++ Game Development</div></div><div class="info-2"><div class="info-item-1">Get started with C++ game development using EasyX</div></div></div></a><a class="pagination-related" href="/posts/MinIoC-A-Miniature-IoC-Container-in-C/" title="MinIoC: A Miniature IoC Container in C++"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/banner/mando/01/09.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Oct. 6th, 2023 - 13:36:02</div><div class="info-item-2">MinIoC: A Miniature IoC Container in C++</div></div><div class="info-2"><div class="info-item-1">MinIoC is a lightweight IoC container for C++ 11 and later</div></div></div></a><a class="pagination-related" href="/posts/PassBash/" title="PassBash"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/top/special/pash.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Jan. 18th, 2023 - 17:18:28</div><div class="info-item-2">PassBash</div></div><div class="info-2"><div class="info-item-1">A command line password manager with TEA.</div></div></div></a><a class="pagination-related" href="/posts/AOP-in-Spring-Boot/" title="AOP in Spring Boot"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/banner/boba/07/01.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Jul. 12th, 2024 - 11:26:45</div><div class="info-item-2">AOP in Spring Boot</div></div><div class="info-2"><div class="info-item-1">Concept and application of Aspect-oriented programming in Spring Boot</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/avatar/avatar.png" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/missing.gif'" alt="avatar"/></div><div class="author-info-name">Tony Skywalker</div><div class="author-info-description">Do or do not. There is no try.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">86</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">75</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">39</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Lord-Turmoil" target="_blank" title="Github"><i class="fa-brands fa-github"></i></a><a class="social-icon" href="mailto:swift-phantom@outlook.com" target="_blank" title="Email"><i class="fa-solid fa-envelope"></i></a><a class="social-icon" href="https://youda.pro/578925" target="_blank" title="ChatBox"><i class="fa-solid fa-comments"></i></a><a class="social-icon" href="https://space.bilibili.com/2030942344" target="_blank" title="BiliBili"><i class="fa-brands fa-bilibili"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">It won't be long before the armies of the Republic track us here.<br>You can visit this site at both:<li><a href="http://blog.tonys-studio.top/" target="_blank">Main Site</a></li><li><a href="https://lord-turmoil.github.io/" target="_blank">Github Mirror Site</a></li></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Prologue"><span class="toc-text">Prologue</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Preparation"><span class="toc-text">Preparation</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Install-CMake"><span class="toc-text">Install CMake</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#About-CMakeLists-txt"><span class="toc-text">About CMakeLists.txt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Workspace"><span class="toc-text">Workspace</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Attached-Repository"><span class="toc-text">Attached Repository</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Getting-Started-with-CMake"><span class="toc-text">Getting Started with CMake</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Your-First-CMake-Project"><span class="toc-text">Your First CMake Project</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Build-with-CMake"><span class="toc-text">Build with CMake</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Classic-Project-Structure"><span class="toc-text">Classic Project Structure</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#It%E2%80%99s-Getting-Larger"><span class="toc-text">It’s Getting Larger</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Use-CMake-Like-a-Pro"><span class="toc-text">Use CMake Like a Pro</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Your-First-CMake-Library"><span class="toc-text">Your First CMake Library</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#No-Source-File"><span class="toc-text">No Source File?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Unit-Test-with-CMake"><span class="toc-text">Unit Test with CMake</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CMake-Best-Practices"><span class="toc-text">CMake Best Practices</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Overview"><span class="toc-text">Overview</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Auto-Versioning"><span class="toc-text">Auto Versioning</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Options"><span class="toc-text">Options</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Compiler-Flags"><span class="toc-text">Compiler Flags</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Final-Touch"><span class="toc-text">Final Touch</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Epilogue"><span class="toc-text">Epilogue</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/Setup-Modern-TypeScript-Project/" title="Setup Modern TypeScript Project"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/banner/mando/22/12.jpeg" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/404.png'" alt="Setup Modern TypeScript Project"/></a><div class="content"><a class="title" href="/posts/Setup-Modern-TypeScript-Project/" title="Setup Modern TypeScript Project">Setup Modern TypeScript Project</a><time datetime="2025-01-10T07:18:43.000Z" title="Created Jan. 10th, 2025 - 15:18:43 15:18:43">Jan. 10th, 2025 - 15:18:43</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Scam-From-Your-Own-Email-Address/" title="Scam From Your Own Email Address"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/top/special/scam.png" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/404.png'" alt="Scam From Your Own Email Address"/></a><div class="content"><a class="title" href="/posts/Scam-From-Your-Own-Email-Address/" title="Scam From Your Own Email Address">Scam From Your Own Email Address</a><time datetime="2025-01-08T15:29:32.000Z" title="Created Jan. 8th, 2025 - 23:29:32 23:29:32">Jan. 8th, 2025 - 23:29:32</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Understanding-TypeScript-Philosophy/" title="Understanding TypeScript Philosophy"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/banner/mando/24/10.jpeg" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/404.png'" alt="Understanding TypeScript Philosophy"/></a><div class="content"><a class="title" href="/posts/Understanding-TypeScript-Philosophy/" title="Understanding TypeScript Philosophy">Understanding TypeScript Philosophy</a><time datetime="2025-01-04T05:58:47.000Z" title="Created Jan. 4th, 2025 - 13:58:47 13:58:47">Jan. 4th, 2025 - 13:58:47</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Modern-C-Project-with-CMake/" title="Modern C++ Project With CMake"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/banner/mando/23/04.jpeg" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/404.png'" alt="Modern C++ Project With CMake"/></a><div class="content"><a class="title" href="/posts/Modern-C-Project-with-CMake/" title="Modern C++ Project With CMake">Modern C++ Project With CMake</a><time datetime="2024-12-24T08:12:08.000Z" title="Created Dec. 24th, 2024 - 16:12:08 16:12:08">Dec. 24th, 2024 - 16:12:08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Into-the-Atomic-World-of-C/" title="Into the Atomic World of C++"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/banner/ahsoka/06.jpeg" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/404.png'" alt="Into the Atomic World of C++"/></a><div class="content"><a class="title" href="/posts/Into-the-Atomic-World-of-C/" title="Into the Atomic World of C++">Into the Atomic World of C++</a><time datetime="2024-11-27T16:17:55.000Z" title="Created Nov. 28th, 2024 - 00:17:55 00:17:55">Nov. 28th, 2024 - 00:17:55</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/img/banner/mando/23/04.jpeg);"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By Tony Skywalker</div><div class="footer_custom_text">No bird soars too high if he soars on his own wings</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'forest'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  let initFn = window.walineFn || null
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const destroyWaline = ele => ele.destroy()

  const initWaline = (Fn, el = document, path = window.location.pathname) => {
    const waline = Fn({
      el: el.querySelector('#waline-wrap'),
      serverURL: 'https://comment.tonys-studio.top',
      pageview: true,
      dark: 'html[data-theme="dark"]',
      comment: true,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    if (isShuoshuo) {
      window.shuoshuoComment.destroyWaline = () => {
        destroyWaline(waline)
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const loadWaline = (el, path) => {
    if (initFn) initWaline(initFn, el, path)
    else {
      btf.getCSS('https://cdn.jsdelivr.net/npm/@waline/client@2/dist/waline.min.css')
        .then(() => import('https://cdn.jsdelivr.net/npm/@waline/client@2/dist/waline.min.js'))
        .then(({ init }) => {
          initFn = init || Waline.init
          initWaline(initFn, el, path)
          window.walineFn = initFn
        })
    }
  }

  if (isShuoshuo) {
    'Waline' === 'Waline'
      ? window.shuoshuoComment = { loadComment: loadWaline } 
      : window.loadOtherComment = loadWaline
    return
  }

  if ('Waline' === 'Waline' || !false) {
    if (false) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script></div><script src="/js/custom.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Anything you would like to search?🔍" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="Framework Hexo" title=""><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="Theme Butterfly" title=""><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="All articles in this blog are licensed under CC BY-NC-SA 4.0 unless stating additionally." title=""><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a><a class="github-badge" target="_blank" href="https://beian.miit.gov.cn/" style="margin-inline:5px" data-title="本站已在京进行备案" title=""><img src="https://img.shields.io/badge/京ICP备-2024050963号-green?style=flat" alt=""/></a><a class="github-badge" target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=14080202000495" style="margin-inline:5px" data-title="本站已在晋公网安进行备案" title=""><img src="https://img.shields.io/badge/晋公网安备-14080202000495号-e1d492?style=flat&amp;logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAdCAYAAAC9pNwMAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+nhxg7wAACNlJREFUSInF1mmMVeUdx/Hv2e+5+519mJWBYQZkGxZZxLKJqBXGoLS1iXWrmihotFXaJiTWWlsbl6q1aetWd5u0VkKjNG4YEJSlOCibDLMwM8x679z9nnPP1jcVJUxf+7z6J8+LT37/Z4VvaQhfFS8+sBXbctCDGrVTKlBUH4mxAbI9Hfj0IJLsp6paJ5/tmn20N/D0wKDRMq9F/c3M2U1/V0vDfWMFh+tv/Ig1zYPMabDImPJ52OaXO87W580KggCiiOsJOJ6I3wcNFaaeNKxrt72f2fLGu4FpJ/sDQABRzD22fH7/Yze069vGc6mrDLNIJCDik10sxz2by3VdPM87xzkP9jwPTZFRVI1YUJKH+oy7n3tbvv/P2wW/UQxRWe6w4ZJRptYLHDoCuz8v5cP92XbI762O+h6UVWHnUFbPpU0fEb2A60mMJ7MUi9b/b7UgKhiZMaIxm8YLplLMDPz8hl/EH+rs8TNlUpFf32uyZJGLPDwCiTGUyTWodTN49eUCdz2YwXb9NNcObp1X98WDoufynzMVCEKGn27ayPTWBi5ad8P5iQUkJEnFLjqM9Z+hrVX0vfDe6K2dPRWsW2bwyp9EUifSJB84gdxrkR0eRgv1o/3I4fbbprJ6scqamzVO9pffec1S5ZWY2Nfz5qEy/FqOC2Y3s3j53HMSi18VRjFPwSwg+1RfVbl115vvJrsfej7UGIsYPPGgQ7JXoO+Xx5B3dHEomyJ9x1qiQozkr95h5937aFnVyouPlgJK+Ss7Fxz64OTSxSX+LHYxT2IsRW5kbGI4oHcR0jqoqTjV9se3I7/f8rS/ClS23GxSXhph6L5d9Akm7qqZhHWBQGUJ+CWGFzcg7e7m6D3/ZuW1Ea5YKdA3EojuONi813TqNi+YPYOKUhXDtCeGL26/hakLLiEcdsaHRkRAoLRc4fJrmhnekyF0apgZowWSwwkaa+rw3f8WA1GZZsPP5JEChX8dhZTN6iU6kAcs5s+dHd183SJ0VVKL57pfw6YdRQw23aeWTns47DPTALWlRTR7kMLew6hGgYqUhWXYFFUdPZ6lUBahLA8hVcOftckfi7No7VRAAQqsX1dybfvG1qwriM9mM5mJ4e4jO5Cc01dPqixbr8tWGBQUL4vjGigEEShi+xUmZ2RiR/sJ1pbS8NkgZrKAGw0TsgQsQyFaF/nfYTGprAlMFysbA1pI3mhkR6snhGsaymYGvPyFEb9IdbUE2AzFFTwpRqCtBY0wmdER+hZW4j63gcJj38V+/ErSUZXsYBfjIZHIRW0c2Z8BskCAqN+CbBJBFnyyKjR+Ez57nBxLqpfMUeSISElMBFz6x2Q6OxzWrYjyxWVzEewioU3LCS5vQY6nMUrLwNaxXvoQ59IloFSx54PPAZtQLExVZZDxsVE8J4dn6v4JYatgbSjk0owPw7RGH2ADMo88Z7L20ip8f7gC7fAo0q4+0rt7kEQDvaghVZbiPHUHcyeXcfLjT3jmpR7AYsnSScya3UR8bARVMck7Y/cB75/X6rDf3Fg2dw2jKZm5dXGm1LuAzO5DCo9v6aT0ibco5kzOvLOP+NGTFJtDpPYeZKijk/Rn3QxsfZV7txwhX7ABiZUXBsGvIvguQApNQQva9RMmTvZ2dpVUls+tX/UD7GN/Y8Ws05w6rQF+9vyzg1vZjbvMRJhXiRSU8DpTFFe0QE8S6SfPkOkZoktrB2oAhZWrwljxOPmchiSMYOWNoxNuruFU5vWeXdsojiUon345113dBBQBmTYlTimgdB8nfPo4WjaNFgN9OMEkJ02dnadVt5ki54Esqy+bzKJltVhSPbI3iN2zCyMTeXNCuG7Omm2Zok7PR2+R7jvD8ouruHhmCrB5jVZeYxLdrTP4sr4Vtd9g4MA4qc4c+6cu5NPamfw4P59t2WrA4YdXKkASf7SFivo6PDdEPmf1fRM++zp1bH/0r4I1dD1ODtOWaW4IsvPjL7nqXhloQiSPwjjgMYkMASyGEBkjhISCQwkwzve/18AbT+pk8pVY4UacQi9y+gyZ0eRAw4qHa89LXEx1LXMSPfhDJYRb59BtlLKg2WPT2l6qYl1svtGkrLYckyA1S+t5+2ATm37WCui0LSynsckDNH5zTxAchbQtkx08hDHYiW6NgC0enHBzEZ102UDH8QORdEckjEzZrNWkRydzyx17uGnDXqbUnGZ6dRPjSY91q2TqwjFuvTxLo5Zn5Qo/pumRSFcTLQtybEhGE0fQrDhhJ0VvH2lTnnHPhGtsmWan469apERjI2MH3qN7+7MEfH6ql29CbV7PvsMG32k6yU2XDhEKyZw66eJaRdrXR7CzCcqUNC3zwgymPJRCH4KRRLINimpL14A5Y4GDeOqbsPRVcfuN7Xj44pav/hFfrNT2kr2rsqf2Ibp5pEA14ZIImUyW3t5REkkTXRGQ/DGGhtLginhqCWknQDE5hKf5UFSF9Lj020Q2ul5V1AR2hr+8vuP8Vlc2zMPRxoSjnx7XBC14sDoydahSGq7KdO/HFyrBchxCVfX4fDKp4T7SCQejYODZLrYgIqgKFsNIgQqEYob8mW6yiUyb7Z64LVK/+B85xznnJ3AWzqTzuIX46mr5wLs+UUTyIriBCjRNxguHMJIFDLEEvXEOVRWnSJ0+jCd4CJoGjoedM1CLcXQziW3nMV2TSMBeOx7vWZvPt1r+cMPzE8KunaUkFn0vNrvtqXj34c1W6gzxlEQ6naIoBahtnkMwoFMwIVzSRNguMt53Aj2s4nkSlgPoGqLkICsRNF0gl8rYWuP8+11/w/OOJDEhHPKLCIpOXmi+M9AgP+maiesLifF2T1Rn5ZNj5Lo/Qc/GcPMmhdoqlEgIGzCK4PiCmJKK68p4KfF3qYGuF0qCRUkJTzleUbvQyWRTuE5xYthxQbBs7EISAbkzUFG3VfXXbK2YFi3X/eryfKKnqVBItNjJxDzH8erddC4SqWwcN5WyTtlyO1RP/Lh3eHD76MB40swmiDVJyDLYRhpc5+ub6tse/wWKbvSQEAw1awAAAABJRU5ErkJggg==" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><!-- hexo injector body_end end --></body></html>