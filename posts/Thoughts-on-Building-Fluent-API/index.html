<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Thoughts on Building Fluent API | TONY'S STUDIO</title><meta name="author" content="Tony Lewis"><meta name="copyright" content="Tony Lewis"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#300303"><meta name="description" content="Getting started with your own Fluent API"><meta property="og:type" content="article"><meta property="og:title" content="Thoughts on Building Fluent API"><meta property="og:url" content="https://blog.tonys-studio.top/posts/Thoughts-on-Building-Fluent-API/"><meta property="og:site_name" content="TONY&#39;S STUDIO"><meta property="og:description" content="Getting started with your own Fluent API"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/07/14.jpeg"><meta property="article:published_time" content="2024-04-01T07:22:25.000Z"><meta property="article:modified_time" content="2025-10-01T05:43:42.934Z"><meta property="article:author" content="Tony Lewis"><meta property="article:tag" content="Repo Available"><meta property="article:tag" content="C#"><meta property="article:tag" content="Fluent API"><meta property="article:tag" content="Design"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/07/14.jpeg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Thoughts on Building Fluent API",
  "url": "https://blog.tonys-studio.top/posts/Thoughts-on-Building-Fluent-API/",
  "image": "https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/07/14.jpeg",
  "datePublished": "2024-04-01T07:22:25.000Z",
  "dateModified": "2025-10-01T05:43:42.934Z",
  "author": [
    {
      "@type": "Person",
      "name": "Tony Lewis",
      "url": "https://www.tonys-studio.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/favicon.svg"><link rel="canonical" href="https://blog.tonys-studio.top/posts/Thoughts-on-Building-Fluent-API/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//www.clarity.ms"><meta name="baidu-site-verification" content="codeva-R6O16YoeQt"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>(()=>{const t={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:t,getScript:(e,t={})=>new Promise((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),getCSS:(e,t)=>new Promise((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),addGlobalFn:(e,t,o=!1,a=window)=>{if(e.startsWith("pjax"))return;const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const o=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#300303")},a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","undefined")};btf.activateDarkMode=o,btf.activateLightMode=a;const n=t.get("theme"),r=window.matchMedia("(prefers-color-scheme: dark)"),c=window.matchMedia("(prefers-color-scheme: light)");if(void 0===n){if(c.matches)a();else if(r.matches)o();else{const e=(new Date).getHours();e<=6||e>=18?o():a()}r.addEventListener("change",()=>{void 0===t.get("theme")&&(e.matches?o():a())})}else"light"===n?a():o();const d=t.get("aside-status");void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script>var _hmt=_hmt||[];!function(){var t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?68629f5da0a0c3347b896920fbf164b5";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(t,a)}(),btf.addGlobalFn("pjaxComplete",()=>{_hmt.push(["_trackPageview",window.location.pathname])},"baidu_analytics")</script><script>!function(t,e,n,c,r,s,a){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(s=e.createElement(c)).async=1,s.src="https://www.clarity.ms/tag/sthrplbt7c",(a=e.getElementsByTagName(c)[0]).parentNode.insertBefore(s,a)}(window,document,"clarity","script")</script><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,top_n_per_article:3,unescape:!1,pagination:{enable:!0,hitsPerPage:8},languages:{hits_empty:"No results found for: ${query}",hits_stats:"${hits} articles found"}},translate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:300,highlightFullpage:!1,highlightMacStyle:!1},copy:{success:"Copy Successful",error:"Copy Failed",noSupport:"Browser Not Supported"},relativeDate:{homepage:!1,post:!1},runtime:"days",dateSuffix:{just:"Just now",min:"minutes ago",hour:"hours ago",day:"days ago",month:"months ago"},copyright:{limitCount:256,languages:{author:"Author: Tony Lewis",link:"Link: ",source:"Source: TONY'S STUDIO",info:"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},lightbox:"fancybox",Snackbar:{chs_to_cht:"You have switched to Traditional Chinese",cht_to_chs:"You have switched to Simplified Chinese",day_to_night:"You have switched to Dark Mode",night_to_day:"You have switched to Light Mode",bgLight:"#871798",bgDark:"#C81025",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js",buttonText:"Load More"},isPhotoFigcaption:!1,islazyloadPlugin:!1,isAnchor:!1,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Thoughts on Building Fluent API",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><link rel="stylesheet" href="/static/custom.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-butterfly-footer-beautify@1.0.6/lib/runtime.min.css" media="print" onload='this.media="all"'><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.paceOptions={restartOnPushState:!1},btf.addGlobalFn("pjaxSend",()=>{Pace.restart()},"pace_restart")</script><link rel="stylesheet" href="/static/barber-shop.css"><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image:url(https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/background.png)"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/avatar.png" onerror='this.onerror=null,this.src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/missing.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">95</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">86</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">40</div></a></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-newspaper"></i><span> Posts</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-jedi fa-beat"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/07/14.jpeg)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/logo.svg" alt="Logo"><span class="site-name">TONY'S STUDIO</span></a><a class="nav-page-title" href="/"><span class="site-name">Thoughts on Building Fluent API</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span> Back to Home</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-newspaper"></i><span> Posts</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-jedi fa-beat"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Thoughts on Building Fluent API</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-04-01T07:22:25.000Z" title="Created Apr. 1st, 2024 - 15:22:25 15:22:25">Apr. 1st, 2024 - 15:22:25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-10-01T05:43:42.934Z" title="Updated Oct. 1st, 2025 - 13:43:42 13:43:42">Oct. 1st, 2025 - 13:43:42</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Software-Engineering/">Software Engineering</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Software-Engineering/Design-Patterns/">Design Patterns</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>12mins</span></span><span class="post-meta-separator">|</span><span data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span class="waline-pageview-count" data-path="/posts/Thoughts-on-Building-Fluent-API/"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">Comments:</span><a href="/posts/Thoughts-on-Building-Fluent-API/#post-comment"><span class="waline-comment-count" data-path="/posts/Thoughts-on-Building-Fluent-API/"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p style="text-align:center"><i>&ldquo;Who was that shape in the shadows?<br><i>Whose is the face in the mask?&rdquo;</i></i></p><p style="text-align:right;font-family:var(--font-phantom)">&mdash; THE PHANTOM OF THE OPERA</p><div class="note primary flat"><p>The original idea comes from here: <a target="_blank" rel="noopener" href="https://mitesh1612.github.io/blog/2021/08/11/how-to-design-fluent-api">How to Create a Fluent API in C#</a>. Thanks for the inspiration! 😄</p></div><h1 id="Prologue"><a href="#Prologue" class="headerlink" title="Prologue"></a>Prologue</h1><p>As a developer, you may already heard of the concept of <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Fluent_interface">Fluent API</a>. No? Let me show you some examples.</p><p>As a C# developer, you must be familiar with <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/dotnet/csharp/linq/">LINQ</a>. It is really an elegant way of filtering data.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">OrdersList.Where(o =&gt; o.Amount &gt; <span class="number">1000</span> &amp;&amp; o.Date &gt;= DateTime.Now.AddDays(<span class="number">-5</span>))</span><br><span class="line">    .OrderBy(o =&gt; o.Amount)</span><br><span class="line">    .Take(<span class="number">10</span>)</span><br><span class="line">    .Select(o =&gt; o.Customer)</span><br><span class="line">    .ToList();</span><br></pre></td></tr></table></figure><p>Or, if you’re a Java player, you may use Stream API like this.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cars.stream().filter(car -&gt; car.kilometers &lt; <span class="number">50000</span>)</span><br><span class="line">    .collect(Collectors.toList())</span><br></pre></td></tr></table></figure><p>Fluent API not only provide seamless programming experience, but also friendly for code suggestion or completion, as users can see and only see the available methods they can use.</p><p><img src="/posts/Thoughts-on-Building-Fluent-API/Intellisence.png" alt="Intellisence"></p><p>Fluent API works just, fluently. So how to create a Fluent API of your own? 🤔</p><p>In this post, I’m going to show the mechanism behind Fluent API, and provide you with a demo.</p><hr><h1 id="1-Behind-the-Fluent-API"><a href="#1-Behind-the-Fluent-API" class="headerlink" title="1. Behind the Fluent API"></a>1. Behind the Fluent API</h1><p>First of all, we have to ask ourself a question: How does the Fluent API work?</p><p>Let’s think about it. Of course, we must be able to chain the method call, which can be simply done by returning the instance itself. However, after each call, the next method varies. 🧐</p><p>Does it ring a bell? I believe you are close to its secret. That’s it, automata! The chained call is actually traversing on an automata! 😆 Each method will return a state in the automata, and each state can call different methods leading to state transition.</p><p>Now we know the theory behind this, let’s get to a demo to implement this idea. I’ll show you the basic design of Fluent API, and a trick to make it even more fluent. 😉</p><div class="note info flat"><p>All code in this post is available on <a target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil/FluentApiDemo">GitHub</a>.</p></div><hr><h1 id="2-Getting-Fluent"><a href="#2-Getting-Fluent" class="headerlink" title="2. Getting Fluent"></a>2. Getting Fluent</h1><div class="note info flat"><p>Code for this part is under folder <code>Basic</code> in project <code>FluentApiDemo</code>. Corresponding test class is <code>BasicTest</code>.</p></div><p>Now, think of a situation when you need to build a table using SQL. You may need to manually write the SQL string like below, and use string concatenation to join them piece by piece.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `Demo`.`DemoTable` (</span><br><span class="line">  `Id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `Name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `Age` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `Email` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`Id`)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><div class="note info flat"><p>In case you are not familiar with it, you can refer to this post for the basic syntax of creating a table using SQL: <a target="_blank" rel="noopener" href="https://www.tutorialspoint.com/sql/sql-create-table.htm">SQL - CREATE Table</a>.</p></div><p>This is one of the best scenario to use Fluent API, to build a structured object. So let’s go through the complete process to create a SQL table builder with Fluent API.</p><h2 id="1-1-Constructing-the-Automata"><a href="#1-1-Constructing-the-Automata" class="headerlink" title="1.1 Constructing the Automata"></a>1.1 Constructing the Automata</h2><p>It is vital to analyze the calling relations when we try to build Fluent API, because that’s what makes Fluent API fluent. And it would be even better if you can draw the corresponding automata.</p><p>To create a table using SQL, roughly you need these information.</p><ul><li>Name of the table.</li><li>Name of the database you want to put this table.</li><li>Columns in the table, and each column has name, type, whether is key or is required.</li></ul><p>In the properties above, except for the key and nullable properties, all information is required. So we can draft our automata like this. The node represents a state of the builder, and the edge represents a method call. We start from Initial, and finally go to End after a series of calls.</p><p><img src="/posts/Thoughts-on-Building-Fluent-API/Basic.svg"></p><p>The edges labeled ε means the state can transfer without calling any method. For example, after we call <code>OfType()</code>, we can directly call <code>Build()</code> or <code>AddColumn()</code>, instead of calling <code>IsKey()</code> or <code>IsRequired()</code>.</p><p>Isn’t it clear when we have the automata? 😏 Now let’s implement it.</p><div class="note warning flat"><p>Actually, there is one flaw in this preliminary automata I presented you here, have you found it?<br><span class="hide-inline"><button type="button" class="hide-button">Click to reveal the flaw.</button><span class="hide-content">You can build the table without adding any columns! 😨</span></span></p></div><h2 id="1-2-Creating-the-Interfaces"><a href="#1-2-Creating-the-Interfaces" class="headerlink" title="1.2 Creating the Interfaces"></a>1.2 Creating the Interfaces</h2><p>Now it’s time to convert the automata to actual code. Here I’m going to use C# as example, but the other object-oriented language should work just the same.</p><p>To get start, you should have a basic thoughts of your implementation. Each node in the automata should be an interface, with its out edges as methods. And for each method, its return value should be the interface its edge points to.</p><p>As for interfaces connected by ε edges, it means that, the interface at the start of the ε edge can call methods of the interface at the end.</p><p>With these in mind, we need 5 interfaces, and each can be defined as follows.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ICanSetDatabase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">ICanAddColumn <span class="title">InDatabase</span>(<span class="params"><span class="built_in">string</span> database</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ICanAddColumn</span> : <span class="title">ICanBuildTable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">ICanSetColumnType <span class="title">AddColumn</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ICanSetColumnType</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">ICanSetColumnProperty <span class="title">OfType</span>(<span class="params"><span class="built_in">string</span> type</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ICanSetColumnProperty</span> : <span class="title">ICanBuildTable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">ICanAddColumn <span class="title">IsKey</span>()</span>;</span><br><span class="line">    <span class="function">ICanAddColumn <span class="title">IsRequired</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ICanBuildTable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">Build</span>()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Note the use of inheritance here. When ε edge encountered, you don’t need to write the method again in another interface. Instead, you can simply inherit them.</p><h2 id="1-3-Implementing-the-Interfaces"><a href="#1-3-Implementing-the-Interfaces" class="headerlink" title="1.3 Implementing the Interfaces"></a>1.3 Implementing the Interfaces</h2><p>The implementation shows the interface magic again. We just need a class that implements all these interfaces, and all the self reference returned will be recognized as corresponding interfaces, and limit the user access for the methods.</p><p>So, we can create a <code>BasicTableDescriptor</code> like this. The approach is not one and only. It’s just a demo. 🙂</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BasicTableDescriptor</span> :</span><br><span class="line">    <span class="title">ICanSetDatabase</span>,</span><br><span class="line">    <span class="title">ICanAddColumn</span>,</span><br><span class="line">    <span class="title">ICanSetColumnType</span>,</span><br><span class="line">    <span class="title">ICanSetColumnProperty</span>,</span><br><span class="line">    <span class="title">ICanBuildTable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> List&lt;Tuple&lt;<span class="built_in">string</span>, <span class="built_in">string</span>, <span class="built_in">string</span>&gt;&gt; _columns = [];</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> List&lt;<span class="built_in">string</span>&gt; _keys = [];</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> _currentColumn = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> _database = <span class="literal">null</span>!;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> _name = <span class="literal">null</span>!;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">BasicTableDescriptor</span>()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ICanSetDatabase <span class="title">CreateTable</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> descriptor = <span class="keyword">new</span> BasicTableDescriptor();</span><br><span class="line">        descriptor._name = name;</span><br><span class="line">        <span class="keyword">return</span> descriptor;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">public</span> ICanAddColumn <span class="title">InDatabase</span>(<span class="params"><span class="built_in">string</span> database</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _database = database;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ICanSetColumnType <span class="title">AddColumn</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Tuple&lt;<span class="built_in">string</span>, <span class="built_in">string</span>, <span class="built_in">string</span>&gt; column = Tuple.Create(name, <span class="string">&quot;&quot;</span>, <span class="string">&quot;NULL&quot;</span>);</span><br><span class="line">        _columns.Add(column);</span><br><span class="line">        _currentColumn++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">public</span> ICanSetColumnProperty <span class="title">OfType</span>(<span class="params"><span class="built_in">string</span> type</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _columns[_currentColumn] = Tuple.Create(_columns[_currentColumn].Item1, type, <span class="string">&quot;NULL&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ICanAddColumn <span class="title">IsKey</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        _columns[_currentColumn] =</span><br><span class="line">            Tuple.Create(_columns[_currentColumn].Item1, _columns[`_currentColumn`].Item2, <span class="string">&quot;NOT NULL&quot;</span>);</span><br><span class="line">        _keys.Add(_columns[_currentColumn].Item1);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ICanAddColumn <span class="title">IsRequired</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        _columns[_currentColumn] =</span><br><span class="line">            Tuple.Create(_columns[_currentColumn].Item1, _columns[_currentColumn].Item2, <span class="string">&quot;NOT NULL&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Build</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// If key is missing, add the first column as key.</span></span><br><span class="line">        <span class="keyword">if</span> (_keys.Count == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (_columns.Count == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> InvalidOperationException(<span class="string">&quot;Table must have at least one column&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            _keys.Add(_columns[<span class="number">0</span>].Item1);</span><br><span class="line">            _columns[<span class="number">0</span>] = Tuple.Create(_columns[<span class="number">0</span>].Item1, _columns[<span class="number">0</span>].Item2, <span class="string">&quot;NOT NULL&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> sql = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        sql.AppendLine(<span class="string">$&quot;CREATE TABLE `<span class="subst">&#123;_database&#125;</span>`.`<span class="subst">&#123;_name&#125;</span>` (&quot;</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (Tuple&lt;<span class="built_in">string</span>, <span class="built_in">string</span>, <span class="built_in">string</span>&gt; column <span class="keyword">in</span> _columns)</span><br><span class="line">        &#123;</span><br><span class="line">            sql.AppendLine(<span class="string">$&quot;  `<span class="subst">&#123;column.Item1&#125;</span>` <span class="subst">&#123;column.Item2&#125;</span> <span class="subst">&#123;column.Item3&#125;</span>,&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        sql.Append(<span class="string">&quot;  PRIMARY KEY (&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; _keys.Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            sql.Append(<span class="string">$&quot;`<span class="subst">&#123;_keys[i]&#125;</span>`&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (i != _keys.Count - <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                sql.Append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        sql.AppendLine(<span class="string">&quot;)&quot;</span>);</span><br><span class="line">        sql.AppendLine(<span class="string">&quot;);&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sql.ToString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now, you can write code like this to generate a SQL statement.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> sql = BasicTableDescriptor.CreateTable(<span class="string">&quot;ValidTable&quot;</span>).InDatabase(<span class="string">&quot;Demo&quot;</span>)</span><br><span class="line">    .AddColumn(<span class="string">&quot;Id&quot;</span>).OfType(<span class="string">&quot;int&quot;</span>).IsKey()</span><br><span class="line">    .AddColumn(<span class="string">&quot;Name&quot;</span>).OfType(<span class="string">&quot;varchar(255)&quot;</span>).IsRequired()</span><br><span class="line">    .AddColumn(<span class="string">&quot;Age&quot;</span>).OfType(<span class="string">&quot;int&quot;</span>).IsRequired()</span><br><span class="line">    .AddColumn(<span class="string">&quot;Email&quot;</span>).OfType(<span class="string">&quot;varchar(255)&quot;</span>)</span><br><span class="line">    .Build();</span><br></pre></td></tr></table></figure><p>And it will output the following SQL.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `Demo`.`ValidTable` (</span><br><span class="line">  `Id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `Name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `Age` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `Email` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`Id`)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>Tada! 🎉 Your API is fluent now! 😁</p><h2 id="1-4-Limitation"><a href="#1-4-Limitation" class="headerlink" title="1.4 Limitation"></a>1.4 Limitation</h2><p>If you looked into the implementation I’ve presented above, you may notice one problem, which I mentioned in <a href="#1-1-Constructing-the-Automata">1.1</a>. That is when we trying to build the SQL without adding any column, it will throw an exception!</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BasicTableDescriptor.CreateTable(<span class="string">&quot;InvalidTable&quot;</span>).InDatabase(<span class="string">&quot;Demo&quot;</span>).Build();</span><br><span class="line"><span class="comment">// Exception thrown!</span></span><br></pre></td></tr></table></figure><p>Users can only know this via documentation, or see the exception thrown with their own 👀. This is bad, because it will make our Fluent API not fluent. 🥲</p><p>So how can we prevent it from even happening?</p><hr><h1 id="3-Becoming-More-Fluent"><a href="#3-Becoming-More-Fluent" class="headerlink" title="3. Becoming More Fluent"></a>3. Becoming More Fluent</h1><div class="note info flat"><p>Code for this part is under folder <code>Advanced</code> in project <code>FluentApiDemo</code>. Corresponding test class is <code>AdvancedTest</code>.</p></div><p>In this part I’m going to introduce to you a simple way of dealing with the number of calls in Fluent API. Which mean some method can only be access after a certain number of calls for a method.</p><h2 id="3-1-Updating-the-Automata"><a href="#3-1-Updating-the-Automata" class="headerlink" title="3.1 Updating the Automata"></a>3.1 Updating the Automata</h2><p>To make <code>Build()</code> not available before the first <code>AddColumn()</code> is called, the most simple modification we can come up with is adding those steps before <code>Build()</code>. And the automata will then be like this.</p><p><img src="/posts/Thoughts-on-Building-Fluent-API/Advanced-1.svg" alt="Advanced-1"></p><p>We simply duplicated some interfaces to achieve the goal, and it looks good. But in this case, we’ll have 9 interfaces! 🫢 Do we really need so many nodes? The answer is, no.</p><h2 id="3-2-Finite-Automata"><a href="#3-2-Finite-Automata" class="headerlink" title="3.2 Finite Automata"></a>3.2 Finite Automata</h2><p>Here it requires some more knowledge on automata. The one we have now is a <strong>NFA</strong> (Non-deterministic Finite Automata). It can be determined as a <strong>DFA</strong> (Deterministic Finite Automata) and minimized. However, as we don’t really use program to traverse it, there’s no need for determination. But we still need basic minimization to reduce our work.</p><p>So… just look at it, and figure it out… 😳 There are some tricks, though. To be specific, there are three steps.</p><ol><li>Pick two interfaces (nodes), check their incoming edges and outgoing edges.</li><li>If both the incoming and outgoing edges match (exact match, number and names), then you <strong>MAYBE</strong> able to merge them into one.</li><li>Repeat step 1 and 2, until the automata is simple enough.</li></ol><p>After these steps, you may get a minimized NFA like this. There’s only one more interface added, the purple one.</p><p><img src="/posts/Thoughts-on-Building-Fluent-API/Advanced-2.svg" alt="Advanced-2"></p><h2 id="3-3-More-Fluent-Descriptor"><a href="#3-3-More-Fluent-Descriptor" class="headerlink" title="3.3 More Fluent Descriptor"></a>3.3 More Fluent Descriptor</h2><p>With an added state, we need to modify the return value of <code>InDatabase()</code>, and add an interface representing the purple node.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ICanSetDatabase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">ICanAddColumnFirst <span class="title">InDatabase</span>(<span class="params"><span class="built_in">string</span> database</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ICanAddColumnFirst</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">ICanSetColumnType <span class="title">AddColumn</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>But it will introduce another problem - naming conflict. If we inherit all these interfaces like we did before, you’ll find that <code>AddColumn()</code> will be defined both in <code>ICanAddColumnFirst</code> and <code>ICanAddColumn</code> with the same parameter and return value, but they should have different behavior! 😩</p><p>If we cannot define them in one class, then why not in two? We can split our automata into two, and each implements a subset of our interfaces.</p><p><img src="/posts/Thoughts-on-Building-Fluent-API/Advanced-3.svg" alt="Advanced-3"></p><p>Note that we will silently transfer to another class instance in the first <code>AddColumn</code> method, and all states should be preserved. So, we can create the following two classes. (Forget about the poor naming. 😭)</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AdvancedTableDescriptor</span> :</span><br><span class="line">    <span class="title">ICanSetDatabase</span>,</span><br><span class="line">    <span class="title">ICanAddColumnFirst</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ICanSetColumnType <span class="title">AddColumn</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Tuple&lt;<span class="built_in">string</span>, <span class="built_in">string</span>, <span class="built_in">string</span>&gt; column = Tuple.Create(name, <span class="string">&quot;&quot;</span>, <span class="string">&quot;NULL&quot;</span>);</span><br><span class="line">        _columns.Add(column);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AdvanceTableDescriptorImpl(_name, _database, _columns);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">AdvanceTableDescriptorImpl</span> :</span><br><span class="line">    <span class="title">ICanAddColumn</span>, <span class="title">ICanSetColumnType</span>, <span class="title">ICanSetColumnProperty</span>, <span class="title">ICanBuildTable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note info flat"><p>The other parts are the same, and you can go to its repo on <a target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil/FluentApiDemo">GitHub</a> for the detailed implementation.</p></div><p>Tada! 🎉 Now, the invalid call won’t even pass compilation. 😁</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AdvancedTableDescriptor.CreateTable(<span class="string">&quot;InvalidTable&quot;</span>)</span><br><span class="line">    .InDatabase(<span class="string">&quot;Demo&quot;</span>).Build();   <span class="comment">// Compile error!</span></span><br></pre></td></tr></table></figure><hr><h1 id="Epilogue"><a href="#Epilogue" class="headerlink" title="Epilogue"></a>Epilogue</h1><p>Although it requires some tricks to implement a Fluent API, the most important thing is to know <strong>how users use your interface</strong>. Remember that the Fluent API is only fluent when the calling logic is straight forward and easily understood.</p><p>Now the secret is revealed, enjoy your own Fluent API! ᓚᘏᗢ</p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://www.tonys-studio.top">Tony Lewis</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.tonys-studio.top/posts/Thoughts-on-Building-Fluent-API/">https://blog.tonys-studio.top/posts/Thoughts-on-Building-Fluent-API/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Repo-Available/">Repo Available</a><a class="post-meta__tags" href="/tags/C/">C#</a><a class="post-meta__tags" href="/tags/Fluent-API/">Fluent API</a><a class="post-meta__tags" href="/tags/Design/">Design</a></div><div class="post-share"><div class="addtoany"><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_button_wechat"></a><a class="a2a_button_qzone"></a><a class="a2a_button_sina_weibo"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_email"></a><a class="a2a_button_copy_link"></a><a class="a2a_dd" target="_blank" rel="noopener" href="https://www.addtoany.com/share"></a></div></div><script async src="https://static.addtoany.com/menu/page.js"></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/Network-Settings-for-WSL/" title="Network Settings for WSL"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/07/13.jpeg" onerror='onerror=null,src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Network Settings for WSL</div></div><div class="info-2"><div class="info-item-1">Configure network connection for WSL</div></div></div></a><a class="pagination-related" href="/posts/Connecting-to-JumpServer-with-VSCode/" title="Connecting to JumpServer With VSCode"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/24/12.jpeg" onerror='onerror=null,src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Connecting to JumpServer With VSCode</div></div><div class="info-2"><div class="info-item-1">How to connect to the JumpServer using Visual Studio Code</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/Bulk-Task-Optimization-in-C/" title="Bulk Task Optimization in C#"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/03/01.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Dec. 16th, 2023 - 13:45:51</div><div class="info-item-2">Bulk Task Optimization in C#</div></div><div class="info-2"><div class="info-item-1">Optimize bulk task in C# using async/wait.</div></div></div></a><a class="pagination-related" href="/posts/AOP-in-Spring-Boot/" title="AOP in Spring Boot"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/11/03.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Jul. 12th, 2024 - 11:26:45</div><div class="info-item-2">AOP in Spring Boot</div></div><div class="info-2"><div class="info-item-1">Concept and application of Aspect-oriented programming in Spring Boot</div></div></div></a><a class="pagination-related" href="/posts/Deployment-Practice-with-Kubernetes/" title="Deployment Practice With Kubernetes"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/24/03.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Aug. 4th, 2024 - 17:27:36</div><div class="info-item-2">Deployment Practice With Kubernetes</div></div><div class="info-2"><div class="info-item-1">A practical walk through for deployment via Kubernetes</div></div></div></a><a class="pagination-related" href="/posts/Dungeon/" title="Dungeon"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/posts/Dungeon.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Jan. 4th, 2023 - 21:45:04</div><div class="info-item-2">Dungeon</div></div><div class="info-2"><div class="info-item-1">A rogue-like game developed with EasyX and FMOD in C++.</div></div></div></a><a class="pagination-related" href="/posts/Getting-Started-with-CUDA/" title="Getting Started With CUDA"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/12/03.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Jun. 4th, 2024 - 14:05:56</div><div class="info-item-2">Getting Started With CUDA</div></div><div class="info-2"><div class="info-item-1">Take your first step into CUDA&reg; to unleash the power of your GPU!</div></div></div></a><a class="pagination-related" href="/posts/Introduction-to-C-Game-Development/" title="Introduction to C++ Game Development"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/posts/Introduction-to-C-Game-Development.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Aug. 12th, 2023 - 11:53:56</div><div class="info-item-2">Introduction to C++ Game Development</div></div><div class="info-2"><div class="info-item-1">Get started with C++ game development using EasyX</div></div></div></a></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/avatar.png" onerror='this.onerror=null,this.src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/missing.gif"' alt="avatar"></div><div class="author-info-name">Tony Lewis</div><div class="author-info-description">Do or do not. There is no try.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">95</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">86</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">40</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Lord-Turmoil" target="_blank" title="Github"><i class="fa-brands fa-github"></i></a><a class="social-icon" href="mailto:swift-phantom@outlook.com" target="_blank" title="Email"><i class="fa-solid fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/2030942344" target="_blank" title="BiliBili"><i class="fa-brands fa-bilibili"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Hello there!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Prologue"><span class="toc-text">Prologue</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Behind-the-Fluent-API"><span class="toc-text">1. Behind the Fluent API</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Getting-Fluent"><span class="toc-text">2. Getting Fluent</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-Constructing-the-Automata"><span class="toc-text">1.1 Constructing the Automata</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-Creating-the-Interfaces"><span class="toc-text">1.2 Creating the Interfaces</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-Implementing-the-Interfaces"><span class="toc-text">1.3 Implementing the Interfaces</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-Limitation"><span class="toc-text">1.4 Limitation</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Becoming-More-Fluent"><span class="toc-text">3. Becoming More Fluent</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-Updating-the-Automata"><span class="toc-text">3.1 Updating the Automata</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-Finite-Automata"><span class="toc-text">3.2 Finite Automata</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-More-Fluent-Descriptor"><span class="toc-text">3.3 More Fluent Descriptor</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Epilogue"><span class="toc-text">Epilogue</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/A-Fancy-And-Practical-Zsh-Configuration/" title="A Fancy and Practical Zsh Configuration"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/03/00.jpeg" onerror='this.onerror=null,this.src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png"' alt="A Fancy and Practical Zsh Configuration"></a><div class="content"><a class="title" href="/posts/A-Fancy-And-Practical-Zsh-Configuration/" title="A Fancy and Practical Zsh Configuration">A Fancy and Practical Zsh Configuration</a><time datetime="2025-09-26T14:15:54.000Z" title="Created Sep. 26th, 2025 - 22:15:54 22:15:54">Sep. 26th, 2025 - 22:15:54</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Lambda-Calculus-A-Preliminary-View/" title="Lambda Calculus: A Preliminary View"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/01/07.jpeg" onerror='this.onerror=null,this.src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png"' alt="Lambda Calculus: A Preliminary View"></a><div class="content"><a class="title" href="/posts/Lambda-Calculus-A-Preliminary-View/" title="Lambda Calculus: A Preliminary View">Lambda Calculus: A Preliminary View</a><time datetime="2025-09-16T08:25:34.000Z" title="Created Sep. 16th, 2025 - 16:25:34 16:25:34">Sep. 16th, 2025 - 16:25:34</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Music-Notation-with-Avid-Sibelius/" title="Music Notation With Avid Sibelius"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/posts/Music-Notation-with-Avid-Sibelius.jpg" onerror='this.onerror=null,this.src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png"' alt="Music Notation With Avid Sibelius"></a><div class="content"><a class="title" href="/posts/Music-Notation-with-Avid-Sibelius/" title="Music Notation With Avid Sibelius">Music Notation With Avid Sibelius</a><time datetime="2025-09-03T04:34:54.000Z" title="Created Sep. 3rd, 2025 - 12:34:54 12:34:54">Sep. 3rd, 2025 - 12:34:54</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Getting-Started-with-Coq/" title="Getting Started With Coq"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/02/08.jpeg" onerror='this.onerror=null,this.src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png"' alt="Getting Started With Coq"></a><div class="content"><a class="title" href="/posts/Getting-Started-with-Coq/" title="Getting Started With Coq">Getting Started With Coq</a><time datetime="2025-08-08T04:30:12.000Z" title="Created Aug. 8th, 2025 - 12:30:12 12:30:12">Aug. 8th, 2025 - 12:30:12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Game-Engine-0-to-1-02-Something-on-the-Screen/" title="Game Engine 0 to 1 (02): Something on the Screen"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/21/03.jpeg" onerror='this.onerror=null,this.src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png"' alt="Game Engine 0 to 1 (02): Something on the Screen"></a><div class="content"><a class="title" href="/posts/Game-Engine-0-to-1-02-Something-on-the-Screen/" title="Game Engine 0 to 1 (02): Something on the Screen">Game Engine 0 to 1 (02): Something on the Screen</a><time datetime="2025-07-04T12:07:57.000Z" title="Created Jul. 4th, 2025 - 20:07:57 20:07:57">Jul. 4th, 2025 - 20:07:57</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/07/14.jpeg)"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Tony Lewis</span></div><div class="footer_custom_text">No bird soars too high if he soars on his own wings</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(()=>{const e=()=>{const e=document.querySelectorAll("#article-container .mermaid-wrap");if(0===e.length)return;const t=()=>(e=>{window.loadMermaid=!0;const t="dark"===document.documentElement.getAttribute("data-theme")?"dark":"forest";e.forEach((e,n)=>{const d=e.firstElementChild,r="mermaid-"+n,a=`%%{init:{ 'theme':'${t}'}}%%\n`+d.textContent,i=mermaid.render(r,a),m=e=>{d.insertAdjacentHTML("afterend",e)};"string"==typeof i?m(i):i.then(({svg:e})=>m(e))})})(e);btf.addGlobalFn("themeChange",t,"mermaid"),window.loadMermaid?t():btf.getScript("https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js").then(t)};btf.addGlobalFn("encrypt",e,"mermaid"),window.pjax?e():document.addEventListener("DOMContentLoaded",e)})()</script><script>(()=>{let n=window.walineFn||null;const e="shuoshuo"===GLOBAL_CONFIG_SITE.pageType,t=(n,t=document,i=window.location.pathname)=>{const o=n({el:t.querySelector("#waline-wrap"),serverURL:"https://comment.tonys-studio.top",pageview:!0,dark:'html[data-theme="dark"]',comment:!0,path:i});e&&(window.shuoshuoComment.destroyWaline=()=>{o.destroy(),t.children.length&&(t.innerHTML="",t.classList.add("no-comment"))})},i=(e,i)=>{n?t(n,e,i):btf.getCSS("https://cdn.jsdelivr.net/npm/@waline/client@2/dist/waline.min.css").then(()=>import("https://cdn.jsdelivr.net/npm/@waline/client@2/dist/waline.min.js")).then(({init:o})=>{n=o||Waline.init,t(n,e,i),window.walineFn=n})};e?window.shuoshuoComment={loadComment:i}:setTimeout(i,0)})()</script></div><script src="/static/custom.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> Loading Database</span></div><div class="local-search-input"><input placeholder="Looking for something?🔍" type="text"></div><hr><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><script data-pjax>function butterfly_footer_beautify_injector_config(){var e=document.getElementById("footer");console.log("已挂载butterfly_footer_beautify"),e.insertAdjacentHTML("beforeend",'<p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="Framework Hexo" title=""><img src="https://img.shields.io/badge/Frame-Hexo%205.4.2-blue?style=flat-square&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="Theme Butterfly" title=""><img src="https://img.shields.io/badge/Theme-Butterfly%205.4.3-6513df?style=flat-square&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="All articles in this blog are licensed under CC BY-NC-SA 4.0 unless stating additionally." title=""><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat-square&amp;logo=Claris" alt=""/></a></p>')}for(var elist="null".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_footer_beautify_injector_config()</script></body></html>