<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Demystifying NAT in P2P | TONY'S STUDIO</title><meta name="author" content="Tony Lewis"><meta name="copyright" content="Tony Lewis"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#300303"><meta name="description" content="Exploring NAT and P2P gaming issues, and how to solve them with Zerotier or OpenVPN">
<meta property="og:type" content="article">
<meta property="og:title" content="Demystifying NAT in P2P">
<meta property="og:url" content="https://blog.tonys-studio.top/posts/Demystifying-NAT-in-P2P/">
<meta property="og:site_name" content="TONY&#39;S STUDIO">
<meta property="og:description" content="Exploring NAT and P2P gaming issues, and how to solve them with Zerotier or OpenVPN">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/02/11.jpeg">
<meta property="article:published_time" content="2025-04-25T08:36:44.000Z">
<meta property="article:modified_time" content="2025-09-16T10:21:43.674Z">
<meta property="article:author" content="Tony Lewis">
<meta property="article:tag" content="Network">
<meta property="article:tag" content="NAT">
<meta property="article:tag" content="VPN">
<meta property="article:tag" content="Zerotier">
<meta property="article:tag" content="OpenVPN">
<meta property="article:tag" content="P2P">
<meta property="article:tag" content="Command &amp; Conquer">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/02/11.jpeg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Demystifying NAT in P2P",
  "url": "https://blog.tonys-studio.top/posts/Demystifying-NAT-in-P2P/",
  "image": "https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/02/11.jpeg",
  "datePublished": "2025-04-25T08:36:44.000Z",
  "dateModified": "2025-09-16T10:21:43.674Z",
  "author": [
    {
      "@type": "Person",
      "name": "Tony Lewis",
      "url": "https://tonys-studio.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/favicon.svg"><link rel="canonical" href="https://blog.tonys-studio.top/posts/Demystifying-NAT-in-P2P/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//www.clarity.ms"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="codeva-R6O16YoeQt"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#300303')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?68629f5da0a0c3347b896920fbf164b5";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
btf.addGlobalFn('pjaxComplete', () => {
  _hmt.push(['_trackPageview',window.location.pathname])
}, 'baidu_analytics')
</script><script>(function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
})(window, document, "clarity", "script", "sthrplbt7c");
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":10,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":256,"languages":{"author":"Author: Tony Lewis","link":"Link: ","source":"Source: TONY'S STUDIO","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#871798","bgDark":"#C81025","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Demystifying NAT in P2P',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/static/custom.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-butterfly-footer-beautify@1.0.6/lib/runtime.min.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/css/barber-shop.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/background.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/avatar.png" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/missing.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">94</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">85</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">41</div></a></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-newspaper"></i><span> Posts</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-jedi fa-beat"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/02/11.jpeg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/logo.svg" alt="Logo"><span class="site-name">TONY'S STUDIO</span></a><a class="nav-page-title" href="/"><span class="site-name">Demystifying NAT in P2P</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-newspaper"></i><span> Posts</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-jedi fa-beat"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Demystifying NAT in P2P</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-04-25T08:36:44.000Z" title="Created Apr. 25th, 2025 - 16:36:44 16:36:44">Apr. 25th, 2025 - 16:36:44</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-09-16T10:21:43.674Z" title="Updated Sep. 16th, 2025 - 18:21:43 18:21:43">Sep. 16th, 2025 - 18:21:43</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Miscellany/">Miscellany</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">4.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>29mins</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span class="waline-pageview-count" data-path="/posts/Demystifying-NAT-in-P2P/"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">Comments:</span><a href="/posts/Demystifying-NAT-in-P2P/#post-comment"><span class="waline-comment-count" data-path="/posts/Demystifying-NAT-in-P2P/"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p style="text-align: center"><i>&ldquo;И ещё не раз кляня судьбу,</i><br><i>Вспомнишь ты Призрака мольбу!&rdquo;</i></p>
<p style="text-align: right"><i>&mdash; Призрак Оперы</i></p>

<h1 id="Prologue"><a href="#Prologue" class="headerlink" title="Prologue"></a>Prologue</h1><p>Ahoy. It’s been quite a few days since the last post. I could have written more, but I’m not content of poor quality articles that are more like walkthroughs.</p>
<p>Recently, I come across, again, P2P gaming issues, which is really frustrating. The root cause of this is NAT. Instead of searching just for solutions, maybe it’s time to take a look at this trouble maker. So in this post, I’ll first talk about NAT, then share two ways to enjoy P2P games under bad NAT situation. Finally, I’ll try it out on my favorite game &mdash; <a target="_blank" rel="noopener" href="https://cnc.fandom.com/wiki/Command_%26_Conquer_3:_Kane%27s_Wrath">Command &amp; Conquer 3: Kane’s Wrath</a>.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p>Thanks for all these wonderful articles!</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Network_address_translation">Network address translation</a></li>
<li><a target="_blank" rel="noopener" href="https://doc-kurento.readthedocs.io/en/latest/knowledge/nat.html">NAT Types and NAT Traversal</a></li>
<li><a target="_blank" rel="noopener" href="https://support.dh2i.com/docs/Archive/kbs/general/understanding-different-nat-types-and-hole-punching/">Understanding Different NAT Types and Hole-Punching</a></li>
<li><a target="_blank" rel="noopener" href="https://nordvpn.com/blog/vpn-vs-proxy/">Proxy vs VPN: What are the main differences?</a></li>
<li><a target="_blank" rel="noopener" href="https://liaoguoyin.com/posts/zerotier-moon/">Zerotier组网之自建Moon加速节点</a></li>
<li><a target="_blank" rel="noopener" href="https://monovm.com/blog/set-up-a-vpn-on-vps-server/#Why-Use-a-VPS-for-Hosting-Your-VPN">How to Set Up a VPN on VPS Server: A Step-by-Step Guide</a></li>
</ul>
<hr>
<h1 id="NAT"><a href="#NAT" class="headerlink" title="NAT"></a>NAT</h1><p>So, first, let’s talk about NAT. I’ll explain common types of NAT, and for today’s topic, how it impacts our gaming experience.</p>
<h2 id="What-is-NAT"><a href="#What-is-NAT" class="headerlink" title="What is NAT"></a>What is NAT</h2><p>Today, the most common protocol for internet communication is TCP&#x2F;IP. As TCP&#x2F;IP protocol communicates via IP, in order to get in touch with worldwide users freely, one must have a <strong>public</strong> IP. However, as most programs still use IPv4, and the number of IPv4 addresses is limited, most of us are in fact, sitting in a private network, and apparently, not having a public IP.</p>
<p>In this case, how can we communicate with the outside world? This is where NAT comes in. NAT, a.k.a. Network Address Translation, is a method of mapping a private IP address to a public one, and vice versa. A private network must have at least one router with a public IP, so that it can communicate with the outside world on our behalf. And this router is called <strong>NAT router</strong>.</p>
<p>When a packet is sent from a private network to the outside world, the NAT router will replace the source IP address with its own public IP address, and record the mapping in a table. When a packet comes back, it will check the destination IP address, and if it matches its own public IP, it will look up the table, and replace the destination IP address with the original private one, and send it to client.</p>
<p>This is how NAT works. However, this is not the end of the story. NAT routers can be configured in different ways, and this leads to different types of NAT. And some of them are not friendly for P2P gaming.</p>
<h2 id="Different-Types-of-NAT"><a href="#Different-Types-of-NAT" class="headerlink" title="Different Types of NAT"></a>Different Types of NAT</h2><p>There are more types of NAT, but the most common ones are:</p>
<ul>
<li>Full Cone NAT</li>
<li>(Address) Restricted Cone NAT</li>
<li>Port Restricted Cone NAT</li>
<li>Symmetric NAT</li>
</ul>
<p>They are defined by how they handle incoming packets, and how they map the private IP address to the public one. Before we move on, there are some terms you need to know.</p>
<p>The communication of TCP&#x2F;IP is between pairs of IP address and port. For us who sits behind a NAT router, let’s say we have internal IP address and port (<em>iAddr:iPort</em>). Our hard-working NAT router, will translate it into external IP address and port (<em>eAddr:ePort</em>). And finally, the target IP address and port is (<em>hAddr:hPort</em>), we call it the host. For now, we consider host to be a public server with, of course, a public IP.</p>
<div class="note info flat"><p>The notation I used here is taken from <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Network_address_translation">Network address translation</a>. The descriptions and figures also come from this wiki.</p>
</div>

<p>In this process, the source and destination address for TCP&#x2F;IP is as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 [Client] iAddr:iPort -&gt; hAddr:hPort</span><br><span class="line">2 [   NAT] eAddr:ePort -&gt; hAddr:hPort (add mapping [iAddr:iPort, eAddr:ePort])</span><br><span class="line">3 [  Host] hAddr:hPort -&gt; eAddr:ePort</span><br><span class="line">4 [   NAT] hAddr:hPort -&gt; iAddr:iPort (look for existing mapping)</span><br></pre></td></tr></table></figure>

<p>The differences between each type of NAT is how they handle the mapping. Usually the NAT is managed by your ISP (Internet Service Provider). Based on my experience, for home and organization, you may have Port Restricted Cone. And the mobile network, like 4G or 5G, is most likely to be Symmetric NAT.</p>
<h3 id="Full-Cone-NAT"><a href="#Full-Cone-NAT" class="headerlink" title="Full Cone NAT"></a>Full Cone NAT</h3><p>This is the most basic type of NAT, also the most permissive.</p>
<ul>
<li>Once an internal address (<em>iAddr:iPort</em>) is mapped to an external address (<em>eAddr:ePort</em>), any packets from (<em>iAddr:iPort</em>) are sent through (<em>eAddr:ePort</em>).</li>
<li><strong>Any external host</strong> can send packets to (<em>iAddr:iPort</em>) by sending packets to <em>eAddr:ePort</em>.</li>
</ul>
<p>See the figure below. Once the mapping is created, it will never change, unless the router flushes the mapping. One client, one port, many hosts, doesn’t it look like a cone?</p>
<p><img src="/posts/Demystifying-NAT-in-P2P/Full_Cone_NAT.svg" alt="Full_Cone_NAT"></p>
<div class="note info flat"><p>Each half-circle represents a port, and the same IP with different port with be treated as different address.</p>
</div>

<p>In this case, as shown in the figure. Even if Client has never sent any request to Server 2, Server 2 can send something to Client if Server 1 kindly tells him the <em>eAddr:ePort</em> of Client. But if the mapping [<em>iAddr:iPort</em>, <em>eAddr:ePort</em>] does not exists yet, no one can find Client.</p>
<h3 id="Address-Restricted-Cone-NAT"><a href="#Address-Restricted-Cone-NAT" class="headerlink" title="(Address) Restricted Cone NAT"></a>(Address) Restricted Cone NAT</h3><p>You may find that Full Cone NAT is a little too permissive, so people put some restrictions to it.</p>
<ul>
<li>Once an internal address (<em>iAddr:iPort</em>) is mapped to an external address (<em>eAddr:ePort</em>), any packets from (<em>iAddr:iPort</em>) are sent through (<em>eAddr:ePort</em>).</li>
<li>An external host (<em>hAddr:any</em>) can send packets to (<em>iAddr:iPort</em>) by sending packets to (<em>eAddr:ePort</em>) only if (<em>iAddr:iPort</em>) has previously sent a packet to (<em>hAddr:any</em>). <em>Any</em> means the port number doesn’t matter.</li>
</ul>
<p>Since Restricted Cone is still Cone, so they are essentially the same. The difference is that Restricted Cone NAT will check incoming requests. It achieves this with an extra mapping of [<em>iAddr:iPort</em>, <em>hAddr</em>]. First, it will resolve [<em>iAddr:iPort</em>] just like Full Cone NAT. Then it checks if [<em>iAddr:iPort</em>, <em>hAddr</em>] exists. If not, it will refuse the connection.</p>
<p><img src="/posts/Demystifying-NAT-in-P2P/Restricted_Cone_NAT.svg" alt="Restricted_Cone_NAT"></p>
<h3 id="Port-Restricted-Cone-NAT"><a href="#Port-Restricted-Cone-NAT" class="headerlink" title="Port Restricted Cone NAT"></a>Port Restricted Cone NAT</h3><p>This is actually the same as Restricted Cone NAT, just the extra mapping also includes port, i.e.  [<em>iAddr:iPort</em>, <em>hAddr:hPort</em>]</p>
<ul>
<li>Once an internal address (<em>iAddr:iPort</em>) is mapped to an external address (<em>eAddr:ePort</em>), any packets from (<em>iAddr:iPort</em>) are sent through (<em>eAddr:ePort</em>).</li>
<li>An external host (<em>hAddr:hPort</em>) can send packets to (<em>iAddr:iPort</em>) by sending packets to (<em>eAddr:ePort</em>) only if (<em>iAddr:iPort</em>) has previously sent a packet to (<em>hAddr:hPort</em>).</li>
</ul>
<p><img src="/posts/Demystifying-NAT-in-P2P/Port_Restricted_Cone_NAT.svg" alt="Port_Restricted_Cone_NAT"></p>
<h3 id="Symmetric-NAT"><a href="#Symmetric-NAT" class="headerlink" title="Symmetric NAT"></a>Symmetric NAT</h3><p>The first three cone NATs, are all permissive, as long as you know Client’s (<em>eAddr:ePort</em>) and it has sent you something before, you can establish a connection. But, things change for Symmetric NAT.</p>
<ul>
<li>The combination of one internal IP address and a destination IP address and port is mapped to a single unique external source IP address and port; if the same internal host sends a packet even with the same source address and port but to a different destination, a different mapping is used.</li>
<li>Only an external host that receives a packet from an internal host can send a packet back.</li>
</ul>
<p>The description may not be clear enough. Check the figure instead. Now, the <em>eAddr:ePort</em> is no longer fixed. Symmetric NAT ensures that every (<em>iAddr:iPort</em>, <em>hAddr:hPort</em>) has a different (<em>eAddr:ePort</em>). So even if Server 2 knows (<em>eAddr:ePort</em>) from Server 1, it is unable to establish a connection with Client.</p>
<p><img src="/posts/Demystifying-NAT-in-P2P/Symmetric_NAT.svg" alt="Symmetric_NAT"></p>
<p>Unlike Cone ones, Symmetric NAT maintains a one-to-one relation between <em>iAddr:iPort</em> and <em>hAddr:hPort</em>, and it is why this type of NAT is named “Symmetric”.</p>
<p>You may complain about such strict limits, but it does improves security, as not everyone can access your private address. But Port Restricted Cone can also do it, why bother making it Symmetric? Referring to <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/47919129/whats-the-advantage-of-symmetric-nat-as-far-as-isp-is-concerned">What’s the advantage of symmetric NAT (as far as ISP is concerned)?</a>, Symmetric NAT is easier to maintain. It does have a point, as all connections are unique, so the router only need to lookup the mapping once, while Port Restricted Cone has to check prior records. </p>
<h2 id="NAT-Traversal"><a href="#NAT-Traversal" class="headerlink" title="NAT Traversal"></a>NAT Traversal</h2><p>Just now, we assume the host to be a public server, it can be webpages we visit everyday. Then it comes the question, can we communicate with someone who is also behind a NAT router?</p>
<p>If you are in the same private network, i.e. under the same router, the answer is definitely yes. It is just LAN, Local Area Network, it is meant to be interconnective. The real challenge is, how to communicate with someone in another LAN.</p>
<p>In order to expose a private host, making it connectable from the outside world, we have, the “infamous” NAT Traversal. You may be more familiar with its alias, Hole Punching. This technique allows a private address to be located just like a public one. How is it possible?</p>
<p>First, let’s take Full Cone as example. We know that, the mapping will never change after creation. Since <em>eAddr</em> is a public IP, we can use <em>eAddr:ePort</em>, to access <em>iAddr:iPort</em>. We did it! Just one annoying problem, that you are not able to customize <em>eAddr:ePort</em> like what you can do with a real public address. Since the NAT router’s IP is unlikely to change and it may not flush the mapping often, the connection should be stable for quite a while.</p>
<p>The other two Cone NATs, as <em>iAddr:iPort</em> and <em>eAddr:ePort</em> is also bind together, can do it too, but only one <em>hAddr:hPort</em> (<em>hAddr:any</em> for Restricted Cone NAT) can access the exposed <em>eAddr:ePort</em>.</p>
<p>However, Symmetric NAT won’t be so lucky. As <em>eAddr:ePort</em> changes, it is impossible to establish a stable connection with private devices without some help.</p>
<h2 id="How-NAT-Impact-P2P"><a href="#How-NAT-Impact-P2P" class="headerlink" title="How NAT Impact P2P"></a>How NAT Impact P2P</h2><p>P2P, a.k.a. Peer-to-Peer, enables direct communication between two private devices. It is commonly used for gaming. The benefit of P2P is that it doesn’t require a central server for multiplayer game, where the player’s computer acts as the server. Even if there is a central server, it doesn’t require intensive computation.</p>
<p>Let’s consider the situation where there are two players. If both of them are lucky to have public IPs, things would be much easier as they can naturally connect with each other. If some one is behind a NAT, then things become tricky.</p>
<p>Here is a figure from <a target="_blank" rel="noopener" href="https://support.dh2i.com/docs/Archive/kbs/general/understanding-different-nat-types-and-hole-punching/">Understanding Different NAT Types and Hole-Punching</a>, showing connectivity of two devices under different NAT.</p>
<p><img src="/posts/Demystifying-NAT-in-P2P/nat_types-81eca38551a438b10ae1bb6c16ba1aee.png" alt="Different NAT type combinations and whether or not they are routable."></p>
<p>P2P connection cannot be established with players alone, as two private devices are no way getting each other’s information. So usually an intermediate software helps in the establishment process. And once establishment completes, the players can communicate with each other directly.</p>
<div class="note info flat"><p>Actually, if one of them has public IP or is under Full Cone NAT, they can achieve P2P without any help. Just let the other one know their  address, and the problem solves. <strong>As long as one way connection establishes, P2P can work.</strong></p>
</div> 

<h2 id="Establishing-A-P2P-Connection"><a href="#Establishing-A-P2P-Connection" class="headerlink" title="Establishing A P2P Connection"></a>Establishing A P2P Connection</h2><p>So how does a P2P connection establishes?</p>
<p>First, let’s talk about P2P among Cones. You can see in the previous figure that they are all routable. So first, two players send a request to the intermediate server, so that the server knows their <em>eAddr:ePort</em>. Then the server can tell each player the other’s address, so that connection establishes. Since the mapping of <em>iAddr:iPort</em> and <em>eAddr:ePort</em> never (at least for long enough) changes, players are sure to find each other. Although the first request may fail, as Restricted Cone only allow incoming requests when there are outcoming ones before, the following requests can work. This process is usually called handshake.</p>
<p>Now, what about the Symmetric NAT? Since it will change <em>ePort</em> for different connection, only <em>eAddr</em> the server acquires is valid. So the actual request sending from the player behinds Symmetric NAT to the other player has a different, and is unknown <em>ePort</em>. So the counterpart must be Full Cone or Address Restricted Cone to accept the new port, and let Symmetric NAT find it first.</p>
<p>The intermediate server here is called STUN (Session Traversal Utilities for NAT), this is lightweight, and the server only helps in establishing the connection, and is not involved in the data transferring later.</p>
<p>If both players are behind Symmetric NAT, or Port Restricted Cone meets Symmetric NAT, then unfortunately, STUN is not enough. In this case, TURN (Traversal Using Relays around NAT) is required. TURN resolves this issue by relaying all requests, therefore it is resource intensive. However, for gaming, the communication overhead is usually insignificant, so it can be a solution.</p>
<div class="note info flat"><p>Well, there is one possibility though, for Port Restricted Cone and Symmetric NAT. If somehow you can guess the new port right, then yes, the connection is OK. But this is not practical, as there would be too many ports. It would be even harder to guess two ports if both are behind Symmetric NAT. </p>
</div>

<p>TURN server is not that common, so if unfortunately there is Symmetric NAT among players, you can try another approach &mdash; VPN.</p>
<hr>
<h1 id="VPN"><a href="#VPN" class="headerlink" title="VPN"></a>VPN</h1><p>Speaking of VPN, what is the first thing coming into your mind? Bypassing some restriction, or access some private resources?</p>
<h2 id="What-is-VPN"><a href="#What-is-VPN" class="headerlink" title="What is VPN"></a>What is VPN</h2><p>VPN stands for Virtual Private Network. It works by creating a virtual network under the VPN server, and allow users in this virtual network to connect with other networks. It’s quite like a Full Cone NAT, where the “NAT router” is now the VPN server. NAT traversal is still needed, but this time the host is the VPN server, so it doesn’t matter what types of NAT you are behind.</p>
<p>The primary goal of VPN is not for P2P connection, though. VPN is meant to create secure connections by hiding your IP and encrypting your network activity, and allow access for specific resources. Without a VPN, you connect with the outside world via the NAT router. Depending on your ISP, this NAT router may be poisoned. It may ban you from access certain resources on the Internet, or monitor your activity. <del>(Or using Symmetric NAT to prevent you from P2P)</del> Once the VPN connection is established, the client can access resources provided by the VPN server. And since the actual request is delegated to the VPN server with encryption, so your IP and network activity remains unknown to others, even your ISP.</p>
<p>However, VPN is virtual, which means it is not real. The actual packages still traverse through your NAT to&#x2F;from the VPN server, so the ISP knows that you are communicating with a VPN server. But since the packages are encrypted, the ISP does not know what you are doing, making it secure.</p>
<h2 id="How-VPN-Makes-P2P-Possible"><a href="#How-VPN-Makes-P2P-Possible" class="headerlink" title="How VPN Makes P2P Possible"></a>How VPN Makes P2P Possible</h2><p>Although VPN is a virtual network, which won’t changes your NAT situation, but it brings you and your friends into the same network. So that you and your friend can play in LAN mode, if both of you join the same VPN server. However, this is not real P2P, as requests are relayed by the VPN server, and all data is encrypted. So the connection may not be as fast as P2P via STUN. But it solves the Symmetric NAT problem.</p>
<p>Another bonus for using VPN is that, you can acquire a public IP. Like we talked about earlier, VPN also use NAT to manage the virtual network, so you will have a public address from the VPN. This way, you can play the Online mode with players behind other networks.</p>
<h2 id="VPN-or-Proxy"><a href="#VPN-or-Proxy" class="headerlink" title="VPN or Proxy"></a>VPN or Proxy</h2><p>If you have previous experience using proxy server, you may wonder the differences between these to terms. To put it simple, they work the same, except that VPN provides encryption while proxy does not. For proxy, you are only invisible to the internet, and all your activity is still monitored by the ISP. Also, proxy does not create a virtual network.</p>
<img src="https://ic.nordcdn.com/v1/https://sb.nordcdn.com/m/9fa0714107182332/original/blog-infographic-vpn-vs-proxy-process-comparison-svg.svg" alt="VPN vs Proxy process comparison" style="zoom: 33%;">

<div class="note success flat"><p>For more details, you can refer to <a target="_blank" rel="noopener" href="https://nordvpn.com/blog/vpn-vs-proxy/">Proxy vs VPN: What are the main differences?</a>.</p>
</div>

<hr>
<h1 id="Virtual-LAN-with-Zerotier"><a href="#Virtual-LAN-with-Zerotier" class="headerlink" title="Virtual LAN with Zerotier"></a>Virtual LAN with Zerotier</h1><p>If you just want connectivity with known devices, you can put them in a LAN. For devices in different areas, we can utilize tools like <a target="_blank" rel="noopener" href="https://www.zerotier.com/">Zerotier</a> to create a virtual LAN, a.k.a. VLAN.</p>
<h2 id="Setting-Up-VLAN"><a href="#Setting-Up-VLAN" class="headerlink" title="Setting Up VLAN"></a>Setting Up VLAN</h2><p>The instructions on Zerotier’s website are quite clear, register an account and you are ready to create your network. Free plan allow a maximum of 25 devices in a network, which is sufficient in most cases. In the dashboard, you can get the network ID to join later. And I recommend you set it to private to prevent unwanted access. Later, in IPv4 Auto-Assign section, you can pick your preferred range.</p>
<img src="/posts/Demystifying-NAT-in-P2P/image-20250425151905741.png" alt="Zerotier Settings" style="zoom:67%;">

<p>If you want to enable broadcast and muti-cast, you can add routes <code>255.255.255.255/32</code> and <code>224.0.0.0/4</code>. This is usually needed by P2P games for player discovering.</p>
<p><img src="/posts/Demystifying-NAT-in-P2P/image-20250425172803094.png" alt="image-20250425172803094"></p>
<p>Now, the network is set, and you can join it on your devices.</p>
<h2 id="Joining-VLAN"><a href="#Joining-VLAN" class="headerlink" title="Joining VLAN"></a>Joining VLAN</h2><p>Download Zerotier client <a target="_blank" rel="noopener" href="https://www.zerotier.com/download/">here</a>. You can find it in the system tray. Click “Join New Network…”, and enter the network ID.</p>
<img src="/posts/Demystifying-NAT-in-P2P/image-20250425152711322.png" alt="Join VLAN" style="zoom: 80%;">

<p>If you set your network private, you need to approve it in the network dashboard. You can also find the assigned IP there. On your PC, you can check the assigned IP using <code>ipconfig</code> command. You can find an ethernet adapter called Zerotier One.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Ethernet adapter ZeroTier One [<span class="number">4</span>***********<span class="number">0</span>]:</span><br><span class="line"></span><br><span class="line">   Connection<span class="literal">-specific</span> DNS Suffix  . :</span><br><span class="line">   Link<span class="literal">-local</span> IPv6 Address . . . . . : fe*************<span class="number">7</span></span><br><span class="line">   IPv4 Address. . . . . . . . . . . : <span class="number">10.147</span>.***.***</span><br><span class="line">   Subnet Mask . . . . . . . . . . . : <span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">   Default Gateway . . . . . . . . . : <span class="number">25.255</span>.<span class="number">255.254</span></span><br></pre></td></tr></table></figure>

<p>Now, you are in the VLAN. If you have other devices in it, you can communicate with them.</p>
<h2 id="Launching-the-Moon"><a href="#Launching-the-Moon" class="headerlink" title="Launching the Moon"></a>Launching the Moon</h2><p>Zerotier achieves VLAN using NAT Traversal as we mentioned before to achieve P2P connection. So it also faces the routing problem. In case you have Symmetric NAT, Zerotier will relay the requests to ensure connectivity. It is nice of Zerotier to provide relay service, but the relay server is not reliable for free users. If you want stable connection, you can set up your own relay server.</p>
<div class="note info flat"><p>Zerotier is really good at naming. It’s own server is called planet, and self-hosted ones are called moon.</p>
</div>

<h3 id="Install-Zerotier"><a href="#Install-Zerotier" class="headerlink" title="Install Zerotier"></a>Install Zerotier</h3><div class="note warning flat"><p>Before you start, you need to allow UDP 9993 on your server, which is used by Zerotier.</p>
</div>

<p>First, install Zerotier on your server. The script is smart and will handle everything for you. By the way, all commands of Zerotier require <code>sudo</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s https://install.zerotier.com/ | sudo bash</span><br></pre></td></tr></table></figure>

<p>Then, you can check the server’s status.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zerotier-cli info</span><br></pre></td></tr></table></figure>

<p>If everything is fine, you can get the following response. The third column is node ID, which will be used later.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">200 info 92******65 1.14.2 ONLINE</span><br></pre></td></tr></table></figure>

<p>If the status is not <code>ONLINE</code>, you can refer to <a href="#Zerotier-Troubleshoot">Troubleshoot</a> for solution.</p>
<h3 id="Configure-Moon"><a href="#Configure-Moon" class="headerlink" title="Configure Moon"></a>Configure Moon</h3><p>Now, we will convert the Zerotier node on the server into a Moon.</p>
<p>First, we need to get a initial configuration file, which is the identity of the node.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zerotier-idtool initmoon /var/lib/zerotier-one/identity.public &gt; moon.json</span><br></pre></td></tr></table></figure>

<p>Open <code>moon.json</code>, add your server’s public IP as a stable endpoint.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> ...</span><br><span class="line"> <span class="attr">&quot;roots&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">   ...</span><br><span class="line">   <span class="attr">&quot;stableEndpoints&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;***.***.***.***/9993&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Then, we can generate the final configuration using this <code>moon.json</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zerotier-idtool genmoon moon.json</span><br></pre></td></tr></table></figure>

<p>It will generate a <code>*.moon</code> file. Copy it to <code>/var/lib/zerotier-one/moons.d/</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -p /var/lib/zerotier-one/moons.d/</span><br><span class="line">sudo <span class="built_in">cp</span> *.moon /var/lib/zerotier-one/moons.d/</span><br></pre></td></tr></table></figure>

<p>Now, restart Zerotier service, and the configuration is done.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart zerotier-one.service</span><br></pre></td></tr></table></figure>

<h3 id="Orbiting-Around-the-Moon"><a href="#Orbiting-Around-the-Moon" class="headerlink" title="Orbiting Around the Moon"></a>Orbiting Around the Moon</h3><p>The moon does not have to be a node in the VLAN. We just need to orbit around it. In each node in the VLAN, run the following command to add the Moon. The <code>&lt;moon id&gt;</code> is what you get via <code>zerotier-cli info</code> on the server.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zerotier<span class="literal">-cli</span> orbit &lt;moon id&gt; &lt;moon id&gt;</span><br></pre></td></tr></table></figure>

<p>If everything is OK, it will return <code>200 orbit OK</code>. Wait a few seconds, and you can use <code>zerotier-cli listmoons</code> to see it. You can also see it using <code>zerotier-cli listpeers</code> with role as <code>MOON</code>. To deorbit a moon, you can use <code>zerotier-cli deorbit &lt;moon-id&gt;</code>.</p>
<div class="note info flat"><p>All Zerotier commands require administrative privileges. On Windows, you can use <code>sudo</code>, which is added in Windows 11. Or press <code>Win + X</code> to run terminal as Administrator. </p>
</div>

<p>Congratulations, you now have a low-ping VLAN ready to go! </p>
<h2 id="Zerotier-Troubleshoot"><a href="#Zerotier-Troubleshoot" class="headerlink" title="Zerotier Troubleshoot"></a>Zerotier Troubleshoot</h2><p>If the status is <code>TUNNELED</code> instead of <code>ONLINE</code>, it is probably that the node is not able to connect the planet server. Check if UDP 9993 is allowed. If UFW is enabled, you can allow it with the following command.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow 9993/udp</span><br></pre></td></tr></table></figure>

<p>Then, restart Zerotier service.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart zerotier</span><br></pre></td></tr></table></figure>

<p>Now, check again, it should be <code>ONLINE</code>.</p>
<hr>
<h1 id="VPN-with-OpenVPN"><a href="#VPN-with-OpenVPN" class="headerlink" title="VPN with OpenVPN"></a>VPN with OpenVPN</h1><p>Zerotier is essentially a networking utility that helps you better manage virtual network. If you want to use it for communicating with other networks, you have to configure routers within the created virtual LAN. In this case, setting up a VPN could be a better choice.</p>
<div class="note warning flat"><p>Well, to setup your own VPN, you need a public server. It is quite easy to get one nowadays. You can purchase a ECS or VPS, or use some free ones.</p>
</div>

<p>Of course, you can buy VPN services from those companies. But they are usually expensive, and may not be legal in some countries as they provide access for forbidden resources. In this case, getting your own VPN server could be an alternative. For personal use, <a target="_blank" rel="noopener" href="https://openvpn.net/">OpenVPN</a> is a perfect solution, as it is opensource and free. </p>
<h2 id="Install-OpenVPN-Server"><a href="#Install-OpenVPN-Server" class="headerlink" title="Install OpenVPN Server"></a>Install OpenVPN Server</h2><p>First, get the OpenVPN installer script. See <a target="_blank" rel="noopener" href="https://github.com/Nyr/openvpn-install">openvpn-install</a> for more details. <a target="_blank" rel="noopener" href="https://git.io/vpn">https://git.io/vpn</a> is merely a shortcut for the <a target="_blank" rel="noopener" href="https://github.com/Nyr/openvpn-install/blob/master/openvpn-install.sh">openvpn-install.sh</a> in the master branch. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://git.io/vpn -O openvpn-install.sh</span><br></pre></td></tr></table></figure>

<div class="note warning flat"><p>If your server has connection issues with GitHub, see <a href="#OpenVPN-Troubleshoot">Troubleshoot</a> for workarounds.</p>
</div>

<p>Then, execute the installer. It requires <code>sudo</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo bash openvpn-install.sh</span><br></pre></td></tr></table></figure>

<p>It will ask you the following questions. You can choose default values, but I recommend you change the default port.</p>
<img src="/posts/Demystifying-NAT-in-P2P/image-20250425113159582.png" alt="Setup OpenVPN Server" style="zoom:67%;">

<div class="note info flat"><p>Remember to open the port to allow UDP on your server provider’s dashboard. Also you may need to use <code>ufw</code> to open the port.</p>
</div>

<p>If nothing goes wrong, you’ll see the client creation that ended with “Finished!”. And you will get a file with extension <code>ovpn</code>. Later, when you want to add new users, just execute <code>openvpn-install.sh</code> again, and you will have the options.</p>
<p><img src="/posts/Demystifying-NAT-in-P2P/image-20250425120859678.png" alt="image-20250425120859678"></p>
<p>Good, you now have your own VPN server.</p>
<h2 id="Install-OpenVPN-Client"><a href="#Install-OpenVPN-Client" class="headerlink" title="Install OpenVPN Client"></a>Install OpenVPN Client</h2><p>Now, you need the VPN client on your PC. You can get the installer at <a target="_blank" rel="noopener" href="https://openvpn.net/community-downloads/">Community Downloads</a>. Remember to tick OpenSSL Utilities on installation.</p>
<p><img src="/posts/Demystifying-NAT-in-P2P/image-20250425112024295.png" alt="Setup OpenVPN"></p>
<p>On your first launch, you may see a dialog saying no config file found. Of course, you have to import one. Download the <code>ovpn</code> file you get on your server, and import it. You can find it in the system tray.</p>
<p><img src="/posts/Demystifying-NAT-in-P2P/image-20250425121514045.png" alt="Import"></p>
<p>After importing the configuration, you can connect with the VPN server. Now, you can use websites like <a target="_blank" rel="noopener" href="https://www.showmyip.com/">ShowMyIP</a> to check if your IP really changes or not.</p>
<h2 id="OpenVPN-Troubleshoot"><a href="#OpenVPN-Troubleshoot" class="headerlink" title="OpenVPN Troubleshoot"></a>OpenVPN Troubleshoot</h2><p>Utilizing our knowledge, you can use existing proxy or VPN on your own PC to download the stuffs, then transfer them to your server. However, when you executing the installer, you may still get stuck. It is because inside the installer, it requests EasyRSA, which is also on GitHub. So you may have to modify the script.</p>
<p>Open <code>openvpn-installer.sh</code>, find <code>easy_rsa_url</code>. You can see that it fetches EasyRSA-3.2.2.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">easy_rsa_url=<span class="string">&#x27;https://github.com/OpenVPN/easy-rsa/releases/download/v3.2.2/EasyRSA-3.2.2.tgz&#x27;</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/openvpn/server/easy-rsa/</span><br><span class="line">&#123; wget -qO- <span class="string">&quot;<span class="variable">$easy_rsa_url</span>&quot;</span> 2&gt;/dev/null || curl -sL <span class="string">&quot;<span class="variable">$easy_rsa_url</span>&quot;</span> ; &#125; | tar xz -C /etc/openvpn/server/easy-rsa/ --strip-components 1</span><br></pre></td></tr></table></figure>

<p>Instead of requesting it, you can manually download it and put it somewhere. Comment out <code>wget</code> and goes directly to extract.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">easy_rsa_url=<span class="string">&#x27;https://github.com/OpenVPN/easy-rsa/releases/download/v3.2.2/EasyRSA-3.2.2.tgz&#x27;</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/openvpn/server/easy-rsa/</span><br><span class="line"><span class="comment"># &#123; wget -qO- &quot;$easy_rsa_url&quot; 2&gt;/dev/null || curl -sL &quot;$easy_rsa_url&quot; ; &#125; | tar xz -C /etc/openvpn/server/easy-rsa/ --strip-components 1</span></span><br><span class="line"><span class="built_in">cat</span> /path/to/EasyRSA-3.2.2.tgz | tar xz -C /etc/openvpn/server/easy-rsa/ --strip-components 1</span><br></pre></td></tr></table></figure>

<p>Now, there should be no more network issues.</p>
<hr>
<h1 id="Have-Fun🎉"><a href="#Have-Fun🎉" class="headerlink" title="Have Fun🎉"></a>Have Fun🎉</h1><p>Now, we know what’s going on with NAT, it’s time for gaming!🎮</p>
<p>Take Command &amp; Conque 3: Kane’s Wrath as an example. It is a classic RTS game with P2P for multiplayer. As we know, P2P require NAT Traversal, or Hole Punching, which can be a problem if players are in different networks. Especially after <a target="_blank" rel="noopener" href="https://www.techspot.com/article/2170-gamespy/">the shutdown of GameSpy</a>.</p>
<p>Luckily, there is other services to keep P2P games. One of them is <a target="_blank" rel="noopener" href="https://www.gameranger.com/">GameRanger</a>. It configures NAT Traversal using STUN so that you can play in LAN. But since it uses STUN, it fails if one of you is behind Symmetric NAT and the other is not Full Cone or (Address) Restricted Cone. It is suitable for close friends, as it doesn’t have lobby, which means you have to call your friends in real life.</p>
<p>The other is <a target="_blank" rel="noopener" href="https://cnc-online.net/en/">C&amp;C:Online</a> supported by Revora, the substitution of GameSpy, allowing you to play Online with players all over the world. So now you should realize, it requires public IP to play online. So you should either have one, or use VPN.</p>
<p>Here, with all we gathered earlier, I present you two methods, and it should work for all P2P games.</p>
<p>If you feel OK to play in LAN, you can simply use GameRanger. It is easy to use, no configuration required. However, if you encounter Symmetric NAT, you can setup Zerotier for relaying. Of course, using VPN can also allow you to play in LAN, as long as you and your friends connect to the same VPN server.</p>
<p>However, if you want to play Online, you have to use VPN. And to ensure a more stable connection, you should better have a static public IP. If you set up your own VPN server, then of course, your public IP is fixed. But if you purchase VPN services, you may check if they have this option.</p>
<p>Whether you use Zerotier or VPN, you need to change the Online IP in Settings to the assigned IP in the virtual network. Then, you can just go LAN or Online.</p>
<img src="/posts/Demystifying-NAT-in-P2P/image-20250425132802128.png" alt="image-20250425132802128" style="zoom: 50%;">

<h2 id="Play-with-Zerotier"><a href="#Play-with-Zerotier" class="headerlink" title="Play with Zerotier"></a>Play with Zerotier</h2><p>To just play in LAN, you can use Zerotier. All players should have Zerotier client, and join the same VLAN. If you have self-hosted moon, then all players should add it. See <a href="#Orbiting-Around-the-Moon">Orbiting Around the Moon</a>. Then, just open the game and play in LAN.</p>
<p>If you are unable to see your friends in the lobby, you probably forgot to allow broadcast in your network. See <a href="#Setting-Up-VLAN">Setting Up VLAN</a> to add broadcast routes.</p>
<p>A notable issue for Kane’s Wrath is that, the game is buggy for Network games. It will always choose the “smallest” IP address available, regardless of the Online IP you select in Network Options. So in order to let the game choose the correct IP, you need to ensure the IPs in the IPv4 Auto-Assign range you selected are smaller than your other IPs.</p>
<div class="note info flat"><p>When I say “smallest”, I mean, the smallest. Just compare each part from left to right. Or, for Kane’s Wrath, the first in your Online IP list.</p>
</div>

<h2 id="Play-with-VPN"><a href="#Play-with-VPN" class="headerlink" title="Play with VPN"></a>Play with VPN</h2><p>Of course, you can setup your own VPN server. You can add more accounts for your friends so they can connect to your VPN server to play in LAN. But for those who don’t have a public server, using the default server provided by <a target="_blank" rel="noopener" href="https://cgf-uploads.net/">Command Post</a> can be an alternative. But not all games have this convenience.</p>
<img src="/posts/Demystifying-NAT-in-P2P/image-20250425133537822.png" alt="Command Post VPN" style="zoom: 67%;">

<p>Of course, self-hosted VPN can be faster. Also, you can play Online with your own VPN server.</p>
<hr>
<h1 id="Epilogue"><a href="#Epilogue" class="headerlink" title="Epilogue"></a>Epilogue</h1><p>Isn’t it great to be able to play P2P games? But the point is that, we now know what is going on, instead of just complaining about the NAT. It’s been about two years since I first encountered this problem, and now, finally, the problem is resolved. Good luck, have fun!ᓚᘏᗢ</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://tonys-studio.top">Tony Lewis</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.tonys-studio.top/posts/Demystifying-NAT-in-P2P/">https://blog.tonys-studio.top/posts/Demystifying-NAT-in-P2P/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Network/">Network</a><a class="post-meta__tags" href="/tags/NAT/">NAT</a><a class="post-meta__tags" href="/tags/VPN/">VPN</a><a class="post-meta__tags" href="/tags/Zerotier/">Zerotier</a><a class="post-meta__tags" href="/tags/OpenVPN/">OpenVPN</a><a class="post-meta__tags" href="/tags/P2P/">P2P</a><a class="post-meta__tags" href="/tags/Command-Conquer/">Command &amp; Conquer</a></div><div class="post-share"><div class="addtoany"><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_button_wechat"></a><a class="a2a_button_qzone"></a><a class="a2a_button_sina_weibo"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_email"></a><a class="a2a_button_copy_link"></a><a class="a2a_dd" target="_blank" rel="noopener" href="https://www.addtoany.com/share"></a></div></div><script async="async" src="https://static.addtoany.com/menu/page.js"></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/Game-Engine-0-to-1-00-Nothing-s-Here/" title="Game Engine 0 to 1 (00): Nothing's Here"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/07/01.jpeg" onerror="onerror=null;src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Game Engine 0 to 1 (00): Nothing's Here</div></div><div class="info-2"><div class="info-item-1">Game Engine Series 00: Prologue</div></div></div></a><a class="pagination-related" href="/posts/Thoughts-on-Black-Hand-Strategy/" title="Thoughts on Black Hand Strategy"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/posts/Thoughts-on-Black-Hand-Strategy.jpg" onerror="onerror=null;src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Thoughts on Black Hand Strategy</div></div><div class="info-2"><div class="info-item-1">A summary of my experience with the Black Hand in Command & Conquer 3: Kane's Wrath</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/Network-Settings-for-WSL/" title="Network Settings for WSL"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/06/12.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Apr. 18th, 2024 - 22:24:10</div><div class="info-item-2">Network Settings for WSL</div></div><div class="info-2"><div class="info-item-1">Configure network connection for WSL</div></div></div></a><a class="pagination-related" href="/posts/Extract-CnC3-Unit-Voices/" title="Extract C&amp;C3 Unit Voices"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/posts/Extract-C-C3-Unit-Voices.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> May. 7th, 2023 - 16:14:05</div><div class="info-item-2">Extract C&amp;C3 Unit Voices</div></div><div class="info-2"><div class="info-item-1">Extract Unit Voice in C&C3</div></div></div></a><a class="pagination-related" href="/posts/Kane-s-Wrath-Launch-Error-Troubleshoot/" title="Kane&#39;s Wrath Launch Error Troubleshoot"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/posts/Kanes-Wrath-Launch-Error-Troubleshoot.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Aug. 26th, 2024 - 09:57:19</div><div class="info-item-2">Kane&#39;s Wrath Launch Error Troubleshoot</div></div><div class="info-2"><div class="info-item-1">Troubleshoot launch error for Command & Conquer 3: Kane's Wrath</div></div></div></a><a class="pagination-related" href="/posts/Thoughts-on-Black-Hand-Strategy/" title="Thoughts on Black Hand Strategy"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/posts/Thoughts-on-Black-Hand-Strategy.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Feb. 28th, 2025 - 20:37:42</div><div class="info-item-2">Thoughts on Black Hand Strategy</div></div><div class="info-2"><div class="info-item-1">A summary of my experience with the Black Hand in Command & Conquer 3: Kane's Wrath</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/avatar.png" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/missing.gif'" alt="avatar"/></div><div class="author-info-name">Tony Lewis</div><div class="author-info-description">Do or do not. There is no try.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">94</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">85</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">41</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Lord-Turmoil" target="_blank" title="Github"><i class="fa-brands fa-github"></i></a><a class="social-icon" href="mailto:swift-phantom@outlook.com" target="_blank" title="Email"><i class="fa-solid fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/2030942344" target="_blank" title="BiliBili"><i class="fa-brands fa-bilibili"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">It won't be long before the armies of the Republic track us here.<br>You can visit this site at both:<li><a href="http://blog.tonys-studio.top/" target="_blank">Main Site</a></li><li><a href="https://lord-turmoil.github.io/" target="_blank">Github Mirror Site</a></li></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Prologue"><span class="toc-text">Prologue</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-text">References</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NAT"><span class="toc-text">NAT</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-NAT"><span class="toc-text">What is NAT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Different-Types-of-NAT"><span class="toc-text">Different Types of NAT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Full-Cone-NAT"><span class="toc-text">Full Cone NAT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Address-Restricted-Cone-NAT"><span class="toc-text">(Address) Restricted Cone NAT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Port-Restricted-Cone-NAT"><span class="toc-text">Port Restricted Cone NAT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Symmetric-NAT"><span class="toc-text">Symmetric NAT</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NAT-Traversal"><span class="toc-text">NAT Traversal</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-NAT-Impact-P2P"><span class="toc-text">How NAT Impact P2P</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Establishing-A-P2P-Connection"><span class="toc-text">Establishing A P2P Connection</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#VPN"><span class="toc-text">VPN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-VPN"><span class="toc-text">What is VPN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-VPN-Makes-P2P-Possible"><span class="toc-text">How VPN Makes P2P Possible</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VPN-or-Proxy"><span class="toc-text">VPN or Proxy</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Virtual-LAN-with-Zerotier"><span class="toc-text">Virtual LAN with Zerotier</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Setting-Up-VLAN"><span class="toc-text">Setting Up VLAN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Joining-VLAN"><span class="toc-text">Joining VLAN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Launching-the-Moon"><span class="toc-text">Launching the Moon</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Install-Zerotier"><span class="toc-text">Install Zerotier</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Configure-Moon"><span class="toc-text">Configure Moon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Orbiting-Around-the-Moon"><span class="toc-text">Orbiting Around the Moon</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Zerotier-Troubleshoot"><span class="toc-text">Zerotier Troubleshoot</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#VPN-with-OpenVPN"><span class="toc-text">VPN with OpenVPN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Install-OpenVPN-Server"><span class="toc-text">Install OpenVPN Server</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Install-OpenVPN-Client"><span class="toc-text">Install OpenVPN Client</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OpenVPN-Troubleshoot"><span class="toc-text">OpenVPN Troubleshoot</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Have-Fun%F0%9F%8E%89"><span class="toc-text">Have Fun🎉</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Play-with-Zerotier"><span class="toc-text">Play with Zerotier</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Play-with-VPN"><span class="toc-text">Play with VPN</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Epilogue"><span class="toc-text">Epilogue</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/Lambda-Calculus-A-Preliminary-View/" title="Lambda Calculus: A Preliminary View"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/01/05.jpeg" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="Lambda Calculus: A Preliminary View"/></a><div class="content"><a class="title" href="/posts/Lambda-Calculus-A-Preliminary-View/" title="Lambda Calculus: A Preliminary View">Lambda Calculus: A Preliminary View</a><time datetime="2025-09-16T08:25:34.000Z" title="Created Sep. 16th, 2025 - 16:25:34 16:25:34">Sep. 16th, 2025 - 16:25:34</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Music-Notation-with-Avid-Sibelius/" title="Music Notation With Avid Sibelius"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/posts/Music-Notation-with-Avid-Sibelius.jpg" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="Music Notation With Avid Sibelius"/></a><div class="content"><a class="title" href="/posts/Music-Notation-with-Avid-Sibelius/" title="Music Notation With Avid Sibelius">Music Notation With Avid Sibelius</a><time datetime="2025-09-03T04:34:54.000Z" title="Created Sep. 3rd, 2025 - 12:34:54 12:34:54">Sep. 3rd, 2025 - 12:34:54</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Getting-Started-with-Coq/" title="Getting Started With Coq"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/10/04.jpeg" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="Getting Started With Coq"/></a><div class="content"><a class="title" href="/posts/Getting-Started-with-Coq/" title="Getting Started With Coq">Getting Started With Coq</a><time datetime="2025-08-08T04:30:12.000Z" title="Created Aug. 8th, 2025 - 12:30:12 12:30:12">Aug. 8th, 2025 - 12:30:12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Game-Engine-0-to-1-02-Something-on-the-Screen/" title="Game Engine 0 to 1 (02): Something on the Screen"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/15/03.jpeg" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="Game Engine 0 to 1 (02): Something on the Screen"/></a><div class="content"><a class="title" href="/posts/Game-Engine-0-to-1-02-Something-on-the-Screen/" title="Game Engine 0 to 1 (02): Something on the Screen">Game Engine 0 to 1 (02): Something on the Screen</a><time datetime="2025-07-04T12:07:57.000Z" title="Created Jul. 4th, 2025 - 20:07:57 20:07:57">Jul. 4th, 2025 - 20:07:57</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Game-Engine-0-to-1-01-It-Starts-Now/" title="Game Engine 0 to 1 (01): It Starts Now"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/21/10.jpeg" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="Game Engine 0 to 1 (01): It Starts Now"/></a><div class="content"><a class="title" href="/posts/Game-Engine-0-to-1-01-It-Starts-Now/" title="Game Engine 0 to 1 (01): It Starts Now">Game Engine 0 to 1 (01): It Starts Now</a><time datetime="2025-06-01T06:45:32.000Z" title="Created Jun. 1st, 2025 - 14:45:32 14:45:32">Jun. 1st, 2025 - 14:45:32</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/02/11.jpeg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Tony Lewis</span></div><div class="footer_custom_text">No bird soars too high if he soars on his own wings</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'forest'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  let initFn = window.walineFn || null
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const destroyWaline = ele => ele.destroy()

  const initWaline = (Fn, el = document, path = window.location.pathname) => {
    const waline = Fn({
      el: el.querySelector('#waline-wrap'),
      serverURL: 'https://comment.tonys-studio.top',
      pageview: true,
      dark: 'html[data-theme="dark"]',
      comment: true,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    if (isShuoshuo) {
      window.shuoshuoComment.destroyWaline = () => {
        destroyWaline(waline)
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const loadWaline = (el, path) => {
    if (initFn) initWaline(initFn, el, path)
    else {
      btf.getCSS('https://cdn.jsdelivr.net/npm/@waline/client@2/dist/waline.min.css')
        .then(() => import('https://cdn.jsdelivr.net/npm/@waline/client@2/dist/waline.min.js'))
        .then(({ init }) => {
          initFn = init || Waline.init
          initWaline(initFn, el, path)
          window.walineFn = initFn
        })
    }
  }

  if (isShuoshuo) {
    'Waline' === 'Waline'
      ? window.shuoshuoComment = { loadComment: loadWaline } 
      : window.loadOtherComment = loadWaline
    return
  }

  if ('Waline' === 'Waline' || !false) {
    if (false) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script></div><script src="/static/custom.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading Database</span></div><div class="local-search-input"><input placeholder="Anything you would like to search?🔍" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer');
    var item_html = '<p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="Framework Hexo" title=""><img src="https://img.shields.io/badge/Frame-Hexo%205.4.2-blue?style=flat-square&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="Theme Butterfly" title=""><img src="https://img.shields.io/badge/Theme-Butterfly%205.4.3-6513df?style=flat-square&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="All articles in this blog are licensed under CC BY-NC-SA 4.0 unless stating additionally." title=""><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat-square&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><!-- hexo injector body_end end --></body></html>