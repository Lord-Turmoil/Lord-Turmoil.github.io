<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Inter-Process Communication | TONY'S STUDIO</title><meta name="author" content="Tony Lewis"><meta name="copyright" content="Tony Lewis"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#300303"><meta name="description" content="Chapter Seven - Inter Process Communication">
<meta property="og:type" content="article">
<meta property="og:title" content="Inter-Process Communication">
<meta property="og:url" content="https://blog.tonys-studio.top/posts/Inter-Process-Communication/">
<meta property="og:site_name" content="TONY&#39;S STUDIO">
<meta property="og:description" content="Chapter Seven - Inter Process Communication">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/22/13.jpeg">
<meta property="article:published_time" content="2023-01-04T09:56:03.000Z">
<meta property="article:modified_time" content="2025-09-03T04:38:21.592Z">
<meta property="article:author" content="Tony Lewis">
<meta property="article:tag" content="C&#x2F;C++">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="BUAA">
<meta property="article:tag" content="System Programming">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/22/13.jpeg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Inter-Process Communication",
  "url": "https://blog.tonys-studio.top/posts/Inter-Process-Communication/",
  "image": "https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/22/13.jpeg",
  "datePublished": "2023-01-04T09:56:03.000Z",
  "dateModified": "2025-09-03T04:38:21.592Z",
  "author": [
    {
      "@type": "Person",
      "name": "Tony Lewis",
      "url": "https://tonys-studio.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/favicon.svg"><link rel="canonical" href="https://blog.tonys-studio.top/posts/Inter-Process-Communication/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//www.clarity.ms"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="codeva-R6O16YoeQt"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#300303')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?68629f5da0a0c3347b896920fbf164b5";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
btf.addGlobalFn('pjaxComplete', () => {
  _hmt.push(['_trackPageview',window.location.pathname])
}, 'baidu_analytics')
</script><script>(function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
})(window, document, "clarity", "script", "sthrplbt7c");
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":10,"unescape":false,"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":256,"languages":{"author":"Author: Tony Lewis","link":"Link: ","source":"Source: TONY'S STUDIO","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#871798","bgDark":"#C81025","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Inter-Process Communication',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/custom.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-butterfly-footer-beautify@1.0.6/lib/runtime.min.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/css/barber-shop.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/background.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/avatar.png" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/missing.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">93</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">84</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">40</div></a></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-newspaper"></i><span> Posts</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-jedi fa-beat"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/22/13.jpeg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/logo.svg" alt="Logo"><span class="site-name">TONY'S STUDIO</span></a><a class="nav-page-title" href="/"><span class="site-name">Inter-Process Communication</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-newspaper"></i><span> Posts</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-jedi fa-beat"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Inter-Process Communication</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-01-04T09:56:03.000Z" title="Created Jan. 4th, 2023 - 17:56:03 17:56:03">Jan. 4th, 2023 - 17:56:03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-09-03T04:38:21.592Z" title="Updated Sep. 3rd, 2025 - 12:38:21 12:38:21">Sep. 3rd, 2025 - 12:38:21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/BUAA/">BUAA</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/BUAA/System-Programming/">System Programming</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">3.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>20mins</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span class="waline-pageview-count" data-path="/posts/Inter-Process-Communication/"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">Comments:</span><a href="/posts/Inter-Process-Communication/#post-comment"><span class="waline-comment-count" data-path="/posts/Inter-Process-Communication/"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 style="text-align: center; font-size: 4em"><b>System Programming</b></h1>



<p style="text-align: center; font-size: 2em"><i>" One vision, one purpose. "</i></p>

<p style="text-align: center">Copyright &copy; Tony's Studio 2020 - 2022</p>

<hr>
<h1 id="Chapter-Seven-Inter-Process-Communication"><a href="#Chapter-Seven-Inter-Process-Communication" class="headerlink" title="Chapter Seven - Inter Process Communication"></a>Chapter Seven - Inter Process Communication</h1><blockquote>
<p>This is where the fun begins. There are several ways to communicate between two, or more processes.</p>
<table>
<thead>
<tr>
<th align="center">IPC</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Pipe</td>
<td align="center">The most simple one, but not that powerful.</td>
</tr>
<tr>
<td align="center">Signal</td>
<td align="center">This is simple, too, but not enough information.</td>
</tr>
<tr>
<td align="center">Semaphore</td>
<td align="center">Sync or mutual exclusion method for inter-process, or inter-thread communication.</td>
</tr>
<tr>
<td align="center">Message Queue</td>
<td align="center">a.k.a. 消息队列, including POSIX one and System V one.</td>
</tr>
<tr>
<td align="center">Shared Memory</td>
<td align="center">Share common memory with other processes, the fastest IPC method.</td>
</tr>
<tr>
<td align="center">Socket</td>
<td align="center">More general, can be used between different computer.</td>
</tr>
</tbody></table>
</blockquote>
<h2 id="7-1-Pipe"><a href="#7-1-Pipe" class="headerlink" title="7.1 Pipe"></a>7.1 Pipe</h2><blockquote>
<p>Pipe is the basic method for two processes to communicate with each other. Anonymous pipe can only be used between parent and child, though.</p>
<p>An anonymous pipe can be created with <code>pipe()</code>, <code>pipe[0]</code> is in and <code>pipe[1]</code> is out. Parent closes <code>pipe[0]</code> and output to <code>pipe[1]</code>, while child read in from <code>pipe[0]</code> and closes <code>pipe[1]</code>. <code>pipe()</code> should be called before <code>fork()</code> and <code>fork()</code> will duplicate file description at the same time.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">pipe</span><span class="params">(<span class="type">int</span> pipe[<span class="number">2</span>])</span>;</span><br></pre></td></tr></table></figure>

<p>Here is a comprehensive example for pipe, all error checks were removed. Err… Eratosthenes sieve for prime numbers. For more information, check this out: <a target="_blank" rel="noopener" href="https://swtch.com/~rsc/thread/">https://swtch.com/~rsc/thread/</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;wait.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">sieve</span><span class="params">(<span class="type">int</span> oldfd[])</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> n = atoi(argv[<span class="number">1</span>]);</span><br><span class="line">	<span class="type">int</span> fd[<span class="number">2</span>];</span><br><span class="line">	pipe(fd);</span><br><span class="line">	<span class="keyword">if</span> (fork() &gt; <span class="number">0</span>)               <span class="comment">// the root!</span></span><br><span class="line">	&#123;</span><br><span class="line">		close(fd[<span class="number">0</span>]);   <span class="comment">// close in</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">			write(fd[<span class="number">1</span>], &amp;i, <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">		close(fd[<span class="number">1</span>]);   <span class="comment">// close out, or the child won&#x27;t stop reading</span></span><br><span class="line">		waitpid(ret, <span class="literal">NULL</span>, <span class="number">0</span>);          <span class="comment">// wait for its child</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		sieve(fd);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">sieve</span><span class="params">(<span class="type">int</span> oldfd[])</span></span><br><span class="line">&#123;</span><br><span class="line">	close(oldfd[<span class="number">1</span>]);        <span class="comment">// close old write</span></span><br><span class="line">	<span class="type">int</span> prime;</span><br><span class="line">   	<span class="comment">// Read one first, to check if it&#x27;s neccessary to</span></span><br><span class="line">	<span class="comment">// create a new process.</span></span><br><span class="line">	<span class="keyword">if</span> (read(oldfd[<span class="number">0</span>], &amp;prime, <span class="keyword">sizeof</span>(<span class="type">int</span>)) == <span class="number">0</span>)   <span class="comment">// nothing to read...</span></span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	<span class="type">int</span> num;</span><br><span class="line">	<span class="type">int</span> fd[<span class="number">2</span>];                      <span class="comment">// new fd</span></span><br><span class="line">	pipe(fd);</span><br><span class="line">	<span class="keyword">if</span> (fork() &gt; <span class="number">0</span>)               <span class="comment">// parent</span></span><br><span class="line">	&#123;</span><br><span class="line">		close(fd[<span class="number">0</span>]);			<span class="comment">// close new in as parent</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, prime);	 <span class="comment">// print prime</span></span><br><span class="line">		<span class="comment">// read from old</span></span><br><span class="line">		<span class="keyword">while</span> (read(oldfd[<span class="number">0</span>], &amp;num, <span class="keyword">sizeof</span>(<span class="type">int</span>)) == <span class="keyword">sizeof</span>(<span class="type">int</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (num % prime != <span class="number">0</span>)</span><br><span class="line">				write(fd[<span class="number">1</span>], &amp;num, <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">		&#125;</span><br><span class="line">		close(fd[<span class="number">1</span>]);</span><br><span class="line">		waitpid(ret, <span class="literal">NULL</span>, <span class="number">0</span>);  <span class="comment">// wait for its child</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>    <span class="comment">// child</span></span><br><span class="line">		sieve(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</blockquote>
<h2 id="7-2-Signal"><a href="#7-2-Signal" class="headerlink" title="7.2 Signal"></a>7.2 Signal</h2><h3 id="7-2-1-Meet-Signal"><a href="#7-2-1-Meet-Signal" class="headerlink" title="7.2.1 Meet Signal"></a>7.2.1 Meet Signal</h3><h4 id="7-2-1-1-What-Is-Signal"><a href="#7-2-1-1-What-Is-Signal" class="headerlink" title="7.2.1.1 What Is Signal?"></a>7.2.1.1 What Is Signal?</h4><blockquote>
<p>Signal: 信号是 Linux 操作系统中进程之间一种通信方式，信号传递一种<strong>信息</strong>，接收方根据该信息进行相应的<strong>动作</strong>，可用于控制信息的传递，本质是一种<strong>软中断</strong>。e.g. 当发生某种情况时通知进程进行处理。</p>
<p>Signal can be raised by the process itself or come from outside.</p>
</blockquote>
<h4 id="7-2-1-2-Purpose-of-Signal"><a href="#7-2-1-2-Purpose-of-Signal" class="headerlink" title="7.2.1.2 Purpose of Signal"></a>7.2.1.2 Purpose of Signal</h4><blockquote>
<ol>
<li>让进程知道发生了某种事件；</li>
<li>据该事件执行相应的动作即执行它自己代码中的信号处理程序。</li>
</ol>
</blockquote>
<h4 id="7-2-1-3-Types-of-Signal"><a href="#7-2-1-3-Types-of-Signal" class="headerlink" title="7.2.1.3 Types of Signal"></a>7.2.1.3 Types of Signal</h4><blockquote>
<p>Signals are defined in <code>signal.h</code> and can be listed out by <code>kill -l</code> command. Usually begin with <code>SIG</code> and are all macros.</p>
</blockquote>
<h4 id="7-2-1-4-Source-of-Signal"><a href="#7-2-1-4-Source-of-Signal" class="headerlink" title="7.2.1.4 Source of Signal"></a>7.2.1.4 Source of Signal</h4><blockquote>
<p>Signals all come from kernel, and we just ask kernel to generate or send it for us. And such requests can come in three ways:</p>
<ol>
<li>user: <code>Ctrl-C</code>, <code>Ctrl-\</code>, etc.</li>
<li>kernel: when error encountered, or to notice certain process, e.g. Segmentation Fault (<code>SIGSEGV</code>), Alarm time up (<code>SIGALRM</code>).</li>
<li>process: call system function <code>kill</code> to send a signal.</li>
</ol>
<p>User can send signal to a process by keyboard.</p>
<table>
<thead>
<tr>
<th align="center">keyboard</th>
<th align="center">signal</th>
<th align="center">meaning</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>Ctrl-C</code></td>
<td align="center"><code>SIGINT</code></td>
<td align="center">interrupt, to terminate the process by defualt</td>
</tr>
<tr>
<td align="center"><code>Ctrl-\</code></td>
<td align="center"><code>SIGQUIT</code></td>
<td align="center">quit process</td>
</tr>
<tr>
<td align="center"><code>Ctrl-Z</code></td>
<td align="center"><code>SIGTSTP</code></td>
<td align="center">to stop a process, then can be continued by sending <code>SIGCONT</code></td>
</tr>
</tbody></table>
<p>Notice that <code>SIGTSTP</code> is similar to <code>SIGSTOP</code>, but <code>SIGSTOP</code> can not be blocked or ignored, while <code>SIGTSTP</code> could.</p>
</blockquote>
<h3 id="7-2-2-Status-of-Signal"><a href="#7-2-2-Status-of-Signal" class="headerlink" title="7.2.2 Status of Signal"></a>7.2.2 Status of Signal</h3><blockquote>
<blockquote>
<p>Delivery: 递送，当进程对信号<strong>采取动作</strong>（执行信号处理函数或忽略）时称为递送。</p>
<p>Pending: 信号<strong>产生和递送之间</strong>的时间间隔内称信号是<strong>未决</strong>的。</p>
<p>Block: 信号递送阻塞，进程可指定对某个信号采用<strong>递送阻塞</strong>，若此时信号处理为默认或者捕捉的，该信号就会处于未决的状态。</p>
</blockquote>
<p>信号未决状态是指从信号产生到起作用之间的状态，信号在未决状态时已经产生，但是并没有起作用，可以在不需要该信号时阻止信号被处理。一旦信号退出未决状态，则会被立即处理。</p>
</blockquote>
<h3 id="7-2-3-Respose-to-Signal"><a href="#7-2-3-Respose-to-Signal" class="headerlink" title="7.2.3 Respose to Signal"></a>7.2.3 Respose to Signal</h3><blockquote>
<p>There are three types of response to a signal, as follows.</p>
<ol>
<li>缺省操作：Linux 对每种信号都规定了默认操作，如果没有特殊说明，就按照默认的方式执行。</li>
<li>忽略信号：对信号不做处理，假装看不见，但是有两个信号不能忽略，即 <code>SIGKILL</code> 和 <code>SIGSTOP</code>。</li>
<li>捕捉信号：捕捉响应的信号，进行函数处理。<code>SIGKILL</code> 和 <code>SIGSTOP</code> 也不可以捕捉。</li>
</ol>
</blockquote>
<h3 id="7-2-3-Classification-of-Signal"><a href="#7-2-3-Classification-of-Signal" class="headerlink" title="7.2.3 Classification of Signal"></a>7.2.3 Classification of Signal</h3><h4 id="7-2-3-1-By-Source"><a href="#7-2-3-1-By-Source" class="headerlink" title="7.2.3.1 By Source"></a>7.2.3.1 By Source</h4><blockquote>
<p>同步信号：由进程的某个操作产生的信号，即信号的产生和操作同时发生。e.g. 除零错误。</p>
<p>异步信号：由进程外的事件引起的信号，该信号产生的时间进程不可控。e.g. 用户键盘时间。</p>
</blockquote>
<h4 id="7-2-3-2-By-Handle-Behavior"><a href="#7-2-3-2-By-Handle-Behavior" class="headerlink" title="7.2.3.2 By Handle Behavior"></a>7.2.3.2 By Handle Behavior</h4><blockquote>
<p>不可靠信号：同时有多个信号产生，且无法及时处理时，会导致信号丢失。</p>
<p>可靠信号：不是不可靠信号的信号，来不及处理时会排入进程信号队列。</p>
<p>值小于 <code>SIGRTMIN</code> 的信号为不可靠信号，建立在 UNIX 早期机制上，<code>SIGRTMIN</code> 到 <code>SIGRTMAX</code> 的信号为可靠信号。</p>
</blockquote>
<h4 id="7-2-3-3-Real-Time-Signal"><a href="#7-2-3-3-Real-Time-Signal" class="headerlink" title="7.2.3.3 Real-Time Signal"></a>7.2.3.3 Real-Time Signal</h4><blockquote>
<p>Linux 目前有 64 种信号，前 32 种为非实时信号，后 32 种为实时信号。</p>
<p>非实时信号都不支持排队，都不可靠。实时信号都支持排队，都可靠。</p>
<p><em>It seems that real-time signal and reliable signal are the same?</em></p>
</blockquote>
<h3 id="7-2-4-Handling-of-Signal"><a href="#7-2-4-Handling-of-Signal" class="headerlink" title="7.2.4 Handling of Signal"></a>7.2.4 Handling of Signal</h3><h4 id="7-2-4-1-signal"><a href="#7-2-4-1-signal" class="headerlink" title="7.2.4.1 signal"></a>7.2.4.1 signal</h4><blockquote>
<p>There are three ways to handle a signal, by registering different handler functions using <code>signal()</code> function. It returns the previous handler on success, or -1 on error. <code>sig</code> is the signal type except <code>SIGKILL</code> and <code>SIGSTOP</code>. It is passed automatically by signal mechanism and is exactly what we passed in <code>signal()</code>.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> (*signal(<span class="type">int</span> sig, <span class="type">void</span> (*handler)(<span class="type">int</span>)))(<span class="type">int</span>);</span><br></pre></td></tr></table></figure>

<p>There are two system handlers, <code>SIG_DFL</code> is the default handler of the system, and <code>SIG_IGN</code> means ignore the signal.</p>
<p>After handling, the handler will be reset to default, so we need to re-hook it again.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">handler</span><span class="params">(<span class="type">int</span> sig)</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="comment">// Handling...</span></span><br><span class="line"> signal(sig, handler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="7-2-4-2-sigaction"><a href="#7-2-4-2-sigaction" class="headerlink" title="7.2.4.2 sigaction"></a>7.2.4.2 sigaction</h4><blockquote>
<p><code>sigaction</code> provides a more powerful way to handle signal, and is compatible with old method. If you do not want to keep old handler, just leave it <code>NULL</code>.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/siginfo.h&gt;</span> <span class="comment">// actually doesn&#x27;t need</span></span></span><br><span class="line"><span class="class"><span class="keyword">union</span> <span class="title">sigval</span> &#123;</span></span><br><span class="line">	<span class="type">int</span> sival_int;</span><br><span class="line">	<span class="type">void</span> *sival_ptr;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">	<span class="class"><span class="keyword">union</span> <span class="title">sigval</span> <span class="title">si_value</span>;</span></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125; <span class="type">siginfo_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sigaction</span> &#123;</span></span><br><span class="line">	<span class="type">void</span> (*sa_handler)(<span class="type">int</span>);</span><br><span class="line">	<span class="type">sigset_t</span> sa_mask;</span><br><span class="line">	<span class="type">int</span> sa_flags;</span><br><span class="line">	<span class="type">void</span> (*sa_sigaction)(<span class="type">int</span>, <span class="type">siginfo_t</span> *, <span class="type">void</span> *);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> <span class="title function_">sigaction</span><span class="params">(<span class="type">int</span> sig, <span class="type">const</span> <span class="keyword">struct</span> sigaction *new, <span class="keyword">struct</span> sigaction *old)</span>;</span><br></pre></td></tr></table></figure>

<p><code>sa_handler</code> is the old style, while <code>sa_sigaction</code> is the new style, which to use depends on the value of <code>sa_flags</code>. The new style can then access <code>siginfo_t::si_value::sival_int</code>, while <code>siginfo_t::si_value::si_prt</code> is only available when in the same process or shared memory is used.</p>
<table>
<thead>
<tr>
<th align="center"><code>sa_flags</code></th>
<th align="center">meaning</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>SA_RESETHAND</code></td>
<td align="center">reset handler after handling, a.k.a. 捕鼠器模式</td>
</tr>
<tr>
<td align="center"><code>SA_NODEFER</code></td>
<td align="center">close auto-block when handling, allow recursive</td>
</tr>
<tr>
<td align="center"><code>SA_RESTART</code></td>
<td align="center">restart system call if failed</td>
</tr>
<tr>
<td align="center"><code>SA_SIGINFO</code></td>
<td align="center">use new style, if not assigned, old style will be used</td>
</tr>
</tbody></table>
</blockquote>
<h3 id="7-2-5-Block-Signal"><a href="#7-2-5-Block-Signal" class="headerlink" title="7.2.5 Block Signal"></a>7.2.5 Block Signal</h3><blockquote>
<p>任何时候进程都有一些信号被<strong>阻塞</strong>，这个信号的集合被称为<strong>信号挡板</strong>，系统调用 <code>sigprocmask()</code> 可修改这个被阻塞的信号集。<code>sigprocmask</code> 是一个<strong>原子操作</strong>，根据所给的信号集来修改当前被阻塞的信号集。</p>
</blockquote>
<h4 id="7-2-5-1-Signal-Set"><a href="#7-2-5-1-Signal-Set" class="headerlink" title="7.2.5.1 Signal Set"></a>7.2.5.1 Signal Set</h4><blockquote>
<p>To block signal, we need to indicate which set of signal to block or unblock.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">sigemptyset</span><span class="params">(<span class="type">sigset_t</span> *setp)</span>;          <span class="comment">// remove all signals int the set</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">sigfillset</span><span class="params">(<span class="type">sigset_t</span> *setp)</span>;           <span class="comment">// add all signalas to the set</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">sigaddset</span><span class="params">(<span class="type">sigset_t</span> *setp, <span class="type">int</span> sig)</span>;   <span class="comment">// add a signal to the set</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">sigdelset</span><span class="params">(<span class="type">sigset_t</span> *setp, <span class="type">int</span> sig)</span>;   <span class="comment">// remove a signal from the set</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">sigismember</span><span class="params">(<span class="type">sigset_t</span> *setp, <span class="type">int</span> sig)</span>; <span class="comment">// check if a signal is in the set or not</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="7-2-5-2-Mask-Signals"><a href="#7-2-5-2-Mask-Signals" class="headerlink" title="7.2.5.2 Mask Signals"></a>7.2.5.2 Mask Signals</h4><blockquote>
<p>If we want, or do not want some signals to be handled, we can unblock or block them use <code>sigprocmask()</code>. <code>prev</code> will be set to previous signal set if roll back is needed. <code>how</code> indicates how to treat the signal set, it has three values: <code>SIG_BLOCK</code>, <code>SIG_UNBLOCK</code> and <code>SIG_SET</code>.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">sigprocmask</span><span class="params">(<span class="type">int</span> how, <span class="type">const</span> <span class="type">sigset_t</span> *sigs, <span class="type">sigset_t</span> *prev)</span>;</span><br></pre></td></tr></table></figure>


</blockquote>
<h3 id="7-2-6-Send-Signal"><a href="#7-2-6-Send-Signal" class="headerlink" title="7.2.6 Send Signal"></a>7.2.6 Send Signal</h3><blockquote>
<p>Remember, signal can be sent by a process. There are generally three ways to send a signal: <code>kill</code>, <code>raise</code> and <code>sigqueue</code>. All of them requires <code>signal.h</code> and <code>sys/types.h</code> (for <code>pid_t</code>).</p>
</blockquote>
<h4 id="7-2-6-1-kill"><a href="#7-2-6-1-kill" class="headerlink" title="7.2.6.1 kill"></a>7.2.6.1 kill</h4><blockquote>
<p>Just like, ya know, the command, send a signal to target process.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">kill</span> <span class="params">(<span class="type">pid_t</span> pid, <span class="type">int</span> sig)</span>;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="7-2-6-2-raise"><a href="#7-2-6-2-raise" class="headerlink" title="7.2.6.2 raise"></a>7.2.6.2 raise</h4><blockquote>
<p>Similar to kill, but this one send signal to itself.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">raise</span><span class="params">(<span class="type">int</span> sig)</span>;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="7-2-6-3-sigqueue"><a href="#7-2-6-3-sigqueue" class="headerlink" title="7.2.6.3 sigqueue"></a>7.2.6.3 sigqueue</h4><blockquote>
<p>This one works with [<code>sigaction</code>](#7.2.4.2 sigaction), it will send a signal with <code>siginfo_t</code>, whose <code>si_value</code> is set to <code>value</code>. And the corresponding handler should be new style, and pay attention to the value.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sigqueue</span><span class="params">(<span class="type">pid_t</span> pid, <span class="type">int</span> sig, <span class="type">const</span> <span class="keyword">union</span> sigval value)</span>;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="7-2-7-Signal-Process-Inheritance"><a href="#7-2-7-Signal-Process-Inheritance" class="headerlink" title="7.2.7 Signal Process Inheritance"></a>7.2.7 Signal Process Inheritance</h3><blockquote>
<p>By default, child process will inherit all the handlers of parent process. However, if child process then calls exec function series, the signal handlers will be reset to default.</p>
</blockquote>
<h3 id="7-2-8-Reentrant"><a href="#7-2-8-Reentrant" class="headerlink" title="7.2.8 Reentrant"></a>7.2.8 Reentrant</h3><blockquote>
<p>Definition: 某个函数可被多个任务并发使用，而不会造成数据错误，则该函数具有可重入性（Reentrant） 。</p>
<p>信号处理函数中，避免使用不可重入函数，因为信号处理函数有可能被调用多次。若处理函数使用了不可重入函数而变成不可重入时，则必须阻塞信号，若阻塞信号，则信号有可能丢失。</p>
<p>可重入函数中不能使用静态变量，不能使用 malloc&#x2F;free函数和标准I&#x2F;O库，使用全局变量时也应小心。</p>
</blockquote>
<h3 id="7-2-9-Applications"><a href="#7-2-9-Applications" class="headerlink" title="7.2.9 Applications"></a>7.2.9 Applications</h3><h4 id="7-2-9-1-Prevent-Zombie-Process"><a href="#7-2-9-1-Prevent-Zombie-Process" class="headerlink" title="7.2.9.1 Prevent Zombie Process"></a>7.2.9.1 Prevent Zombie Process</h4><blockquote>
<p>When child process exits, it will send a <code>SIGCHLD</code> signal to its parent. By default, this signal is ignored. So parent can register a handler to this to do its own stuff, and take care of dead children only when needed to avoid waste of time on waiting.</p>
</blockquote>
<h2 id="7-3-Semaphore"><a href="#7-3-Semaphore" class="headerlink" title="7.3 Semaphore"></a>7.3 Semaphore</h2><h3 id="7-3-1-Synchronization-and-Mutual-Exclusion"><a href="#7-3-1-Synchronization-and-Mutual-Exclusion" class="headerlink" title="7.3.1 Synchronization and Mutual Exclusion"></a>7.3.1 Synchronization and Mutual Exclusion</h3><blockquote>
<p>Before we take a glance at semaphore, let review some concepts.</p>
<table>
<thead>
<tr>
<th align="center">Term</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center">临界资源</td>
<td align="center">临界资源在某一时刻只能允许一个进程使用</td>
</tr>
<tr>
<td align="center">临界区</td>
<td align="center">访问临界资源的代码段称为临界区</td>
</tr>
<tr>
<td align="center">同步（Synchronization）</td>
<td align="center">进程之间相互依赖，一个进程必须等待另一个进程</td>
</tr>
<tr>
<td align="center">互斥（Mutual Exclusion）</td>
<td align="center">进程间相互排斥的使用临界资源的现象</td>
</tr>
</tbody></table>
</blockquote>
<h3 id="7-3-2-POSIX-vs-System-V"><a href="#7-3-2-POSIX-vs-System-V" class="headerlink" title="7.3.2 POSIX vs System V"></a>7.3.2 POSIX vs System V</h3><blockquote>
<p>System V 是 Unix 操作系统的标准之一；POSIX 是 IEEE 的标准，相对更新，语法更简单。</p>
<p>System V 在同步互斥手段方面的无竞争条件下无论何时都会陷入内核，性能稍低；POSIX 在同步互斥手段方面的无竞争条件下是不会陷入内核的，性能较高。</p>
<p>System V 提供了 SEM_UNDO 可以在进程意外终止时释放信号量，可靠性高；POSIX 并没有实现，可靠性稍差。</p>
<p>System V 更多用于进程间通信，用于线程间通信则会丧失线程的轻量优势；POSIX 进程和线程间通信同步更优。</p>
<p>For more information, see <a target="_blank" rel="noopener" href="https://blog.csdn.net/xiaoting451292510/article/details/103819933">System V 标准 &amp; POSIX 标准</a>.</p>
</blockquote>
<h3 id="7-3-3-System-V-Semaphore"><a href="#7-3-3-System-V-Semaphore" class="headerlink" title="7.3.3 System V Semaphore"></a>7.3.3 System V Semaphore</h3><blockquote>
<p>For System V semaphore, it requires <code>sem.h</code>.</p>
</blockquote>
<h4 id="7-3-3-1-Create-Semaphore"><a href="#7-3-3-1-Create-Semaphore" class="headerlink" title="7.3.3.1 Create Semaphore"></a>7.3.3.1 Create Semaphore</h4><blockquote>
<p>To get a semaphore, use <code>semget()</code>, </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">**    key - semaphore key id, must be identical</span></span><br><span class="line"><span class="comment">**  nsems - how many semaphores to create</span></span><br><span class="line"><span class="comment">** semflg - behavior: IPC_CREAT, IPC_EXCL; permission: S_IRUSR | S_IWUSR (read and write)</span></span><br><span class="line"><span class="comment">** return - EACCES: process have no access premission</span></span><br><span class="line"><span class="comment">**          ENOENT: key doesn&#x27;t exists</span></span><br><span class="line"><span class="comment">**          EINVAL: nsems less than 0, or reaches maximum</span></span><br><span class="line"><span class="comment">**          EEXIST: when both IPC_CREAT and IPC_EXCL are assigned and key exists</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">semget</span><span class="params">(<span class="type">key_t</span> key, <span class="type">int</span> nsems, <span class="type">int</span> semflg)</span>;</span><br></pre></td></tr></table></figure>

<p>For the key, we often use <code>ftok()</code> to get an identical one, and System V use this <code>key_t</code> as a name for IPC object. It will generate hash value of pathname, which must exist, and combine it with id. Usually, current directory <code>./</code> is used with id equals zero.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/ipc.h&gt;</span></span></span><br><span class="line"><span class="type">key_t</span> <span class="title function_">ftok</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">int</span> id)</span>;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="7-3-3-2-Control-Semaphore"><a href="#7-3-3-2-Control-Semaphore" class="headerlink" title="7.3.3.2 Control Semaphore"></a>7.3.3.2 Control Semaphore</h4><blockquote>
<p>Semaphore can be represented as follows. I wonder why it is commented from Linux kernel.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">union</span> <span class="title">semun</span> &#123;</span></span><br><span class="line">	<span class="type">int</span> val;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">semid_ds</span>* <span class="title">buf</span>;</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">short</span>* <span class="built_in">array</span>;</span><br><span class="line">&#125; <span class="type">sem_t</span>;</span><br></pre></td></tr></table></figure>

<p>To control semaphore, we need <code>semctrl()</code>.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">**  semid - semaphore id get from semget()</span></span><br><span class="line"><span class="comment">** semnum - only valid when using semaphore set, usually 0, the first one</span></span><br><span class="line"><span class="comment">**    cmd - operation to the semaphore</span></span><br><span class="line"><span class="comment">**    ... - a sem_t value, used when operate semaphore.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">semctl</span><span class="params">(<span class="type">int</span> semid, <span class="type">int</span> semnum, <span class="type">int</span> cmd, ...)</span>;</span><br></pre></td></tr></table></figure>

<p>Common value for <code>cmd</code> are <code>SETVAL</code> and <code>IPC_RMID</code>.</p>
<table>
<thead>
<tr>
<th align="center"><code>cmd</code></th>
<th align="center">meaning</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>SETVAL</code></td>
<td align="center">initialize semaphore, 4th parameter is required</td>
</tr>
<tr>
<td align="center"><code>IPC_RMID</code></td>
<td align="center">remove semaphore of <code>semid</code>, <code>semnum</code> and 4th parameter are omitted</td>
</tr>
</tbody></table>
<p>When <code>IPC_RMID</code> is applied, all blocked process by the semaphore will be awaken.</p>
</blockquote>
<h4 id="7-3-3-3-Operate-Semaphore"><a href="#7-3-3-3-Operate-Semaphore" class="headerlink" title="7.3.3.3 Operate Semaphore"></a>7.3.3.3 Operate Semaphore</h4><blockquote>
<p>There are two types of operation, P and V. In Dutch, P stands for <code>Passeren</code> (Pass), and V stands for <code>Verhoog</code> (Increment). P will ask for resource, if not available, the current process will be forced to wait. V will release resource, to wake up waiting processes.</p>
<p>To operate semaphore, we need <code>semop()</code>.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Semaphore operation unit</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sembuf</span> &#123;</span></span><br><span class="line">	<span class="type">short</span> sem_num;	<span class="comment">// indicate which semaphore to change in semaphore array</span></span><br><span class="line">	<span class="type">short</span> sem_op;	<span class="comment">// -1 for P, and 1 for V</span></span><br><span class="line">	<span class="type">short</span> sem_flag;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** semid - semaphore id get from semget()</span></span><br><span class="line"><span class="comment">**  sops - operation array</span></span><br><span class="line"><span class="comment">** nsops - how many operations in sops</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">semop</span><span class="params">(<span class="type">int</span> semid, <span class="keyword">struct</span> sembuf *sops, <span class="type">unsigned</span> nsops)</span>;</span><br></pre></td></tr></table></figure>

<p>For <code>sops</code>, usually,  there is only one operation, and for the operation <code>sembuf</code>, <code>sem_num</code> is the same meaning as <code>semnum</code> in <code>semctl</code>, and <code>sem_flag</code> is often set to <code>SEM_UNDO</code>, to release semaphore automatically on process exit if forget to do so.</p>
</blockquote>
<h3 id="7-3-4-Application"><a href="#7-3-4-Application" class="headerlink" title="7.3.4 Application"></a>7.3.4 Application</h3><blockquote>
<p>Semaphore can used to coordinate processes for synchronization or mutual exclusion. More than one semaphore may be used. One example is with shared memory.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+: working</span><br><span class="line">-: waiting</span><br><span class="line"><span class="comment">// syncronization, execute in order, semaphore initialized to 0</span></span><br><span class="line"><span class="comment">// n processes need n semaphores, so they can execute in desired order</span></span><br><span class="line">ProcessA: +++++VP----- +++++VP ...</span><br><span class="line">ProcessB: P-----+++++V P-----+ ...</span><br><span class="line"><span class="comment">// mutual exclusion, compete over one resource, semaphore initialized to 1</span></span><br><span class="line"><span class="comment">// only one semaphore, one process may get the resource more than one time in a roll</span></span><br><span class="line">ProcessA: P+++++VP-----+++++VP+++++VP----- ...</span><br><span class="line">ProcessB: P------+++++VP------------+++++V ...</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="7-4-Message-Queue"><a href="#7-4-Message-Queue" class="headerlink" title="7.4 Message Queue"></a>7.4 Message Queue</h2><blockquote>
<p>Just maintain a queue from sender to receiver, easy to understand, huh?</p>
</blockquote>
<h3 id="7-4-1-Feature"><a href="#7-4-1-Feature" class="headerlink" title="7.4.1 Feature"></a>7.4.1 Feature</h3><blockquote>
<p>发送方不必等待接收方去接收该消息就可不断发送数 据，而接收方若未收到消息也无需等待。</p>
<p>这种方式实现了发送方和接收方之间的松耦合，发送方和接收方只需负责自己的发送和接收功能，无需等待另外一方，从而为应用程序提供了灵活性。</p>
</blockquote>
<h3 id="7-4-2-System-V-Message-Queue"><a href="#7-4-2-System-V-Message-Queue" class="headerlink" title="7.4.2 System V Message Queue"></a>7.4.2 System V Message Queue</h3><blockquote>
<p>Similar to System V semaphore, <del>Duh, both System V, come on</del>, and it requires <code>sys/msg.h</code>.</p>
</blockquote>
<h4 id="7-4-2-1-Create-Message-Queue"><a href="#7-4-2-1-Create-Message-Queue" class="headerlink" title="7.4.2.1 Create Message Queue"></a>7.4.2.1 Create Message Queue</h4><blockquote>
<p>Err… the same as semaphore.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">msgget</span> <span class="params">(<span class="type">key_t</span> key, <span class="type">int</span> msgflg)</span>;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="7-4-2-2-Control-Message-Queue"><a href="#7-4-2-2-Control-Message-Queue" class="headerlink" title="7.4.2.2 Control Message Queue"></a>7.4.2.2 Control Message Queue</h4><blockquote>
<p>Err… similar to semaphore.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">msgctl</span><span class="params">(<span class="type">int</span> msgid, <span class="type">int</span> cmd, <span class="keyword">struct</span> msgqid_ds *buf)</span>;</span><br></pre></td></tr></table></figure>

<p>Listen, I don’t want to get complicated here, for now, it is only used to delete message queue, simple, huh?</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msgctl(msgid, IPC_RMID, <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="7-4-2-3-Send-Message"><a href="#7-4-2-3-Send-Message" class="headerlink" title="7.4.2.3 Send Message"></a>7.4.2.3 Send Message</h4><blockquote>
<p>We can send a message to the message queue with <code>msgsnd()</code>.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">**  msgid - message queue id get from getmsg()</span></span><br><span class="line"><span class="comment">**   msgp - message to send, any type</span></span><br><span class="line"><span class="comment">**   msgz - size of message</span></span><br><span class="line"><span class="comment">** msgflg - flag</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">msgsnd</span><span class="params">(<span class="type">int</span> msgid, <span class="type">const</span> <span class="type">void</span> *msgp, <span class="type">size_t</span> msgz, <span class="type">int</span> msgflg)</span>;</span><br></pre></td></tr></table></figure>

<p><code>msgp</code> is a custom structure, it can be defined like this. And <code>msgz</code> is then <code>sizeof(message_t)</code>. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tag_message</span> &#123;</span></span><br><span class="line">	<span class="type">long</span> type;               <span class="comment">// required field</span></span><br><span class="line">	<span class="type">char</span> data[BUFFER_SIZE];  <span class="comment">// custom field, anything is OK</span></span><br><span class="line">&#125; <span class="type">message_t</span>;</span><br></pre></td></tr></table></figure>

<p>For <code>msgflg</code>, usually 0 is OK, and process will be hung up until message is sent. Others are OK, <del>of course</del>. If set to <code>IPC_NOWAIT</code>, it will return -1 immediately if message queue is full, and the message remain unsent.</p>
</blockquote>
<h4 id="7-4-2-4-Receive-Message"><a href="#7-4-2-4-Receive-Message" class="headerlink" title="7.4.2.4 Receive Message"></a>7.4.2.4 Receive Message</h4><blockquote>
<p>Receive message is similar to send message, and is declared as follows.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">msgrcv</span><span class="params">(<span class="type">int</span> msgid, <span class="type">void</span> *msgp, <span class="type">size_t</span> msgz, <span class="type">long</span> msgtype, <span class="type">int</span> msgflg)</span>;</span><br></pre></td></tr></table></figure>

<p>All parameters remain the same meaning as <code>msgsnd</code>, and <code>msgflag</code>, too, return -1 immediately if no message can be received when set to <code>IPC_NOWAIT</code>. (This doesn’t mean the message queue is empty. It depends on what message to receive, which is indicated by <code>msgtype</code>)</p>
<p>For <code>msgtype</code>, it indicates what message to receive. This value is corresponding the <code>message_t::type</code>.</p>
<table>
<thead>
<tr>
<th align="center"><code>msgtype</code></th>
<th align="center">meaning</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">receive the first message in queue</td>
</tr>
<tr>
<td align="center">&gt; 0</td>
<td align="center">receive the first message with the same type</td>
</tr>
<tr>
<td align="center">&lt; 0</td>
<td align="center">receive the first message, whose type is less or equal to |<code>msgtype</code>|</td>
</tr>
</tbody></table>
</blockquote>
<h2 id="7-5-Shared-Memory"><a href="#7-5-Shared-Memory" class="headerlink" title="7.5 Shared Memory"></a>7.5 Shared Memory</h2><h3 id="7-5-1-Feature"><a href="#7-5-1-Feature" class="headerlink" title="7.5.1 Feature"></a>7.5.1 Feature</h3><blockquote>
<p>与<strong>消息队列</strong>和<strong>管道通信</strong>机制相比，一个进程要向队列&#x2F;管道中写入数据时，引起数据从用户地址空间向内核地址空间的一次复制，进行消息读取时也要进行一次复制。</p>
<p><strong>共享内存</strong>的优点是完全<strong>省去</strong>了这些操作，是 GNU&#x2F;Linux 现在可用的<strong>最快速</strong>的进程间通信机制。</p>
</blockquote>
<h3 id="7-5-2-System-V-Shared-Memory"><a href="#7-5-2-System-V-Shared-Memory" class="headerlink" title="7.5.2 System V Shared Memory"></a>7.5.2 System V Shared Memory</h3><blockquote>
<p>Ah… System V again :P. And this one requires <code>sys/shm.h</code></p>
</blockquote>
<h4 id="7-5-2-1-Create-Shared-Memory"><a href="#7-5-2-1-Create-Shared-Memory" class="headerlink" title="7.5.2.1 Create Shared Memory"></a>7.5.2.1 Create Shared Memory</h4><blockquote>
<p>Err… System V style, huh? <code>size</code> is the total size of shared memory you want to have, and <code>shmflg</code> is the same as files, you can refer to semaphore.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">shmget</span><span class="params">(<span class="type">key_t</span> key, <span class="type">int</span> size, <span class="type">int</span> shmflg)</span>;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="7-5-2-2-Control-Shared-Memory"><a href="#7-5-2-2-Control-Shared-Memory" class="headerlink" title="7.5.2.2 Control Shared Memory"></a>7.5.2.2 Control Shared Memory</h4><blockquote>
<p>Well, all the same. Like message queue, for now, we just use it to delete shared memory. Just set <code>cmd</code> to <code>IPC_RMID</code> and leave <code>buf</code> as <code>NULL</code>.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">shmctl</span><span class="params">(<span class="type">int</span> shmid, <span class="type">int</span> cmd, <span class="keyword">struct</span> shmid_ds *buf)</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="7-5-2-3-Attach-Shared-Memory"><a href="#7-5-2-3-Attach-Shared-Memory" class="headerlink" title="7.5.2.3 Attach Shared Memory"></a>7.5.2.3 Attach Shared Memory</h4><blockquote>
<p>In the last step, we only created a shared memory, but didn’t know where it is. So before we use it, we have to attach it to an address. In fact, it is done by mapping memory from this address to the actual shared memory.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">**   shmid - shared memory id</span></span><br><span class="line"><span class="comment">** shmaddr - memory to attach, ususally remain NULL to allocate automatically</span></span><br><span class="line"><span class="comment">**  shmflg - 0 by default for read and write; SHM_RDONLY for read only</span></span><br><span class="line"><span class="comment">**  return - the address attached to, -1 if error.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">char</span> *<span class="title function_">shmat</span><span class="params">(<span class="type">int</span> shmid, <span class="type">const</span> <span class="type">void</span> *shmaddr, <span class="type">int</span> shmflg)</span></span><br></pre></td></tr></table></figure>

<p>Now, you can use it as your own!</p>
<p>Notice that child process will inherit parent shared memory when created by <code>fork()</code>. Shared memory will detach automatically if process ends, or child process execute <code>exec</code> function set.</p>
</blockquote>
<h4 id="7-5-2-4-Detach-Shared-Memory"><a href="#7-5-2-4-Detach-Shared-Memory" class="headerlink" title="7.5.2.4 Detach Shared Memory"></a>7.5.2.4 Detach Shared Memory</h4><blockquote>
<p>When we don’t want a memory, we can simply detach it. It returns 0 when success and -1 on failure.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">shmdt</span><span class="params">(<span class="type">const</span> <span class="type">void</span> *shmaddr)</span>;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="7-5-3-Aplication"><a href="#7-5-3-Aplication" class="headerlink" title="7.5.3 Aplication"></a>7.5.3 Aplication</h3><blockquote>
<p>It’s easy to understand the use of shared memory. However, you can easily find that memory read and write are mutual exclusive, so shared memory often accompanied by semaphore. Since shared memory is used between processes, there’s nothing to do with mutex, which is used between threads.</p>
</blockquote>
<hr>
<p style="text-align: center; font-size: 2em"><i>" Do or do not. There is no try. "</i></p>

<p style="text-align: center">Copyright &copy; Tony's Studio 2020 - 2022</p>



<h1 style="text-align: center; font-size: 4em"><b>- EOF -</b></h1>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://tonys-studio.top">Tony Lewis</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.tonys-studio.top/posts/Inter-Process-Communication/">https://blog.tonys-studio.top/posts/Inter-Process-Communication/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/C-C/">C/C++</a><a class="post-meta__tags" href="/tags/Linux/">Linux</a><a class="post-meta__tags" href="/tags/BUAA/">BUAA</a><a class="post-meta__tags" href="/tags/System-Programming/">System Programming</a></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/Inter-Thread-Communication/" title="Inter-Thread Communication"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/10/06.jpeg" onerror="onerror=null;src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Inter-Thread Communication</div></div><div class="info-2"><div class="info-item-1">Chapter Eight - Inter Thread Communication</div></div></div></a><a class="pagination-related" href="/posts/Process/" title="Process"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/08/01.jpeg" onerror="onerror=null;src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Process</div></div><div class="info-2"><div class="info-item-1">Chapter Six - Process</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/Inter-Thread-Communication/" title="Inter-Thread Communication"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/10/06.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Jan. 4th, 2023 - 17:56:19</div><div class="info-item-2">Inter-Thread Communication</div></div><div class="info-2"><div class="info-item-1">Chapter Eight - Inter Thread Communication</div></div></div></a><a class="pagination-related" href="/posts/Linux-File-System/" title="Linux File System"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/07/07.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Jan. 4th, 2023 - 17:55:33</div><div class="info-item-2">Linux File System</div></div><div class="info-2"><div class="info-item-1">Chapter Five - File System</div></div></div></a><a class="pagination-related" href="/posts/Linux-Programming/" title="Linux Programming"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/07/08.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Jan. 4th, 2023 - 17:54:37</div><div class="info-item-2">Linux Programming</div></div><div class="info-2"><div class="info-item-1">Chapter Three - Linux Programming</div></div></div></a><a class="pagination-related" href="/posts/Process/" title="Process"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/08/01.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Jan. 4th, 2023 - 17:55:43</div><div class="info-item-2">Process</div></div><div class="info-2"><div class="info-item-1">Chapter Six - Process</div></div></div></a><a class="pagination-related" href="/posts/Linux-Commands/" title="Linux Commands"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/09/07.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Jan. 4th, 2023 - 17:54:08</div><div class="info-item-2">Linux Commands</div></div><div class="info-2"><div class="info-item-1">Chapter One - Linux Commands</div></div></div></a><a class="pagination-related" href="/posts/Meet-Linux/" title="Meet Linux"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/07/05.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Jan. 4th, 2023 - 17:26:20</div><div class="info-item-2">Meet Linux</div></div><div class="info-2"><div class="info-item-1">Chapter Zero - Meet Linux</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/avatar.png" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/missing.gif'" alt="avatar"/></div><div class="author-info-name">Tony Lewis</div><div class="author-info-description">Do or do not. There is no try.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">93</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">84</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">40</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Lord-Turmoil" target="_blank" title="Github"><i class="fa-brands fa-github"></i></a><a class="social-icon" href="mailto:swift-phantom@outlook.com" target="_blank" title="Email"><i class="fa-solid fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/2030942344" target="_blank" title="BiliBili"><i class="fa-brands fa-bilibili"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">It won't be long before the armies of the Republic track us here.<br>You can visit this site at both:<li><a href="http://blog.tonys-studio.top/" target="_blank">Main Site</a></li><li><a href="https://lord-turmoil.github.io/" target="_blank">Github Mirror Site</a></li></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">System Programming</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-Seven-Inter-Process-Communication"><span class="toc-text">Chapter Seven - Inter Process Communication</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-Pipe"><span class="toc-text">7.1 Pipe</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-Signal"><span class="toc-text">7.2 Signal</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-1-Meet-Signal"><span class="toc-text">7.2.1 Meet Signal</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-1-What-Is-Signal"><span class="toc-text">7.2.1.1 What Is Signal?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-2-Purpose-of-Signal"><span class="toc-text">7.2.1.2 Purpose of Signal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-3-Types-of-Signal"><span class="toc-text">7.2.1.3 Types of Signal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-4-Source-of-Signal"><span class="toc-text">7.2.1.4 Source of Signal</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-2-Status-of-Signal"><span class="toc-text">7.2.2 Status of Signal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-3-Respose-to-Signal"><span class="toc-text">7.2.3 Respose to Signal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-3-Classification-of-Signal"><span class="toc-text">7.2.3 Classification of Signal</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-3-1-By-Source"><span class="toc-text">7.2.3.1 By Source</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-3-2-By-Handle-Behavior"><span class="toc-text">7.2.3.2 By Handle Behavior</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-3-3-Real-Time-Signal"><span class="toc-text">7.2.3.3 Real-Time Signal</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-4-Handling-of-Signal"><span class="toc-text">7.2.4 Handling of Signal</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-4-1-signal"><span class="toc-text">7.2.4.1 signal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-4-2-sigaction"><span class="toc-text">7.2.4.2 sigaction</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-5-Block-Signal"><span class="toc-text">7.2.5 Block Signal</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-5-1-Signal-Set"><span class="toc-text">7.2.5.1 Signal Set</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-5-2-Mask-Signals"><span class="toc-text">7.2.5.2 Mask Signals</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-6-Send-Signal"><span class="toc-text">7.2.6 Send Signal</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-6-1-kill"><span class="toc-text">7.2.6.1 kill</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-6-2-raise"><span class="toc-text">7.2.6.2 raise</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-6-3-sigqueue"><span class="toc-text">7.2.6.3 sigqueue</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-7-Signal-Process-Inheritance"><span class="toc-text">7.2.7 Signal Process Inheritance</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-8-Reentrant"><span class="toc-text">7.2.8 Reentrant</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-9-Applications"><span class="toc-text">7.2.9 Applications</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-9-1-Prevent-Zombie-Process"><span class="toc-text">7.2.9.1 Prevent Zombie Process</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-Semaphore"><span class="toc-text">7.3 Semaphore</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-1-Synchronization-and-Mutual-Exclusion"><span class="toc-text">7.3.1 Synchronization and Mutual Exclusion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-2-POSIX-vs-System-V"><span class="toc-text">7.3.2 POSIX vs System V</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-3-System-V-Semaphore"><span class="toc-text">7.3.3 System V Semaphore</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-3-1-Create-Semaphore"><span class="toc-text">7.3.3.1 Create Semaphore</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-3-2-Control-Semaphore"><span class="toc-text">7.3.3.2 Control Semaphore</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-3-3-Operate-Semaphore"><span class="toc-text">7.3.3.3 Operate Semaphore</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-4-Application"><span class="toc-text">7.3.4 Application</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-Message-Queue"><span class="toc-text">7.4 Message Queue</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-1-Feature"><span class="toc-text">7.4.1 Feature</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-2-System-V-Message-Queue"><span class="toc-text">7.4.2 System V Message Queue</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-2-1-Create-Message-Queue"><span class="toc-text">7.4.2.1 Create Message Queue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-2-2-Control-Message-Queue"><span class="toc-text">7.4.2.2 Control Message Queue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-2-3-Send-Message"><span class="toc-text">7.4.2.3 Send Message</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-2-4-Receive-Message"><span class="toc-text">7.4.2.4 Receive Message</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5-Shared-Memory"><span class="toc-text">7.5 Shared Memory</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-1-Feature"><span class="toc-text">7.5.1 Feature</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-2-System-V-Shared-Memory"><span class="toc-text">7.5.2 System V Shared Memory</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-2-1-Create-Shared-Memory"><span class="toc-text">7.5.2.1 Create Shared Memory</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-2-2-Control-Shared-Memory"><span class="toc-text">7.5.2.2 Control Shared Memory</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-2-3-Attach-Shared-Memory"><span class="toc-text">7.5.2.3 Attach Shared Memory</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-2-4-Detach-Shared-Memory"><span class="toc-text">7.5.2.4 Detach Shared Memory</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-3-Aplication"><span class="toc-text">7.5.3 Aplication</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">- EOF -</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/Music-Notation-with-Avid-Sibelius-Ultimate/" title="Music Notation With Avid Sibelius Ultimate"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/posts/Music-Notation-with-Avid-Sibelius-Ultimate.jpg" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="Music Notation With Avid Sibelius Ultimate"/></a><div class="content"><a class="title" href="/posts/Music-Notation-with-Avid-Sibelius-Ultimate/" title="Music Notation With Avid Sibelius Ultimate">Music Notation With Avid Sibelius Ultimate</a><time datetime="2025-09-03T04:34:54.000Z" title="Created Sep. 3rd, 2025 - 12:34:54 12:34:54">Sep. 3rd, 2025 - 12:34:54</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Getting-Started-with-Coq/" title="Getting Started With Coq"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/12/08.jpeg" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="Getting Started With Coq"/></a><div class="content"><a class="title" href="/posts/Getting-Started-with-Coq/" title="Getting Started With Coq">Getting Started With Coq</a><time datetime="2025-08-08T04:30:12.000Z" title="Created Aug. 8th, 2025 - 12:30:12 12:30:12">Aug. 8th, 2025 - 12:30:12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Game-Engine-0-to-1-02-Something-on-the-Screen/" title="Game Engine 0 to 1 (02): Something on the Screen"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/13/06.jpeg" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="Game Engine 0 to 1 (02): Something on the Screen"/></a><div class="content"><a class="title" href="/posts/Game-Engine-0-to-1-02-Something-on-the-Screen/" title="Game Engine 0 to 1 (02): Something on the Screen">Game Engine 0 to 1 (02): Something on the Screen</a><time datetime="2025-07-04T12:07:57.000Z" title="Created Jul. 4th, 2025 - 20:07:57 20:07:57">Jul. 4th, 2025 - 20:07:57</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Game-Engine-0-to-1-01-It-Starts-Now/" title="Game Engine 0 to 1 (01): It Starts Now"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/01/01.jpeg" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="Game Engine 0 to 1 (01): It Starts Now"/></a><div class="content"><a class="title" href="/posts/Game-Engine-0-to-1-01-It-Starts-Now/" title="Game Engine 0 to 1 (01): It Starts Now">Game Engine 0 to 1 (01): It Starts Now</a><time datetime="2025-06-01T06:45:32.000Z" title="Created Jun. 1st, 2025 - 14:45:32 14:45:32">Jun. 1st, 2025 - 14:45:32</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Game-Engine-0-to-1-00-Nothing-s-Here/" title="Game Engine 0 to 1 (00): Nothing's Here"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/14/02.jpeg" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="Game Engine 0 to 1 (00): Nothing's Here"/></a><div class="content"><a class="title" href="/posts/Game-Engine-0-to-1-00-Nothing-s-Here/" title="Game Engine 0 to 1 (00): Nothing's Here">Game Engine 0 to 1 (00): Nothing's Here</a><time datetime="2025-05-27T11:05:29.000Z" title="Created May. 27th, 2025 - 19:05:29 19:05:29">May. 27th, 2025 - 19:05:29</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/22/13.jpeg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Tony Lewis</span></div><div class="footer_custom_text">No bird soars too high if he soars on his own wings</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'forest'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  let initFn = window.walineFn || null
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const destroyWaline = ele => ele.destroy()

  const initWaline = (Fn, el = document, path = window.location.pathname) => {
    const waline = Fn({
      el: el.querySelector('#waline-wrap'),
      serverURL: 'https://comment.tonys-studio.top',
      pageview: true,
      dark: 'html[data-theme="dark"]',
      comment: true,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    if (isShuoshuo) {
      window.shuoshuoComment.destroyWaline = () => {
        destroyWaline(waline)
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const loadWaline = (el, path) => {
    if (initFn) initWaline(initFn, el, path)
    else {
      btf.getCSS('https://cdn.jsdelivr.net/npm/@waline/client@2/dist/waline.min.css')
        .then(() => import('https://cdn.jsdelivr.net/npm/@waline/client@2/dist/waline.min.js'))
        .then(({ init }) => {
          initFn = init || Waline.init
          initWaline(initFn, el, path)
          window.walineFn = initFn
        })
    }
  }

  if (isShuoshuo) {
    'Waline' === 'Waline'
      ? window.shuoshuoComment = { loadComment: loadWaline } 
      : window.loadOtherComment = loadWaline
    return
  }

  if ('Waline' === 'Waline' || !false) {
    if (false) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script></div><script src="/js/custom.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Anything you would like to search?🔍" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer');
    var item_html = '<p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="Framework Hexo" title=""><img src="https://img.shields.io/badge/Frame-Hexo%205.4.2-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="Theme Butterfly" title=""><img src="https://img.shields.io/badge/Theme-Butterfly%205.4.3-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="All articles in this blog are licensed under CC BY-NC-SA 4.0 unless stating additionally." title=""><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><!-- hexo injector body_end end --></body></html>