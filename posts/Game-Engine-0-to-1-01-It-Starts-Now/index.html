<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Game Engine 0 to 1 (01): It Starts Now | TONY'S STUDIO</title><meta name="author" content="Tony Lewis"><meta name="copyright" content="Tony Lewis"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#300303"><meta name="description" content="Game Engine Series 01: Project setup">
<meta property="og:type" content="article">
<meta property="og:title" content="Game Engine 0 to 1 (01): It Starts Now">
<meta property="og:url" content="https://blog.tonys-studio.top/posts/Game-Engine-0-to-1-01-It-Starts-Now/">
<meta property="og:site_name" content="TONY&#39;S STUDIO">
<meta property="og:description" content="Game Engine Series 01: Project setup">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/10/03.jpeg">
<meta property="article:published_time" content="2025-06-01T06:45:32.000Z">
<meta property="article:modified_time" content="2025-09-03T05:21:38.220Z">
<meta property="article:author" content="Tony Lewis">
<meta property="article:tag" content="C&#x2F;C++">
<meta property="article:tag" content="Game Engine 0 to 1">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/10/03.jpeg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Game Engine 0 to 1 (01): It Starts Now",
  "url": "https://blog.tonys-studio.top/posts/Game-Engine-0-to-1-01-It-Starts-Now/",
  "image": "https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/10/03.jpeg",
  "datePublished": "2025-06-01T06:45:32.000Z",
  "dateModified": "2025-09-03T05:21:38.220Z",
  "author": [
    {
      "@type": "Person",
      "name": "Tony Lewis",
      "url": "https://tonys-studio.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/favicon.svg"><link rel="canonical" href="https://blog.tonys-studio.top/posts/Game-Engine-0-to-1-01-It-Starts-Now/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//www.clarity.ms"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="codeva-R6O16YoeQt"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#300303')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?68629f5da0a0c3347b896920fbf164b5";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
btf.addGlobalFn('pjaxComplete', () => {
  _hmt.push(['_trackPageview',window.location.pathname])
}, 'baidu_analytics')
</script><script>(function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
})(window, document, "clarity", "script", "sthrplbt7c");
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":10,"unescape":false,"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":256,"languages":{"author":"Author: Tony Lewis","link":"Link: ","source":"Source: TONY'S STUDIO","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#871798","bgDark":"#C81025","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Game Engine 0 to 1 (01): It Starts Now',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/source/custom.min.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-butterfly-footer-beautify@1.0.6/lib/runtime.min.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/css/barber-shop.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/background.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/avatar.png" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/missing.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">93</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">84</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">40</div></a></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-newspaper"></i><span> Posts</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-jedi fa-beat"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/10/03.jpeg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/logo.svg" alt="Logo"><span class="site-name">TONY'S STUDIO</span></a><a class="nav-page-title" href="/"><span class="site-name">Game Engine 0 to 1 (01): It Starts Now</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-newspaper"></i><span> Posts</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-jedi fa-beat"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Game Engine 0 to 1 (01): It Starts Now</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-06-01T06:45:32.000Z" title="Created Jun. 1st, 2025 - 14:45:32 14:45:32">Jun. 1st, 2025 - 14:45:32</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-09-03T05:21:38.220Z" title="Updated Sep. 3rd, 2025 - 13:21:38 13:21:38">Sep. 3rd, 2025 - 13:21:38</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Game-Hobby/">Game &amp; Hobby</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Game-Hobby/Game-Development/">Game Development</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>20mins</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span class="waline-pageview-count" data-path="/posts/Game-Engine-0-to-1-01-It-Starts-Now/"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">Comments:</span><a href="/posts/Game-Engine-0-to-1-01-It-Starts-Now/#post-comment"><span class="waline-comment-count" data-path="/posts/Game-Engine-0-to-1-01-It-Starts-Now/"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p style="text-align: center; font-size: x-large"><b>[01] It Starts Now</b></p>

<p style="text-align: center"><i>&ldquo;If you truly expect something to be difficult, it will be.&rdquo;</i></p>
<p style="text-align: right"><i>&mdash; Peter A. Cohen</i></p>

<div class="note primary flat"><p>你可以在 <a href="/tags/Game-Engine-0-to-1/">Game Engine 0 to 1</a> 标签下浏览该系列的所有文章。</p>
</div>

<div class="note success flat"><p>DungineX 完全开源，代码托管在 <a target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil/DungineX">GitHub</a>，本章对应<a target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil/DungineX/tree/0.1.0">🏷️0.1.0</a>。</p>
</div>

<hr>
<h1 id="Think-Twice"><a href="#Think-Twice" class="headerlink" title="Think Twice"></a>Think Twice</h1><p>在开始创建我们的项目前，还是应该停下来思考一个问题：我们希望如何组织我们的代码？这一问题其实隐含了许多小问题，下面简单列出一些，不过暂时还不太涉及到代码层面的设计。</p>
<ul>
<li>我们使用什么工具进行项目管理？MS Solution 还是 CMake，或是其他？</li>
<li>我们如何对文件进行布局，怎样管理第三方依赖？</li>
<li>最终 DungineX 的形态是怎样的？</li>
</ul>
<p>这些问题其实很大程度上取决于个人的偏好，这里给出我个人的回答，以及相应的理由。</p>
<p>对于项目管理方式，即 Build System，这里选择 CMake。虽然对于 C++ 来说，并没有一个标准的项目管理工具，但是 CMake 已经是 C++ 的 de-facto standard 了。而且我们的依赖，例如 SDL 等，也都是用 CMake 进行管理，因此集成成本会相对较低。此外，现代的 IDE 对 CMake 的支持也都十分完善，所以使用起来也不会很困难。</p>
<p>在确定使用 CMake 后，其实也就很好回答第二个问题了，我们只需要按照经典的 CMake 项目结构进行组织即可。当然，这里也会有个人偏好的存在。我们需要有我们的 DungineX 以及第三方依赖，此外，我们还想有单元测试以及 Demo。所以基本的目录结构也就是这些，我们只需要组织整齐即可。</p>
<p>最后，我们 DungineX 如何发布？对于游戏引擎，自然就不能是我们常见的可执行文件了，而是用静态或动态链接库的形式，因此我们还需要考虑库的编写。</p>
<p>当然，这些不是想想就能得出结果的，还需要一定的经验积累。不幸的是，经验积累并不能简单的通过文字表述出来，所以，就让我们直接开始吧。</p>
<hr>
<h1 id="Let-the-Fun-Begin"><a href="#Let-the-Fun-Begin" class="headerlink" title="Let  the Fun Begin!"></a>Let  the Fun Begin!</h1><h2 id="创建-CMake-项目"><a href="#创建-CMake-项目" class="headerlink" title="创建 CMake 项目"></a>创建 CMake 项目</h2><div class="note info flat"><p>This is the official tutorial video from SDL3: <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=Mi47TQ4Tsr8">How to setup SDL3 as a git submodule with Modern CMake</a>.</p>
</div>

<p>我们刚刚已经讨论过了项目的基本结构，因此这里我们可以直接创建具体的文件夹。同时，我们使用 Git 进行版本控制，为了减小仓库的大小，一个比较标准的做法是将对应依赖作为 submodule，这里我们把它们都注册到 Vendor 目录下。这里有一个依赖我们之前没有提到，是 <a target="_blank" rel="noopener" href="https://github.com/gabime/spdlog">spdlog</a>，用作之后的日志输出。</p>
<img src="/posts/Game-Engine-0-to-1-01-It-Starts-Now/image-20250529181338366.png" alt="image-20250529181338366" style="zoom:80%;">

<div class="note info flat"><p>具体 CMake 的一些编写就不再赘述了，可以直接参考仓库中的源码。</p>
</div>

<div class="note success flat"><p>这里我使用的是 <a target="_blank" rel="noopener" href="https://visualstudio.microsoft.com/vs/">Visual Studio</a> + <a target="_blank" rel="noopener" href="https://www.jetbrains.com/resharper/">Resharper</a> 的开发环境。当然 <a target="_blank" rel="noopener" href="https://code.visualstudio.com/">Visual Studio Code</a> 同样可以安装相关插件获得 CMake 支持。</p>
</div>

<p>这里我想重点讨论的，是如何让这个 CMake 项目看起来更加专业。当然，也有一些小技巧。</p>
<h3 id="Git-submodule"><a href="#Git-submodule" class="headerlink" title="Git submodule"></a>Git submodule</h3><p>对于 C&#x2F;C++ 这种缺少统一包管理的语言来说，将依赖作为 submodule 是一个不错的选择，从而能够进行统一的构建。</p>
<p>具体地，我们可以通过如下的命令为 Git 仓库添加一个 submodule，如果不提供 <code>path</code>，则默认添加到项目根目录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git submodule add url [path]</span><br></pre></td></tr></table></figure>

<p>当我们要更新依赖时，可以简单的用下面的命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git submodule update --init --recursive</span><br></pre></td></tr></table></figure>

<div class="note warning flat"><p>需要注意的是，由于 SDL 的仓库很大，所以你可能需要一个稍微稳定的网络连接。</p>
</div>

<h3 id="第三方依赖管理"><a href="#第三方依赖管理" class="headerlink" title="第三方依赖管理"></a>第三方依赖管理</h3><p>为了使用 SDL 的更多功能，例如加载字体、图片等，我们还需要引入一些额外的 SDL 组件。对于字体支持，我们需要 <a target="_blank" rel="noopener" href="https://github.com/libsdl-org/SDL_ttf">SDL_ttf</a>，而对于图片加载，我们需要 <a target="_blank" rel="noopener" href="https://github.com/libsdl-org/SDL_image">SDL_image</a>。当然，SDL 还有音频支持，不过作为游戏引擎，之前提到的 <a target="_blank" rel="noopener" href="https://www.fmod.com/">FMOD</a> 是一个相对更专业的库。由于暂时我们还不涉及音频的处理，这部分内容会在之后进行介绍。</p>
<p>当第三方库多起来时，链接它们就显得有些麻烦。每当添加一个依赖，不仅要改动 Vender&#x2F; 下的 CMakeLists.txt，还要改动 DungineX&#x2F; 里的 CMakeLists.txt。对此，我们可以将依赖全部依赖首先打包成一个 <code>interface</code> 类型的目标，作为所有第三方依赖的链接。具体这一目标的创建方式如下，更详细的内容可参考具体的 <a target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil/DungineX/blob/0.1.0/Vendor/CMakeLists.txt">Vendor&#x2F;CMakeLists.txt</a>。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(DgeX_Vendor INTERFACE </span><br><span class="line">    SDL3_ttf::SDL3_ttf</span><br><span class="line">    SDL3_image::SDL3_image</span><br><span class="line">    SDL3::SDL3 <span class="comment"># SDL must be the last item in the list.</span></span><br><span class="line">    spdlog::spdlog</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<div class="note warning flat"><p>这里需要注意的是，必须首先使用 <code>add_subdirectory(SDL)</code> 添加 SDL 依赖，才能确保 SDL_ttf 和 SDL_image 能够获取正确的配置。但是在添加依赖时，SDL3::SDL3 必须是最后一个。</p>
</div>

<p>这里，细心的你可能注意到，我们链接的第三方库都是 <code>XX::XX</code> 的格式。这其实是目标别名（Target Alias），可以更方便地管理依赖<del>，并且让我们的 CMake 项目更加高级</del>。关于这一点，会在稍后具体介绍。</p>
<h3 id="更好的-CMake-项目结构"><a href="#更好的-CMake-项目结构" class="headerlink" title="更好的 CMake 项目结构"></a>更好的 CMake 项目结构</h3><div class="note info flat"><p>更多 CMake 技巧的介绍可以参考 <a href="/posts/Modern-C-Project-with-CMake/">Modern C++ Project With CMake</a>。当然，DungineX 全部都使用到了。</p>
</div>

<p>当然，如果你也一样，对项目结构有一定的“强迫症”，那你可能需要多花一些时间整理你的项目。比如，你希望添加一个 <code>utils.cmake</code> 包含一些自定义的函数，或者增加单元测试目录，又或是想在 CMakeLists.txt 添加一些选项或者注释。</p>
<h2 id="Minimal-DungineX"><a href="#Minimal-DungineX" class="headerlink" title="Minimal DungineX"></a>Minimal DungineX</h2><p>Now, let’s implement a minimal library, so that we can play with the compiler.</p>
<h3 id="Standard-project-structure"><a href="#Standard-project-structure" class="headerlink" title="Standard project structure"></a>Standard project structure</h3><p>For a CMake project, a standard project layout would be as follows. To prevent naming conflicts, a common practice is adding an extra directory so that we will include <code>DgeX/DgeX.h</code> instead of <code>DgeX.h</code> only.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DungineX</span><br><span class="line">|-- include</span><br><span class="line">|   `-- DgeX</span><br><span class="line">|       `-- DgeX.h</span><br><span class="line">|-- src</span><br><span class="line">`-- CMakeLists.txt</span><br></pre></td></tr></table></figure>

<p>Then, in CMakeLists.txt, we can just add our source file and include directories.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">file</span>(GLOB_RECURSE DGEX_SOURCES CONFIGURE_DEPENDS </span><br><span class="line">    <span class="string">&quot;$&#123;PROJECT_SOURCE_DIR&#125;/include/*.h&quot;</span></span><br><span class="line">    <span class="string">&quot;$&#123;PROJECT_SOURCE_DIR&#125;/src/*.h&quot;</span></span><br><span class="line">    <span class="string">&quot;$&#123;PROJECT_SOURCE_DIR&#125;/src/*.cpp&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_include_directories</span>(</span><br><span class="line">    <span class="variable">$&#123;target_name&#125;</span></span><br><span class="line">    PUBLIC <span class="variable">$&#123;CMAKE_CURRENT_LIST_DIR&#125;</span>/<span class="keyword">include</span></span><br><span class="line">    PRIVATE <span class="variable">$&#123;CMAKE_CURRENT_LIST_DIR&#125;</span>/src</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>As for the target name <code>&#123;target_name&#125;</code>, there are some tricks here, and we will discuss that later.</p>
<h3 id="Global-macros"><a href="#Global-macros" class="headerlink" title="Global macros"></a>Global macros</h3><p>For a large project, especially for C&#x2F;C++, there are often many useful macros defined globally. For example, we may want to be aware of the build type. Also, we may want a shortcut for namespace declaration. Finally, we can provide an API to get the version string.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// debugging flag</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(DEBUG) || defined(_DEBUG)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DGEX_DEBUG</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DGEX_RELEASE</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// namespace</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DGEX_BEGIN namespace DgeX &#123;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DGEX_END   &#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DGEX       ::DgeX::</span></span><br><span class="line"></span><br><span class="line"><span class="function">std::string DGEX_API <span class="title">GetDgeXVersion</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>You can find more macro definitions in <a target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil/DungineX/blob/0.1.0/DungineX/include/DgeX/Defines.h">Defines.h</a>.</p>
<div class="note success flat"><p>Fun fact, the name Defines.h originally came from <a target="_blank" rel="noopener" href="https://github.com/electronicarts/CnC_Remastered_Collection">Westwood Studios’ C&amp;C games</a>.</p>
</div>

<h3 id="Versioning"><a href="#Versioning" class="headerlink" title="Versioning"></a>Versioning</h3><p>I’m not sure if you also feel this way, but adding version information into a project is super cool. To achieve this, we can add <a target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil/DungineX/blob/0.1.0/DungineX/include/DgeX/Version.h">Version.h</a> to our project. Also, you can use stringfy macros (defined in <a target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil/DungineX/blob/0.1.0/DungineX/include/DgeX/Utils/Macros.h">Utils&#x2F;Macros.h</a>) to get version as a string.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> DGEX_VERSION_MAJOR 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DGEX_VERSION_MINOR 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DGEX_VERSION_PATCH 0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DGEX_TO_VERSION(major, minor, patch) (major * 10000 + minor * 100 + patch)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DGEX_VERSION                         DGEX_TO_VERSION(DGEX_VERSION_MAJOR, DGEX_VERSION_MINOR, DGEX_VERSION_PATCH)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DGEX_VERSION_STRING                 \</span></span><br><span class="line"><span class="meta">    DGEX_STRINGIFY(DGEX_VERSION_MAJOR)      \</span></span><br><span class="line"><span class="meta">    <span class="string">&quot;.&quot;</span>                                     \</span></span><br><span class="line"><span class="meta">    DGEX_STRINGIFY(DGEX_VERSION_MINOR)      \</span></span><br><span class="line"><span class="meta">    <span class="string">&quot;.&quot;</span>                                     \</span></span><br><span class="line"><span class="meta">    DGEX_STRINGIFY(DGEX_VERSION_PATCH)</span></span><br></pre></td></tr></table></figure>

<div class="note success flat"><p>I learnt this style from <a target="_blank" rel="noopener" href="https://github.com/gabime/spdlog">spdlog</a>. In fact, many of my CMake knowledge came from that, too.</p>
</div>

<h3 id="Prepare-to-be-a-shared-library-DLL"><a href="#Prepare-to-be-a-shared-library-DLL" class="headerlink" title="Prepare to be a shared library (DLL)"></a>Prepare to be a shared library (DLL)</h3><p>Back in old days, we built standalone executable files (.exe). Then, we build static libraries (.lib) that linked directly into the executable file. Building static library is easy, as you don’t need to change anything.</p>
<p>However, things change when it comes to a dynamic library (.dll), or shared library. That’s why you often (or always) see some “weird” macro before each function in libraries you use. For example, this is one of the APIs in SDL3, with <code>SDL_DECLSPEC</code> macro.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">extern</span> SDL_DECLSPEC <span class="type">int</span> SDLCALL <span class="title">SDL_GetVersion</span><span class="params">(<span class="type">void</span>)</span></span>;</span><br></pre></td></tr></table></figure>

<p>This is because, unlike static library which is linked with the target executable, shared library will be built into independent DLL file to be loaded at runtime. So, we have to tell the compiler and linker what function should be included in the DLL and how to load them.</p>
<p>If we have shared library in mind, it would be a bad idea to build only for static or dynamic. A good practice, as shown above, is use a macro. Below is the definition in DungineX, replacing <code>SDL_DECLSPEC</code> with <code>DGEX_API</code>. Note that we don’t need <code>__declspec</code> again in function definition.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Defines.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> DGEX_EXPORT</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DGEX_API __declspec(dllexport)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DGEX_API</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Version.h</span></span><br><span class="line"><span class="function">std::string DGEX_API <span class="title">GetDgeXVersion</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Version.cpp</span></span><br><span class="line"><span class="function">std::string <span class="title">GetDgeXVersion</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; DGEX_VERSION_STRING &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If we want to build DungineX as a shared library, we can just define <code>DGEX_EXPORT</code>, and everything else will be handled by the preprocessor.</p>
<div class="note warning flat"><p>However, this is not over yet. There is still one important configuration waiting for you, see <a href="#Static-or-shared-library?">Static or shared library</a></p>
</div>

<h3 id="More-about-shared-libary"><a href="#More-about-shared-libary" class="headerlink" title="More about shared libary"></a>More about shared libary</h3><p>For static library, since the compilation and linking are done at compile time, so you can write code normally as what you do. For shared libary, there is more “dirty work”.</p>
<p>When you build shared libary, in fact, you’ll get both a <code>.lib</code> and a <code>.dll</code> file. The <code>.dll</code> file is our actual library, and <code>.lib</code> here is for linking, telling the compiler which functions will eventually come from <code>.dll</code>. By this way, you can just write your code, and the compiler will generate the code to load functions from the shared library. If somehow the <code>.lib</code> is not available (e.g. close source library), then you have to manually write those boring code.</p>
<p>The client is the code that depends on the library. When it includes shared library’s header files, since we have the macro, it will not see <code>__declspec(dllexport)</code>, and will eventually know that these functions should be imported via the corresponding <code>.lib</code>.</p>
<p>Another thing to notice is that, there are both <code>__declspec(dllexport)</code> for the libary and <code>__declspec(dllimport)</code> for the client. When you load a shared libary, there will be a table generated to map those function calls or data. <code>__declspec(dllimport)</code> explicitly specify the function or data to be loaded from a shared library, so that the compiler can generate more efficient code.</p>
<p>However, <code>__declspec(dllimport)</code> is not required for function, as the compiler will do the optimization anyway. The only case when it is useful is declaring variables, since we don’t want an indirect access for them. For more about this topic, you can check out the following links.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/4489441/why-when-is-declspec-dllimport-not-needed">Why&#x2F;when is __declspec( dllimport ) not needed?</a></li>
<li><a target="_blank" rel="noopener" href="https://web.archive.org/web/20140808231508/http://blogs.msdn.com/b/russellk/archive/2005/03/20/399465.aspx">LNK4217</a></li>
</ul>
<div class="note info flat"><p>Eventhough we can export variable in a shared library, it is <strong>NOT</strong> recommended to do so, because you know, global variables are bad.</p>
</div>

<h2 id="Update-CMakeLists-txt"><a href="#Update-CMakeLists-txt" class="headerlink" title="Update CMakeLists.txt"></a>Update CMakeLists.txt</h2><p>Now we have a minimum library project, let’s get ready to compile it.</p>
<h3 id="Static-or-shared-library"><a href="#Static-or-shared-library" class="headerlink" title="Static or shared library?"></a>Static or shared library?</h3><p>Now that we have two possible targets, one static library and one shared library, we have to decide which one to build. Of course, we can build them all, but adding such an option would always be a better choice.</p>
<p>In <a target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil/DungineX/blob/0.1.0/DungineX/CMakeLists.txt">DungineX&#x2F;CMakeLists.txt</a>, we can optionally add two targets, marked with <code>SHARED</code> and <code>STATIC</code>. Specially, for a shared library, we need to make it position-independent, so that any program can load it. Of course, we need to add that macro <code>DGEX_EXPORT</code>. For a static library, there’s nothing different from what you see before.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(TARGET_SHARED DgeX_Shared)</span><br><span class="line"><span class="keyword">set</span>(TARGET_STATIC DgeX_Static)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(DGEX_BUILD_SHARED)</span><br><span class="line">    <span class="keyword">add_library</span>(<span class="variable">$&#123;TARGET_SHARED&#125;</span> SHARED <span class="variable">$&#123;DGEX_SOURCES&#125;</span>)</span><br><span class="line">    configure_dgex_target(<span class="variable">$&#123;TARGET_SHARED&#125;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Shared library need some extra properties.</span></span><br><span class="line">    <span class="keyword">set_target_properties</span>(<span class="variable">$&#123;TARGET_SHARED&#125;</span> PROPERTIES POSITION_INDEPENDENT_CODE <span class="keyword">ON</span>)</span><br><span class="line">    <span class="keyword">target_compile_definitions</span>(<span class="variable">$&#123;TARGET_SHARED&#125;</span> PRIVATE DGEX_EXPORT)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(DGEX_BUILD_STATIC)</span><br><span class="line">    <span class="keyword">add_library</span>(<span class="variable">$&#123;TARGET_STATIC&#125;</span> STATIC <span class="variable">$&#123;DGEX_SOURCES&#125;</span>)</span><br><span class="line">    configure_dgex_target(<span class="variable">$&#123;TARGET_STATIC&#125;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<p>Now, you should have your shared library. But one thing may bother you, that the compiled DLL is output into its own directory, not beside the executable file. So, when you try to run your executable, you will see one of the most annoying errors on Windows.</p>
<img src="/posts/Game-Engine-0-to-1-01-It-Starts-Now/image-20250530233424360.png" alt="image-20250530233424360" style="zoom:80%;">

<p>One quick solution is to copy the DLL file. However, you can also set CMake’s output directory so that all binaries will be output to the same location. Here, DungineX only changes this if it is built as the main project, not a dependency. This allows more flexibility if it is built as a dependency.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(DGEX_MASTER_PROJECT)</span><br><span class="line">    <span class="keyword">set</span>(CMAKE_ARCHIVE_OUTPUT_DIRECTORY <span class="string">&quot;$&#123;CMAKE_BINARY_DIR&#125;/output/lib&quot;</span>)</span><br><span class="line">    <span class="keyword">set</span>(CMAKE_LIBRARY_OUTPUT_DIRECTORY <span class="string">&quot;$&#123;CMAKE_BINARY_DIR&#125;/output/lib&quot;</span>)</span><br><span class="line">    <span class="keyword">set</span>(CMAKE_RUNTIME_OUTPUT_DIRECTORY <span class="string">&quot;$&#123;CMAKE_BINARY_DIR&#125;/output/bin&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<h3 id="Target-alias"><a href="#Target-alias" class="headerlink" title="Target alias"></a>Target alias</h3><p>It is good to have both static and shared libraries. However, it introduces another problem. When people link DungineX, which target should they use? With the CMakeLists.txt above, the users have to explicitly choose <code>DgeX_Static</code> or <code>DgeX_Shared</code>, which is apparently not friendly.</p>
<p>Fortunately, CMake supports target alias, and you’ve already seen it earlier when we were adding third-party libraries. We can create a consistent alias based on the user’s choice of library. This way, they can just use <code>DgeX::Lib</code> in their CMakeLists.txt.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(DGEX_USE_SHARED)</span><br><span class="line">    <span class="keyword">add_library</span>(DgeX::Lib ALIAS <span class="variable">$&#123;TARGET_SHARED&#125;</span>)</span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">    <span class="keyword">add_library</span>(DgeX::Lib ALIAS <span class="variable">$&#123;TARGET_STATIC&#125;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<p>However, you may encounter yet another problem, that you cannnot use target alias as target. So, you have to know the target behind the alias. This can be done via a simple function, and then you can use the original target name.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cmake/utils.cmake</span></span><br><span class="line"><span class="keyword">function</span>(dgex_get_target_name alias_name output)</span><br><span class="line">    <span class="keyword">get_target_property</span>(target_name <span class="variable">$&#123;alias_name&#125;</span> ALIASED_TARGET)</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&quot;$&#123;target_name&#125;&quot;</span> <span class="keyword">STREQUAL</span> <span class="string">&quot;target_name-NOTFOUND&quot;</span>)</span><br><span class="line">        <span class="keyword">set</span>(<span class="variable">$&#123;output&#125;</span> <span class="variable">$&#123;alias_name&#125;</span> PARENT_SCOPE)</span><br><span class="line">    <span class="keyword">else</span>()</span><br><span class="line">        <span class="keyword">set</span>(<span class="variable">$&#123;output&#125;</span> <span class="variable">$&#123;target_name&#125;</span> PARENT_SCOPE)</span><br><span class="line">    <span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Vendor/CMakeLists.txt</span></span><br><span class="line">dgex_get_target_name(<span class="variable">$&#123;vendor&#125;</span> vendor_target)</span><br><span class="line">dgex_disable_warnings(<span class="variable">$&#123;vendor_target&#125;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Ship-DLL-with-your-mark"><a href="#Ship-DLL-with-your-mark" class="headerlink" title="Ship DLL with your mark"></a>Ship DLL with your mark</h3><p>Now, you should have everything work just fine. However, if you are a perfectionist, you will probably get extremely frustrated as the output DLL file has no properties. This is not good, as players won’t be able to contribute to the one who writes the engine and makes the game happen.</p>
<img src="/posts/Game-Engine-0-to-1-01-It-Starts-Now/image-20250531183840997.png" alt="image-20250531183840997" style="zoom:80%;">

<p>To add properties to your DLL file, there is a repo <a target="_blank" rel="noopener" href="https://github.com/halex2005/CMakeHelpers">CMakeHelpers</a> you can refer to. Just copy <code>VersionInfo.in</code>, <code>VersionResource.rc</code> and <code>generate_product_version.cmake</code> to your project and configure your information. See <a target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil/DungineX/blob/0.1.0/DungineX/CMakeLists.txt">DungineX&#x2F;CMakeLists.txt</a> for detailed usage. Since DLL file usually don’t need an icon, so I removed <code>ICON</code> property. Finally, our DLL file will look like this. All of a sudden, it goes professional.</p>
<img src="/posts/Game-Engine-0-to-1-01-It-Starts-Now/image-20250531190555675.png" alt="image-20250531190555675" style="zoom:80%;">

<div class="note info flat"><p>Of course, this works only on Windows. However, it is not a issue as we currently don’t target other platforms.</p>
</div>

<hr>
<h1 id="A-Custom-Entrypoint"><a href="#A-Custom-Entrypoint" class="headerlink" title="A Custom Entrypoint"></a>A Custom Entrypoint</h1><p>对于游戏来说，初始化或者释放可能会很复杂，涉及窗口的创建、各种资源的加载，如果涉及 Windows 应用的创建，还需要将 <code>main</code> 替换为复杂的 <code>WinMain</code>。很多时候，我们没有必要将复杂度暴露给用户。因此，这里介绍一个相对特别的话题，就是为引擎添加一个自定义的入口，从而将很多逻辑转移到引擎内部。</p>
<div class="note success flag flat"><p>这样做还有一个好处，就是可以向最终生成的游戏中添加一些有趣的东西，比如版权声明，启动画面等。</p>
</div>

<p>首先，我们可以创建这样的自定义入口，从而用户在使用引擎时，可以使用正常 <code>main</code> 的写法。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*DgeXEntryPoint)</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="type">int</span> <span class="title">DgeXMain</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span>;</span><br></pre></td></tr></table></figure>

<p>接下来，我们可以定义引擎 <code>main</code> 函数的实现，从而在用户入口的前后插入自定义的代码。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">extern</span> DGEX_API <span class="type">int</span> <span class="title">DgeXMainImpl</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[], DgeXEntryPoint entryPoint)</span></span>;</span><br></pre></td></tr></table></figure>

<div class="note success flat"><p>说到这里，突然想到这和面向切面编程（AOP）有些类似，刚好之前也写过一篇相关的文章，<a href="/posts/AOP-in-Spring-Boot/">AOP in Spring Boot</a>。</p>
</div>

<p>对于自定义入口，最关键的就是 <code>main</code>（或 <code>WinMain</code>，以下均用 <code>main</code> 代指）函数的定义。既然我们不希望用户手动实现这一函数，那么我们就需要通过某种方式提供给用户。<code>main</code> 与其他函数不同，其他函数可以只提供声名，然后在运行时从 DLL 中动态加载，而 <code>main</code> 为可执行程序的入口，因此必须在可执行文件内有定义。所以，解决方法就是将 <code>main</code> 函数实现在引擎的头文件中，当用户引入这一头文件时，即可引入 <code>main</code> 函数。而由于 <code>main</code> 函数只能定义一次，所以我们需要将其定义在一个单独的头文件中供用户引用，而不是我们的 <code>DgeX.h</code>。</p>
<p>具体地，我们这里将 <code>main</code> 函数定义在 <a target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil/DungineX/blob/0.1.0/DungineX/include/DgeX/EntryPoint.h">DgeX&#x2F;EntryPoint.h</a>。目前的 <code>main</code> 函数实现还非常简单，只是调用一下刚刚的 <code>DgeXMainImpl</code>。由于 <code>DgeXMainImpl</code> 就不是 <code>main</code> 了，所以它可以只提供声明，而将实现放在源文件中。当然需要注意，在我们引擎内部引用 EntryPoint.h 时，就不能再包含 <code>main</code> 函数的定义了，具体可以通过特定的宏开关实现。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> DGEX_USE_WINMAIN</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span> <span class="comment">// for __argc and __argv</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> APIENTRY <span class="title">WinMain</span><span class="params">(HINSTANCE hInst, HINSTANCE hInstPrev, PSTR cmdline, <span class="type">int</span> cmdshow)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">DgeXMainImpl</span>(__argc, __argv, DgeXMain);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">DgeXMainImpl</span>(argc, argv, DgeXMain);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// DGEX_USE_WINMAIN</span></span></span><br></pre></td></tr></table></figure>

<p>之后，随着引擎功能逐渐复杂，我们会在 <code>DgeXMainImpl</code> 中添加更多的内容。当然，为了提供更一致的体验，我们还可以将 <code>DgeXMain</code> 进一步变成 <code>main</code>。因为预处理发生在编译前，所以不会对编译过程造成影响。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> main DgeXMain</span></span><br></pre></td></tr></table></figure>

<p>最后，用户只需要在原先要包含 <code>main</code> 函数源文件中，引入 EntryPoint.h 即可。下面是一个简单的示例，具体见 <a target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil/DungineX/blob/0.1.0/Demo/HelloThere/Main.cpp">Demo&#x2F;HelloThere&#x2F;Main.cpp</a>。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;DgeX/DgeX.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;DgeX/EntryPoint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello there!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;DungineX &quot;</span> &lt;&lt; DgeX::<span class="built_in">GetDgeXVersion</span>() &lt;&lt; <span class="string">&quot;!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; std::endl &lt;&lt; <span class="string">&quot;Press Enter to quit...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cin.<span class="built_in">get</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="What’s-Next"><a href="#What’s-Next" class="headerlink" title="What’s Next?"></a>What’s Next?</h1><p>现在我们已经有了一个不错的项目结构了，接下来就可以向其中添加各个模块了。在进行下一步之前，我们有必要做一些规划，也就是我们的引擎主要分为那几个部分。</p>
<h2 id="Device"><a href="#Device" class="headerlink" title="Device"></a>Device</h2><p>首先，自然是设备相关，包括图形设备（Graphics）、音频设备（Autdio）、输入设备（Input）三类。这一层主要对硬件设备进行封装，提供统一的抽象模型。当然，如果我们使用 SDL，和硬件相关的部分其实已经封装好了，不过我们还需要根据引擎具体的需求进行二次封装。</p>
<p>这一部分是整个游戏引擎的基础设施（Infrastructure），在它完成之后，其他所有模块将不再需要调用底层 SDL 和其他库的接口，所以非常关键。</p>
<h2 id="Resource"><a href="#Resource" class="headerlink" title="Resource"></a>Resource</h2><p>资源管理也是游戏引擎中一个重要的部分。游戏中通常需要加载大量的资源，硬编码自然不是一个好的选择，因此我们需要有一个统一的资源管理模块。</p>
<p>首先一个问题，是资源的索引，可以使用 XML 或者 JSON 格式的文本，记录资源 ID 和文件索引，这个很容易，只要准确地描述资源的各种属性即可。</p>
<p>第二个问题，也是更关键的问题，如何加载资源。由于资源种类很多，而且很大程度上依赖于特定的游戏，因此我们在引擎层很难有全面的支持，因此就需要考虑可扩展性。例如，在引擎里，我们可以提供最简单的文本、图片和声音资源，然后允许客户端定义新的资源类型以及加载方式。</p>
<p>此外，还有一些琐碎的问题，比如动态添加或修改资源、资源何时加载和释放等，这个在之后具体设计时再考虑。</p>
<div class="note info flat"><p>当然，如果想保护游戏资源，也可以选择对资源文件进行加密。这实现起来不难，也不是我们关注的重点。</p>
</div>

<h2 id="Scene"><a href="#Scene" class="headerlink" title="Scene"></a>Scene</h2><p>接下来，就是游戏引擎的重头戏，场景管理。在这一部分，我们要管理游戏对象，实现游戏对象的更新、绘制，以及它们之间的交互。</p>
<p>对于这一部分，游戏开发中有一个非常受欢迎的实现方式，就是 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Entity_component_system">ECS（Entity Component System）</a>。这个其实在之前的 <a target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil/Dungeon">Dungine</a> 中就已经有所实践了，能够提供非常高的灵活性。在 DungineX 中，我们也继续使用这一模式。</p>
<p>曾经在 Dungine 中，我实现了非常简单的 2D 碰撞检测，然而并不是真正的物理模拟。因此，这次我想为引擎引入完整的物理系统。之前还想亲自实现物理引擎，但是实在过于艰深晦涩，我只勉强实现了粒子物理系统。由于物理引擎实在过于宏大，因此我们暂时直接使用第三方库。</p>
<p>此外，我们也可以在引擎层面添加一些额外的功能，比如观察者模式、原型模式、单例模式等的支持，以及对象池等等。</p>
<h2 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h2><p>对于一个完整的游戏，不只有游戏画面，还有各种菜单界面。虽然可能已经超出了引擎的基本功能范围，但是我们可以为用户提供简单的界面支持。</p>
<p>这个可能是我个人的一些执念吧，比较想实现界面的切换效果。此外，还想提供一个基于 XML 的界面编写支持，有些类似 HTML 或 WPF 的感觉。属于额外的功能支持吧。</p>
<p>在界面支持的基础上，我们可以把整个游戏封装成一个 Application，从而管理整个游戏的执行流程。</p>
<h2 id="Logs"><a href="#Logs" class="headerlink" title="Logs"></a>Logs</h2><p>此外，其实还有很多比较零碎的点，比如日志支持等，这些会在之后的内容中穿插介绍。</p>
<hr>
<h1 id="预告"><a href="#预告" class="headerlink" title="预告"></a>预告</h1><p>在下一章中，我们将实现最基本的窗口创建，以及图形绘制，也就是 Device 中的 Graphics 部分。ᓚᘏᗢ</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://tonys-studio.top">Tony Lewis</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.tonys-studio.top/posts/Game-Engine-0-to-1-01-It-Starts-Now/">https://blog.tonys-studio.top/posts/Game-Engine-0-to-1-01-It-Starts-Now/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/C-C/">C/C++</a><a class="post-meta__tags" href="/tags/Game-Engine-0-to-1/">Game Engine 0 to 1</a></div><div class="post-share"><div class="addtoany"><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_button_wechat"></a><a class="a2a_button_qzone"></a><a class="a2a_button_sina_weibo"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_email"></a><a class="a2a_button_copy_link"></a><a class="a2a_dd" target="_blank" rel="noopener" href="https://www.addtoany.com/share"></a></div></div><script async="async" src="https://static.addtoany.com/menu/page.js"></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/Game-Engine-0-to-1-02-Something-on-the-Screen/" title="Game Engine 0 to 1 (02): Something on the Screen"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/09/03.jpeg" onerror="onerror=null;src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Game Engine 0 to 1 (02): Something on the Screen</div></div><div class="info-2"><div class="info-item-1">Game Engine Series 02: Graphics Device</div></div></div></a><a class="pagination-related" href="/posts/Game-Engine-0-to-1-00-Nothing-s-Here/" title="Game Engine 0 to 1 (00): Nothing's Here"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/01/10.jpeg" onerror="onerror=null;src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Game Engine 0 to 1 (00): Nothing's Here</div></div><div class="info-2"><div class="info-item-1">Game Engine Series 00: Prologue</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/Game-Engine-0-to-1-00-Nothing-s-Here/" title="Game Engine 0 to 1 (00): Nothing&#39;s Here"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/01/10.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> May. 27th, 2025 - 19:05:29</div><div class="info-item-2">Game Engine 0 to 1 (00): Nothing&#39;s Here</div></div><div class="info-2"><div class="info-item-1">Game Engine Series 00: Prologue</div></div></div></a><a class="pagination-related" href="/posts/Game-Engine-0-to-1-02-Something-on-the-Screen/" title="Game Engine 0 to 1 (02): Something on the Screen"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/09/03.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Jul. 4th, 2025 - 20:07:57</div><div class="info-item-2">Game Engine 0 to 1 (02): Something on the Screen</div></div><div class="info-2"><div class="info-item-1">Game Engine Series 02: Graphics Device</div></div></div></a><a class="pagination-related" href="/posts/C-Object-Lifecycle/" title="C++ Object Lifecycle"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/22/12.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Oct. 1st, 2024 - 17:07:53</div><div class="info-item-2">C++ Object Lifecycle</div></div><div class="info-2"><div class="info-item-1">Breakdown of C++ object lifecycle to wipe out all your doubts</div></div></div></a><a class="pagination-related" href="/posts/Configure-VS-for-Non-MSVC-Projects/" title="Configure Visual Studio for Non-MSVC Projects"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/23/02.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Apr. 27th, 2023 - 09:13:37</div><div class="info-item-2">Configure Visual Studio for Non-MSVC Projects</div></div><div class="info-2"><div class="info-item-1">Configure VS IntelliSense for GCC</div></div></div></a><a class="pagination-related" href="/posts/Dungeon/" title="Dungeon"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/posts/Dungeon.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Jan. 4th, 2023 - 21:45:04</div><div class="info-item-2">Dungeon</div></div><div class="info-2"><div class="info-item-1">A rogue-like game developed with EasyX and FMOD in C++.</div></div></div></a><a class="pagination-related" href="/posts/Inter-Process-Communication/" title="Inter-Process Communication"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/05/06.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Jan. 4th, 2023 - 17:56:03</div><div class="info-item-2">Inter-Process Communication</div></div><div class="info-2"><div class="info-item-1">Chapter Seven - Inter Process Communication</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/avatar.png" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/missing.gif'" alt="avatar"/></div><div class="author-info-name">Tony Lewis</div><div class="author-info-description">Do or do not. There is no try.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">93</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">84</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">40</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Lord-Turmoil" target="_blank" title="Github"><i class="fa-brands fa-github"></i></a><a class="social-icon" href="mailto:swift-phantom@outlook.com" target="_blank" title="Email"><i class="fa-solid fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/2030942344" target="_blank" title="BiliBili"><i class="fa-brands fa-bilibili"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">It won't be long before the armies of the Republic track us here.<br>You can visit this site at both:<li><a href="http://blog.tonys-studio.top/" target="_blank">Main Site</a></li><li><a href="https://lord-turmoil.github.io/" target="_blank">Github Mirror Site</a></li></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Think-Twice"><span class="toc-text">Think Twice</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Let-the-Fun-Begin"><span class="toc-text">Let  the Fun Begin!</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-CMake-%E9%A1%B9%E7%9B%AE"><span class="toc-text">创建 CMake 项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Git-submodule"><span class="toc-text">Git submodule</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86"><span class="toc-text">第三方依赖管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E5%A5%BD%E7%9A%84-CMake-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-text">更好的 CMake 项目结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Minimal-DungineX"><span class="toc-text">Minimal DungineX</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Standard-project-structure"><span class="toc-text">Standard project structure</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Global-macros"><span class="toc-text">Global macros</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Versioning"><span class="toc-text">Versioning</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Prepare-to-be-a-shared-library-DLL"><span class="toc-text">Prepare to be a shared library (DLL)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#More-about-shared-libary"><span class="toc-text">More about shared libary</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Update-CMakeLists-txt"><span class="toc-text">Update CMakeLists.txt</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Static-or-shared-library"><span class="toc-text">Static or shared library?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Target-alias"><span class="toc-text">Target alias</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ship-DLL-with-your-mark"><span class="toc-text">Ship DLL with your mark</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#A-Custom-Entrypoint"><span class="toc-text">A Custom Entrypoint</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#What%E2%80%99s-Next"><span class="toc-text">What’s Next?</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Device"><span class="toc-text">Device</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Resource"><span class="toc-text">Resource</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Scene"><span class="toc-text">Scene</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Application"><span class="toc-text">Application</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Logs"><span class="toc-text">Logs</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A2%84%E5%91%8A"><span class="toc-text">预告</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/Music-Notation-with-Avid-Sibelius-Ultimate/" title="Music Notation With Avid Sibelius Ultimate"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/posts/Music-Notation-with-Avid-Sibelius-Ultimate.jpg" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="Music Notation With Avid Sibelius Ultimate"/></a><div class="content"><a class="title" href="/posts/Music-Notation-with-Avid-Sibelius-Ultimate/" title="Music Notation With Avid Sibelius Ultimate">Music Notation With Avid Sibelius Ultimate</a><time datetime="2025-09-03T04:34:54.000Z" title="Created Sep. 3rd, 2025 - 12:34:54 12:34:54">Sep. 3rd, 2025 - 12:34:54</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Getting-Started-with-Coq/" title="Getting Started With Coq"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/05/07.jpeg" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="Getting Started With Coq"/></a><div class="content"><a class="title" href="/posts/Getting-Started-with-Coq/" title="Getting Started With Coq">Getting Started With Coq</a><time datetime="2025-08-08T04:30:12.000Z" title="Created Aug. 8th, 2025 - 12:30:12 12:30:12">Aug. 8th, 2025 - 12:30:12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Game-Engine-0-to-1-02-Something-on-the-Screen/" title="Game Engine 0 to 1 (02): Something on the Screen"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/09/03.jpeg" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="Game Engine 0 to 1 (02): Something on the Screen"/></a><div class="content"><a class="title" href="/posts/Game-Engine-0-to-1-02-Something-on-the-Screen/" title="Game Engine 0 to 1 (02): Something on the Screen">Game Engine 0 to 1 (02): Something on the Screen</a><time datetime="2025-07-04T12:07:57.000Z" title="Created Jul. 4th, 2025 - 20:07:57 20:07:57">Jul. 4th, 2025 - 20:07:57</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Game-Engine-0-to-1-01-It-Starts-Now/" title="Game Engine 0 to 1 (01): It Starts Now"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/10/03.jpeg" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="Game Engine 0 to 1 (01): It Starts Now"/></a><div class="content"><a class="title" href="/posts/Game-Engine-0-to-1-01-It-Starts-Now/" title="Game Engine 0 to 1 (01): It Starts Now">Game Engine 0 to 1 (01): It Starts Now</a><time datetime="2025-06-01T06:45:32.000Z" title="Created Jun. 1st, 2025 - 14:45:32 14:45:32">Jun. 1st, 2025 - 14:45:32</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Game-Engine-0-to-1-00-Nothing-s-Here/" title="Game Engine 0 to 1 (00): Nothing's Here"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/01/10.jpeg" onerror="this.onerror=null;this.src='https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png'" alt="Game Engine 0 to 1 (00): Nothing's Here"/></a><div class="content"><a class="title" href="/posts/Game-Engine-0-to-1-00-Nothing-s-Here/" title="Game Engine 0 to 1 (00): Nothing's Here">Game Engine 0 to 1 (00): Nothing's Here</a><time datetime="2025-05-27T11:05:29.000Z" title="Created May. 27th, 2025 - 19:05:29 19:05:29">May. 27th, 2025 - 19:05:29</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/10/03.jpeg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Tony Lewis</span></div><div class="footer_custom_text">No bird soars too high if he soars on his own wings</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'forest'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  let initFn = window.walineFn || null
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const destroyWaline = ele => ele.destroy()

  const initWaline = (Fn, el = document, path = window.location.pathname) => {
    const waline = Fn({
      el: el.querySelector('#waline-wrap'),
      serverURL: 'https://comment.tonys-studio.top',
      pageview: true,
      dark: 'html[data-theme="dark"]',
      comment: true,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    if (isShuoshuo) {
      window.shuoshuoComment.destroyWaline = () => {
        destroyWaline(waline)
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const loadWaline = (el, path) => {
    if (initFn) initWaline(initFn, el, path)
    else {
      btf.getCSS('https://cdn.jsdelivr.net/npm/@waline/client@2/dist/waline.min.css')
        .then(() => import('https://cdn.jsdelivr.net/npm/@waline/client@2/dist/waline.min.js'))
        .then(({ init }) => {
          initFn = init || Waline.init
          initWaline(initFn, el, path)
          window.walineFn = initFn
        })
    }
  }

  if (isShuoshuo) {
    'Waline' === 'Waline'
      ? window.shuoshuoComment = { loadComment: loadWaline } 
      : window.loadOtherComment = loadWaline
    return
  }

  if ('Waline' === 'Waline' || !false) {
    if (false) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script></div><script src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/source/custom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Anything you would like to search?🔍" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer');
    var item_html = '<p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="Framework Hexo" title=""><img src="https://img.shields.io/badge/Frame-Hexo%205.4.2-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="Theme Butterfly" title=""><img src="https://img.shields.io/badge/Theme-Butterfly%205.4.3-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="All articles in this blog are licensed under CC BY-NC-SA 4.0 unless stating additionally." title=""><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><!-- hexo injector body_end end --></body></html>