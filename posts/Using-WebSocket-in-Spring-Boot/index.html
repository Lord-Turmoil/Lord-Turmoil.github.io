<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Using WebSocket in Spring Boot | TONY'S STUDIO</title><meta name="author" content="Tony Lewis"><meta name="copyright" content="Tony Lewis"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#300303"><meta name="description" content="A simple demonstration of using WebSocket in Spring Boot"><meta property="og:type" content="article"><meta property="og:title" content="Using WebSocket in Spring Boot"><meta property="og:url" content="https://blog.tonys-studio.top/posts/Using-WebSocket-in-Spring-Boot/"><meta property="og:site_name" content="TONY&#39;S STUDIO"><meta property="og:description" content="A simple demonstration of using WebSocket in Spring Boot"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/12/05.jpeg"><meta property="article:published_time" content="2024-04-20T06:00:46.000Z"><meta property="article:modified_time" content="2026-02-21T09:38:33.480Z"><meta property="article:author" content="Tony Lewis"><meta property="article:tag" content="Java"><meta property="article:tag" content="Repo Available"><meta property="article:tag" content="Spring Boot"><meta property="article:tag" content="WebSocket"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/12/05.jpeg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Using WebSocket in Spring Boot",
  "url": "https://blog.tonys-studio.top/posts/Using-WebSocket-in-Spring-Boot/",
  "image": "https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/12/05.jpeg",
  "datePublished": "2024-04-20T06:00:46.000Z",
  "dateModified": "2026-02-21T09:38:33.480Z",
  "author": [
    {
      "@type": "Person",
      "name": "Tony Lewis",
      "url": "https://www.tonys-studio.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/favicon.svg"><link rel="canonical" href="https://blog.tonys-studio.top/posts/Using-WebSocket-in-Spring-Boot/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//www.clarity.ms"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>(()=>{const t={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:t,getScript:(e,t={})=>new Promise((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),getCSS:(e,t)=>new Promise((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),addGlobalFn:(e,t,o=!1,a=window)=>{if(e.startsWith("pjax"))return;const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const o=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#300303")},a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","undefined")};btf.activateDarkMode=o,btf.activateLightMode=a;const n=t.get("theme"),r=window.matchMedia("(prefers-color-scheme: dark)"),c=window.matchMedia("(prefers-color-scheme: light)");if(void 0===n){if(c.matches)a();else if(r.matches)o();else{const e=(new Date).getHours();e<=6||e>=18?o():a()}r.addEventListener("change",()=>{void 0===t.get("theme")&&(e.matches?o():a())})}else"light"===n?a():o();const d=t.get("aside-status");void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script>var _hmt=_hmt||[];!function(){var t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?68629f5da0a0c3347b896920fbf164b5";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(t,a)}(),btf.addGlobalFn("pjaxComplete",()=>{_hmt.push(["_trackPageview",window.location.pathname])},"baidu_analytics")</script><script>!function(t,e,n,c,r,s,a){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(s=e.createElement(c)).async=1,s.src="https://www.clarity.ms/tag/sthrplbt7c",(a=e.getElementsByTagName(c)[0]).parentNode.insertBefore(s,a)}(window,document,"clarity","script")</script><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,top_n_per_article:3,unescape:!1,pagination:{enable:!0,hitsPerPage:8},languages:{hits_empty:"No results found for: ${query}",hits_stats:"${hits} articles found"}},translate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:300,highlightFullpage:!1,highlightMacStyle:!1},copy:{success:"Copy Successful",error:"Copy Failed",noSupport:"Browser Not Supported"},relativeDate:{homepage:!1,post:!1},runtime:"days",dateSuffix:{just:"Just now",min:"minutes ago",hour:"hours ago",day:"days ago",month:"months ago"},copyright:{limitCount:256,languages:{author:"Author: Tony Lewis",link:"Link: ",source:"Source: TONY'S STUDIO",info:"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},lightbox:"fancybox",Snackbar:{chs_to_cht:"You have switched to Traditional Chinese",cht_to_chs:"You have switched to Simplified Chinese",day_to_night:"You have switched to Dark Mode",night_to_day:"You have switched to Light Mode",bgLight:"#871798",bgDark:"#C81025",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js",buttonText:"Load More"},isPhotoFigcaption:!1,islazyloadPlugin:!1,isAnchor:!1,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Using WebSocket in Spring Boot",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><link rel="stylesheet" href="/static/custom.css"><meta name="generator" content="Hexo 8.1.1"></head><body><script>window.paceOptions={restartOnPushState:!1},btf.addGlobalFn("pjaxSend",()=>{Pace.restart()},"pace_restart")</script><link rel="stylesheet" href="/static/barber-shop.css"><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div class="bg-animation" id="web_bg" style="background-image:url(https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/background.png)"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/avatar.png" onerror='this.onerror=null,this.src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/missing.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">99</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">88</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">21</div></a></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-newspaper"></i><span> Posts</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-jedi fa-beat"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/12/05.jpeg)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/logo.svg" alt="Logo"><span class="site-name">TONY'S STUDIO</span></a><a class="nav-page-title" href="/"><span class="site-name">Using WebSocket in Spring Boot</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span> Back to Home</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-newspaper"></i><span> Posts</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-jedi fa-beat"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Using WebSocket in Spring Boot</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-04-20T06:00:46.000Z" title="Created Apr. 20th, 2024 - 14:00:46 14:00:46">Apr. 20th, 2024 - 14:00:46</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-02-21T09:38:33.480Z" title="Updated Feb. 21st, 2026 - 17:38:33 17:38:33">Feb. 21st, 2026 - 17:38:33</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Software-Engineering/">Software Engineering</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Software-Engineering/Web-Development/">Web Development</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">1.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>8mins</span></span><span class="post-meta-separator">|</span><span data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span class="waline-pageview-count" data-path="/posts/Using-WebSocket-in-Spring-Boot/"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">Comments:</span><a href="/posts/Using-WebSocket-in-Spring-Boot/#post-comment"><span class="waline-comment-count" data-path="/posts/Using-WebSocket-in-Spring-Boot/"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><html><head></head><body><p style="text-align:center"><i>‚ÄúDown once more to the dungeon of my black despair!<br><i>Down we plunge to the prison of my mind!</i><br><i>Down that path into darkness deep as hell!‚Äù</i></i></p><i><p style="text-align:right;font-family:var(--font-phantom)">‚Äî THE PHANTOM OF THE OPERA</p><h1 id="Prologue"><a href="#Prologue" class="headerlink" title="Prologue"></a>Prologue</h1><p>WebSocket can be extremely useful for real-time interaction and messaging. Recently, I ran into Spring Boot, but few articles can give a demonstration I want, so that‚Äôs why I‚Äôm writing this.</p><p>Unlike regular <a target="_blank" rel="noopener" href="https://restfulapi.net/">RESTful API</a>, WebSocket can be a little more tricky to use, especially when you want to send message actively from the server. That is to say, the server need to know its clients, instead of making replies when receives new message.</p><p>In this post, I‚Äôm going to show you the basic use of WebSocket by implementing a simple messaging API. When user triggers a RESTful API, we will then send a message via WebSocket. It may seem to be a little strange, but the point is to show how WebSocket can be integrated into other services.</p><div class="note success flat"><p>We‚Äôll working with <a target="_blank" rel="noopener" href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a> Ultimate and <a target="_blank" rel="noopener" href="https://spring.io/">Spring Boot 3.2.5</a>.</p></div><hr><div class="note info flat"><p>All source code can be found at <a target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil/WebSocketDemo">WebSocketDemo</a></p></div><h1 id="1-Basic-WebSocket-in-Spring-Boot"><a href="#1-Basic-WebSocket-in-Spring-Boot" class="headerlink" title="1. Basic WebSocket in Spring Boot"></a>1. Basic WebSocket in Spring Boot</h1><div class="note info flat"><p>Code for this part can be found at <code>basic</code> branch.</p></div><h2 id="1-1-Create-a-new-project"><a href="#1-1-Create-a-new-project" class="headerlink" title="1.1 Create a new project"></a>1.1 Create a new project</h2><p>So first, open IDEA and create a new Spring Boot project.</p><img src="/posts/Using-WebSocket-in-Spring-Boot/image-20240420111135345.png" alt="image-20240420111135345.png" style="zoom:33%"><p>As we‚Äôll only talk about WebSocket, we can select minimum dependencies.</p><img src="/posts/Using-WebSocket-in-Spring-Boot/image-20240420112947518.png" alt="image-20240420112947518" style="zoom:33%"><h2 id="1-2-Configure-WebSocket"><a href="#1-2-Configure-WebSocket" class="headerlink" title="1.2 Configure WebSocket"></a>1.2 Configure WebSocket</h2><p>Spring Boot provides us a simple way to configure WebSocket using <code>WebSocketConfigurer</code>. For a WebSocket, we need an endpoint and a handler. Here, we map our WebSocket to <code>/ws/{username}</code>, so the complete URL would be <code>ws://localhost/ws/{username}</code>. <code>{}</code> means that it is a variable. And you may want to allow all origins to bypass the origin check, or you can specify few origins to restrict the access.</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocket</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketConfig</span> <span class="keyword">implements</span> <span class="title class_">WebSocketConfigurer</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebSocketHandler handler;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebSocketConfig</span><span class="params">(WebSocketHandler handler)</span> {</span><br><span class="line">        <span class="built_in">this</span>.handler = handler;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerWebSocketHandlers</span><span class="params">(WebSocketHandlerRegistry registry)</span> {</span><br><span class="line">        registry.addHandler(handler, <span class="string">"/ws/{username}"</span>)</span><br><span class="line">                .setAllowedOrigins(<span class="string">"*"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>The <code>WebSocketHandler</code> is our custom handler, it will be invoked on all WebSocket events. There are two types of handlers, <code>TextWebSocketHandler</code> and <code>BinaryWebSocketHandler</code>. Usually, we just need to send JSON message using <code>TextWebSocketHandler</code>.</p><h2 id="1-3-WebSocket-Message-Design"><a href="#1-3-WebSocket-Message-Design" class="headerlink" title="1.3 WebSocket Message Design"></a>1.3 WebSocket Message Design</h2><p>Different from RESTful API, WebSocket need some more configurations, so it would be a good choice to send all messages to one WebSocket connection. In this case, you have to assign different types to different messages so that the client can know how to handle them. For example, a good WebSocket message may look like this.</p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"notification"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"data"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"date"</span><span class="punctuation">:</span> <span class="string">"2024-04-20"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"message"</span><span class="punctuation">:</span> <span class="string">"Hello there!"</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><p>The <code>data</code> field may vary depending on its <code>type</code>. So based on this, we can design our <code>WebSocketPayload</code> as follows.</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketPayload</span>&lt;TData&gt; {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ObjectWriter</span> <span class="variable">WRITER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().writer();</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> TData data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebSocketPayload</span><span class="params">(String type, TData data)</span> {</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> WRITER.writeValueAsString(<span class="built_in">this</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (JsonProcessingException e) {</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Invalid WebSocketPayload"</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> TextMessage <span class="title function_">toTextMessage</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TextMessage</span>(toString());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> WebSocketPayload&lt;String&gt; <span class="title function_">message</span><span class="params">(String message)</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebSocketPayload</span>&lt;&gt;(<span class="string">"message"</span>, message);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;TData&gt; WebSocketPayload&lt;TData&gt; <span class="title function_">of</span><span class="params">(String type, TData data)</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebSocketPayload</span>&lt;&gt;(type, data);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Notice that we use <a target="_blank" rel="noopener" href="https://github.com/FasterXML/jackson">Jackson</a> (<code>ObjectWriter</code>) to serialize our Java objects. And eventually, we need to convert it to <code>TextMessage</code>, which is used by <code>TextWebSocketHandler</code>.</p><h2 id="1-4-WebSocket-Handler"><a href="#1-4-WebSocket-Handler" class="headerlink" title="1.4 WebSocket Handler"></a>1.4 WebSocket Handler</h2><p>Now, we can finally reveal the WebSocket handler. Here we just need to extends <code>TextWebSocketHandler</code>, and override several important events.</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketHandler</span> <span class="keyword">extends</span> <span class="title class_">TextWebSocketHandler</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleTextMessage</span><span class="params">(WebSocketSession session, TextMessage message)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">        session.sendMessage(WebSocketPayload.message(<span class="string">"Received: "</span> + message.getPayload()).toTextMessage());</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterConnectionEstablished</span><span class="params">(WebSocketSession session)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> session.getUri();</span><br><span class="line">        <span class="keyword">if</span> (uri == <span class="literal">null</span>) {</span><br><span class="line">            session.close();</span><br><span class="line">            log.error(<span class="string">"Request uri is null!"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="type">int</span> <span class="variable">pos</span> <span class="operator">=</span> uri.toString().lastIndexOf(<span class="string">'/'</span>);</span><br><span class="line">        <span class="keyword">if</span> (pos == -<span class="number">1</span>) {</span><br><span class="line">            session.close();</span><br><span class="line">            log.error(<span class="string">"Invalid uri: {}"</span>, uri);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> uri.toString().substring(pos + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        session.sendMessage(WebSocketPayload.message(<span class="string">"Welcome back, commander "</span> + username + <span class="string">"."</span>).toTextMessage());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterConnectionClosed</span><span class="params">(WebSocketSession session, CloseStatus status)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        log.info(<span class="string">"Connection closed: {} status = {}"</span>, session, status);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleTransportError</span><span class="params">(WebSocketSession webSocketSession, Throwable throwable)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="keyword">if</span> (webSocketSession.isOpen()) {</span><br><span class="line">            webSocketSession.close();</span><br><span class="line">        }</span><br><span class="line">        log.error(<span class="string">"Transport error: {}"</span>, throwable.getMessage());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Each WebSocket connection will have a corresponding <code>WebSocketSession</code>, which is automatically manage by Spring Boot.</p><div class="note success flat"><p>Here, we parse the URI manually, which may not be a good practice. You may search for a better way to do this.üòâ</p></div><h2 id="1-4-Testing"><a href="#1-4-Testing" class="headerlink" title="1.4 Testing"></a>1.4 Testing</h2><p>Now we have everything we need for a basic WebSocket connection, let‚Äôs test it in <a target="_blank" rel="noopener" href="https://www.postman.com/">Postman</a>, and of course, you can use your favorite tool.</p><p>First, launch our application in IDEA. By default, it should be running on port 8080, if not, check the logging. Then in Postman, create a new WebSocket connection, and start your connection! üòÄ</p><img src="/posts/Using-WebSocket-in-Spring-Boot/image-20240420123034929.png" alt="image-20240420123034929" style="zoom:50%"><p>Tada, It works! üéâ</p><hr><h1 id="2-Sending-Message-to-Specific-Users"><a href="#2-Sending-Message-to-Specific-Users" class="headerlink" title="2. Sending Message to Specific Users"></a>2. Sending Message to Specific Users</h1><div class="note info flat"><p>Code for this part is just in the <code>main</code> branch.</p></div><p>In the last section, we implemented the basic WebSocket to send message on receiving. However, in most cases, we just want to send message directly from the server without client action. Searched for <a target="_blank" rel="noopener" href="https://bing.com/">Bing</a>, <a target="_blank" rel="noopener" href="https://google.com/">Google</a> but none of them provides a simple approach to it.</p><p>Here, I‚Äôll provide you a simple way to achieve this, by remembering user‚Äôs session.</p><h2 id="2-1-Session-Service"><a href="#2-1-Session-Service" class="headerlink" title="2.1 Session Service"></a>2.1 Session Service</h2><p>In our WebSocket handler, we use <code>WebSocketSession</code> to send messages to clients. It is managed by Spring Boot, but if we remember them and their corresponding user, we can later use them to send messages directly.</p><p>So to do this, we need a session service to remember the mapping from session to username.</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketSessionService</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;WebSocketSession, String&gt; sessionToUsername = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSession</span><span class="params">(WebSocketSession session, String username)</span> {</span><br><span class="line">        sessionToUsername.put(session, username);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeSession</span><span class="params">(WebSocketSession session)</span> {</span><br><span class="line">        sessionToUsername.remove(session);</span><br><span class="line">    }</span><br><span class="line">                              </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String username, WebSocketPayload&lt;?&gt; payload)</span> {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;WebSocketSession, String&gt; entry : sessionToUsername.entrySet()) {</span><br><span class="line">                <span class="keyword">if</span> (entry.getValue().equals(username)) {</span><br><span class="line">                    entry.getKey().sendMessage(payload.toTextMessage());</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            log.error(<span class="string">"Failed to send message to user: {}"</span>, username, e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Why using session to username, not username to session? That is because, one user may have multiple WebSocket session, e.g. more than one tabs in the browser. Thus we need to send message to all sessions of a user. Of course, you can use username to session set mapping, but it would be a little hard to remove the session that way.</p><h2 id="2-2-Save-WebSocket-Session"><a href="#2-2-Save-WebSocket-Session" class="headerlink" title="2.2 Save WebSocket Session"></a>2.2 Save WebSocket Session</h2><p>Now that we have the session service, we can save the relation in our handler. Following is what you need to add in the handler.</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketHandler</span> <span class="keyword">extends</span> <span class="title class_">TextWebSocketHandler</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebSocketSessionService sessionService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebSocketHandler</span><span class="params">(WebSocketSessionService sessionService)</span> {</span><br><span class="line">        <span class="built_in">this</span>.sessionService = sessionService;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterConnectionEstablished</span><span class="params">(WebSocketSession session)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        sessionService.addSession(session, username);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterConnectionClosed</span><span class="params">(WebSocketSession session, CloseStatus status)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        sessionService.removeSession(session);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleTransportError</span><span class="params">(WebSocketSession webSocketSession, Throwable throwable)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        sessionService.removeSession(webSocketSession);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><div class="note info flat"><p>By the way, constructor injection is a better practice than using <code>@AutoWired</code>.</p></div><h2 id="2-3-Send-WebSocket-Message-Anywhere"><a href="#2-3-Send-WebSocket-Message-Anywhere" class="headerlink" title="2.3 Send WebSocket Message Anywhere"></a>2.3 Send WebSocket Message Anywhere</h2><p>Finally, we can send message to any user, any where we want, as long as you have <code>WebSocketSessionService</code> injected and a target username. Here let‚Äôs demonstrate this using a controller.</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/api")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketController</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebSocketSessionService sessionService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebSocketController</span><span class="params">(WebSocketSessionService sessionService)</span> {</span><br><span class="line">        <span class="built_in">this</span>.sessionService = sessionService;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping("/send/{username}")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">send</span><span class="params">(<span class="meta">@PathVariable</span> String username)</span> {</span><br><span class="line">        sessionService.sendMessage(username, WebSocketPayload.message(<span class="string">"Hello, "</span> + username + <span class="string">"!"</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"WebSocket message sent."</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Now, when user send a request to <code>/api/send/{username}</code>, we will respond with a WebSocket message.</p><h2 id="2-4-Testing"><a href="#2-4-Testing" class="headerlink" title="2.4 Testing"></a>2.4 Testing</h2><p>So first, connect to the WebSocket in Postman. To simulate multiple connection, we can duplicate the WebSocket and open two tabs.</p><img src="/posts/Using-WebSocket-in-Spring-Boot/image-20240420131332428.png" alt="image-20240420131332428" style="zoom:50%"><p>Then, we can trigger the REST API.</p><img src="/posts/Using-WebSocket-in-Spring-Boot/image-20240420131547009.png" alt="image-20240420131547009" style="zoom:50%"><div class="note info flat"><p>Little trick, you can use <code>:param</code> to declare path variables in Postman.</p></div><p>And as we expected, both connection received the message. üòÄ</p><img src="/posts/Using-WebSocket-in-Spring-Boot/image-20240420131740454.png" alt="image-20240420131740454" style="zoom:50%"><hr><h1 id="3-Troubleshoot"><a href="#3-Troubleshoot" class="headerlink" title="3. Troubleshoot"></a>3. Troubleshoot</h1><p>If you are a careful programmer, you may notice some warnings prompted by IDEA. It doesn‚Äôt matter, but it‚Äôs just annoyed to see the highlighting.</p><img src="/posts/Using-WebSocket-in-Spring-Boot/image-20240420123519286.png" alt="image-20240420123519286" style="zoom:50%"><p>To solve this warning, create a <code>package-info.java</code>, and add <code>@NonNullApi</code> annotation to it.</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNullApi</span></span><br><span class="line"><span class="keyword">package</span> top.tony.wsdemo.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.lang.NonNullApi;</span><br></pre></td></tr></tbody></table></figure><hr><h1 id="Epilogue"><a href="#Epilogue" class="headerlink" title="Epilogue"></a>Epilogue</h1><p>To be honest, I don‚Äôt really like Java. The syntax, naming convention, duh. Not like my lovely C#, let alone my favorite C++. But, Spring Boot is indeed, a good Web framework. Perhaps not good as ASP.NET Core. Anyway, it is all about WebSocket in Spring Boot, and good luck, have fun. ·ìö·òè·ó¢</p></i></body></html></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://www.tonys-studio.top">Tony Lewis</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.tonys-studio.top/posts/Using-WebSocket-in-Spring-Boot/">https://blog.tonys-studio.top/posts/Using-WebSocket-in-Spring-Boot/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Spring-Boot/">Spring Boot</a><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/Repo-Available/">Repo Available</a><a class="post-meta__tags" href="/tags/WebSocket/">WebSocket</a></div><div class="post-share"><div class="addtoany"><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_button_wechat"></a><a class="a2a_button_qzone"></a><a class="a2a_button_sina_weibo"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_email"></a><a class="a2a_button_copy_link"></a><a class="a2a_dd" target="_blank" rel="noopener" href="https://www.addtoany.com/share"></a></div></div><script async src="https://static.addtoany.com/menu/page.js"></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/Getting-Started-with-CUDA/" title="Getting Started With CUDA"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/11/03.jpeg" onerror='onerror=null,src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Getting Started With CUDA</div></div><div class="info-2"><div class="info-item-1">Take your first step into CUDA&reg; to unleash the power of your GPU!</div></div></div></a><a class="pagination-related" href="/posts/Linux-Cheat-Sheet/" title="Linux Cheat Sheet"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/06/13.jpeg" onerror='onerror=null,src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Linux Cheat Sheet</div></div><div class="info-2"><div class="info-item-1">Collection of useful Linux commands</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/AOP-in-Spring-Boot/" title="AOP in Spring Boot"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/06/01.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Jul. 12th, 2024 - 11:26:45</div><div class="info-item-2">AOP in Spring Boot</div></div><div class="info-2"><div class="info-item-1">Concept and application of Aspect-oriented programming in Spring Boot</div></div></div></a><a class="pagination-related" href="/posts/Using-RabbitMQ-in-Spring-Boot-Application/" title="Using RabbitMQ in Spring Boot Application"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/22/11.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Jul. 1st, 2024 - 22:08:59</div><div class="info-item-2">Using RabbitMQ in Spring Boot Application</div></div><div class="info-2"><div class="info-item-1">Basic use of RabbitMQ in Spring Boot</div></div></div></a><a class="pagination-related" href="/posts/Game-Engine-0-to-1-03-What-Fonts-Do-I-have-A-Cross-Platform-Solution/" title="Game Engine 0 to 1 (03): What Fonts Do I Have? a Cross-Platform Solution"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/02/03.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Oct. 20th, 2025 - 20:59:54</div><div class="info-item-2">Game Engine 0 to 1 (03): What Fonts Do I Have? a Cross-Platform Solution</div></div><div class="info-2"><div class="info-item-1">Game Engine Series 03: Fonts and cross-platform issues</div></div></div></a><a class="pagination-related" href="/posts/Modern-C-Project-with-CMake/" title="Modern C++ Project With CMake"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/02/01.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Dec. 24th, 2024 - 16:12:08</div><div class="info-item-2">Modern C++ Project With CMake</div></div><div class="info-2"><div class="info-item-1">Build modern C++ project with CMake</div></div></div></a><a class="pagination-related" href="/posts/Game-Engine-0-to-1-01-It-Starts-Now/" title="Game Engine 0 to 1 (01): It Starts Now"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/01/02.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Jun. 1st, 2025 - 14:45:32</div><div class="info-item-2">Game Engine 0 to 1 (01): It Starts Now</div></div><div class="info-2"><div class="info-item-1">Game Engine Series 01: Project setup</div></div></div></a><a class="pagination-related" href="/posts/MinIoC-A-Miniature-IoC-Container-in-C/" title="MinIoC: A Miniature IoC Container in C++"><img class="cover" src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/03/07.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> Oct. 6th, 2023 - 13:36:02</div><div class="info-item-2">MinIoC: A Miniature IoC Container in C++</div></div><div class="info-2"><div class="info-item-1">MinIoC is a lightweight IoC container for C++ 11 and later</div></div></div></a></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/avatar.png" onerror='this.onerror=null,this.src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/missing.gif"' alt="avatar"></div><div class="author-info-name">Tony Lewis</div><div class="author-info-description">Do or do not. There is no try.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">99</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">88</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">21</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Lord-Turmoil"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Lord-Turmoil" target="_blank" title="Github"><i class="fa-brands fa-github"></i></a><a class="social-icon" href="mailto:swift-phantom@outlook.com" target="_blank" title="Email"><i class="fa-solid fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/2030942344" target="_blank" title="BiliBili"><i class="fa-brands fa-bilibili"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Hello there!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Prologue"><span class="toc-text">Prologue</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Basic-WebSocket-in-Spring-Boot"><span class="toc-text">1. Basic WebSocket in Spring Boot</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-Create-a-new-project"><span class="toc-text">1.1 Create a new project</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-Configure-WebSocket"><span class="toc-text">1.2 Configure WebSocket</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-WebSocket-Message-Design"><span class="toc-text">1.3 WebSocket Message Design</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-WebSocket-Handler"><span class="toc-text">1.4 WebSocket Handler</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-Testing"><span class="toc-text">1.4 Testing</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Sending-Message-to-Specific-Users"><span class="toc-text">2. Sending Message to Specific Users</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-Session-Service"><span class="toc-text">2.1 Session Service</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-Save-WebSocket-Session"><span class="toc-text">2.2 Save WebSocket Session</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-Send-WebSocket-Message-Anywhere"><span class="toc-text">2.3 Send WebSocket Message Anywhere</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-Testing"><span class="toc-text">2.4 Testing</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Troubleshoot"><span class="toc-text">3. Troubleshoot</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Epilogue"><span class="toc-text">Epilogue</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/Advanced-C-Workshop-2023-02/" title="Advanced C++ Workshop 2023 (02)"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/posts/CSCS.jpg" onerror='this.onerror=null,this.src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png"' alt="Advanced C++ Workshop 2023 (02)"></a><div class="content"><a class="title" href="/posts/Advanced-C-Workshop-2023-02/" title="Advanced C++ Workshop 2023 (02)">Advanced C++ Workshop 2023 (02)</a><time datetime="2026-02-21T09:38:11.000Z" title="Created Feb. 21st, 2026 - 17:38:11 17:38:11">Feb. 21st, 2026 - 17:38:11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Advanced-C-Workshop-2023-01/" title="Advanced C++ Workshop 2023 (01)"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/posts/CSCS.jpg" onerror='this.onerror=null,this.src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png"' alt="Advanced C++ Workshop 2023 (01)"></a><div class="content"><a class="title" href="/posts/Advanced-C-Workshop-2023-01/" title="Advanced C++ Workshop 2023 (01)">Advanced C++ Workshop 2023 (01)</a><time datetime="2026-02-21T09:38:04.000Z" title="Created Feb. 21st, 2026 - 17:38:04 17:38:04">Feb. 21st, 2026 - 17:38:04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Symbolic-Execution-with-KLEE/" title="Symbolic Execution With KLEE"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/13/04.jpeg" onerror='this.onerror=null,this.src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png"' alt="Symbolic Execution With KLEE"></a><div class="content"><a class="title" href="/posts/Symbolic-Execution-with-KLEE/" title="Symbolic Execution With KLEE">Symbolic Execution With KLEE</a><time datetime="2025-11-28T09:39:23.000Z" title="Created Nov. 28th, 2025 - 17:39:23 17:39:23">Nov. 28th, 2025 - 17:39:23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Game-Engine-0-to-1-03-What-Fonts-Do-I-have-A-Cross-Platform-Solution/" title="Game Engine 0 to 1 (03): What Fonts Do I Have? a Cross-Platform Solution"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/boba/02/03.jpeg" onerror='this.onerror=null,this.src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png"' alt="Game Engine 0 to 1 (03): What Fonts Do I Have? a Cross-Platform Solution"></a><div class="content"><a class="title" href="/posts/Game-Engine-0-to-1-03-What-Fonts-Do-I-have-A-Cross-Platform-Solution/" title="Game Engine 0 to 1 (03): What Fonts Do I Have? a Cross-Platform Solution">Game Engine 0 to 1 (03): What Fonts Do I Have? a Cross-Platform Solution</a><time datetime="2025-10-20T12:59:54.000Z" title="Created Oct. 20th, 2025 - 20:59:54 20:59:54">Oct. 20th, 2025 - 20:59:54</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/A-Fancy-And-Practical-Zsh-Configuration/" title="A Fancy and Practical Zsh Configuration"><img src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/24/03.jpeg" onerror='this.onerror=null,this.src="https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/404.png"' alt="A Fancy and Practical Zsh Configuration"></a><div class="content"><a class="title" href="/posts/A-Fancy-And-Practical-Zsh-Configuration/" title="A Fancy and Practical Zsh Configuration">A Fancy and Practical Zsh Configuration</a><time datetime="2025-09-26T14:15:54.000Z" title="Created Sep. 26th, 2025 - 22:15:54 22:15:54">Sep. 26th, 2025 - 22:15:54</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(https://tonys-studio-1308383348.cos.ap-beijing.myqcloud.com/blog/static/cover/mando/12/05.jpeg)"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By Tony Lewis</span></div><div class="footer_custom_text">No bird soars too high if he soars on his own wings</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(()=>{const e=e=>{const t=(e=>{if(!e)return null;const t=e.trim().split(/[\s,]+/).map(e=>Number(e));return 4!==t.length||t.some(e=>Number.isNaN(e))?null:t})(e.getAttribute("viewBox"));if(t)return t;try{const t=e.getBBox();if(t&&t.width&&t.height)return[t.x,t.y,t.width,t.height]}catch(e){}const n=Number(e.getAttribute("width"))||0,i=Number(e.getAttribute("height"))||0;return n>0&&i>0?[0,0,n,i]:[0,0,100,100]},t=(e,t)=>{e.setAttribute("viewBox",`${t[0]} ${t[1]} ${t[2]} ${t[3]}`)},n=(e,t,n)=>Math.max(t,Math.min(n,e)),i=({source:e,initViewBox:t})=>{const n=(()=>{if("string"==typeof e){const t=document.createElement("template");t.innerHTML=e.trim();const n=t.content.querySelector("svg");return n?n.cloneNode(!0):null}return e&&"function"==typeof e.cloneNode?e.cloneNode(!0):null})();if(!n)return;t&&4===t.length&&n.setAttribute("viewBox",t.join(" ")),n.getAttribute("xmlns")||n.setAttribute("xmlns","http://www.w3.org/2000/svg"),!n.getAttribute("xmlns:xlink")&&n.outerHTML.includes("xlink:")&&n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");const i="dark"===document.documentElement.getAttribute("data-theme"),r=getComputedStyle(document.body).backgroundColor||(i?"#1e1e1e":"#ffffff");n.style.background||(n.style.background=r);const o=(new XMLSerializer).serializeToString(n),s=new Blob([`<!doctype html><html><head><meta charset="utf-8" />\n      <style>\n        html, body { width: 100%; height: 100%; margin: 0; display: flex; align-items: center; justify-content: center; background: ${r}; }\n        svg { max-width: 100%; max-height: 100%; height: auto; width: auto; }\n      </style>\n      </head><body>${o}</body></html>`],{type:"text/html;charset=utf-8"}),a=URL.createObjectURL(s);window.open(a,"_blank","noopener"),setTimeout(()=>URL.revokeObjectURL(a),3e4)},r=(e,t,n,i)=>{const r=e[2]*t,o=e[3]*t;return[n-(n-e[0])*t,i-(i-e[1])*t,r,o]},o=i=>{const o=i.querySelector("svg");if(!o)return;const s=e(o);if(i.__mermaidInitViewBox=s,i.__mermaidCurViewBox=s.slice(),t(o,s),i.__mermaidGestureBound)return;i.__mermaidGestureBound=!0;const a=(t,n)=>{const r=o.getBoundingClientRect(),s=i.__mermaidCurViewBox||e(o);return{x:s[0]+(t-r.left)*(s[2]/r.width),y:s[1]+(n-r.top)*(s[3]/r.height),rect:r,vb:s}},d={pointers:new Map,startVb:null,startDist:0,startCenter:null},m=e=>{e=(e=>{const t=i.__mermaidInitViewBox||e,r=.1*t[2],o=10*t[2],s=.1*t[3],a=10*t[3];return e[2]=n(e[2],r,o),e[3]=n(e[3],s,a),e})(e),i.__mermaidCurViewBox=e,t(o,e)},l=e=>{d.pointers.delete(e.pointerId),0===d.pointers.size?(d.startVb=null,d.startDist=0,d.startCenter=null,i.__mermaidLastSinglePointer=null):1===d.pointers.size&&(i.__mermaidLastSinglePointer=[...d.pointers.values()][0])};o.addEventListener("pointerdown",t=>{if("mouse"!==t.pointerType||0===t.button)if(o.setPointerCapture(t.pointerId),d.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY}),1===d.pointers.size)d.startVb=(i.__mermaidCurViewBox||e(o)).slice();else if(2===d.pointers.size){const t=[...d.pointers.values()],n=t[0].x-t[1].x,r=t[0].y-t[1].y;d.startDist=Math.hypot(n,r),d.startVb=(i.__mermaidCurViewBox||e(o)).slice(),d.startCenter={x:(t[0].x+t[1].x)/2,y:(t[0].y+t[1].y)/2}}}),o.addEventListener("pointermove",t=>{if(d.pointers.has(t.pointerId))if(d.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY}),1===d.pointers.size&&d.startVb){const n=[...d.pointers.values()][0],r=(t.clientX,t.movementX,t.clientY,t.movementY,i.__mermaidLastSinglePointer||n),s=n.x-r.x,l=n.y-r.y;i.__mermaidLastSinglePointer=n;const{rect:c}=a(n.x,n.y),u=(i.__mermaidCurViewBox||e(o)).slice(),p=s*(u[2]/c.width),h=l*(u[3]/c.height);m([u[0]-p,u[1]-h,u[2],u[3]])}else if(2===d.pointers.size&&d.startVb&&d.startDist>0){const e=[...d.pointers.values()],t=e[0].x-e[1].x,n=e[0].y-e[1].y,i=Math.hypot(t,n);if(!i)return;const o=d.startDist/i,s={x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2},l=a(s.x,s.y),c=l.x,u=l.y,p=r(d.startVb,o,c,u);m(p)}}),o.addEventListener("pointerup",l),o.addEventListener("pointercancel",l),o.addEventListener("wheel",t=>{t.preventDefault();const n=t.deltaY>0?1.1:.9,{x:s,y:d}=a(t.clientX,t.clientY),l=(i.__mermaidCurViewBox||e(o)).slice();m(r(l,n,s,d))},{passive:!1}),o.addEventListener("dblclick",()=>{const e=i.__mermaidInitViewBox;e&&(i.__mermaidCurViewBox=e.slice(),t(o,e))})},s=e=>{window.loadMermaid=!0;const t="dark"===document.documentElement.getAttribute("data-theme")?"dark":"forest";e.forEach((e,n)=>{const r=e.firstElementChild,s=e.querySelector("svg");s&&s.remove(),e.__mermaidGestureBound=!1;const a=r.dataset.config?JSON.parse(r.dataset.config):{};a.theme||(a.theme=t);const d="mermaid-"+n,m=`%%{init: ${JSON.stringify(a)}}%%\n`+r.textContent,l=mermaid.render(d,m),c=t=>{r.insertAdjacentHTML("afterend",t),o(e),e.__mermaidOriginalSvg=t,(e=>{let t=e.querySelector(".mermaid-open-btn");t||(t=document.createElement("button"),t.type="button",t.className="mermaid-open-btn",e.appendChild(t)),t.innerHTML='<i class="fa fa-search fa-fw" aria-hidden="true"></i>',t.__mermaidViewerBound||(t.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation();const n=e.__mermaidOriginalSvg||e.querySelector("svg");if(!n)return;const r=e.__mermaidInitViewBox;i({source:n,initViewBox:r})}),t.__mermaidViewerBound=!0)})(e)};"string"==typeof l?c(l):l.then(({svg:e})=>c(e))})},a=()=>{const e=document.querySelectorAll("#article-container .mermaid-wrap");if(0===e.length)return;const t=()=>s(e);btf.addGlobalFn("themeChange",t,"mermaid"),window.loadMermaid?t():btf.getScript("https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js").then(t)};btf.addGlobalFn("encrypt",a,"mermaid"),window.pjax?a():document.addEventListener("DOMContentLoaded",a)})()</script><script>(()=>{let n=window.walineFn||null;const e="shuoshuo"===GLOBAL_CONFIG_SITE.pageType,t=(n,t=document,i=window.location.pathname)=>{const o=n({el:t.querySelector("#waline-wrap"),serverURL:"https://comment.tonys-studio.top",pageview:!0,dark:'html[data-theme="dark"]',comment:!0,path:i});e&&(window.shuoshuoComment.destroyWaline=()=>{o.destroy(),t.children.length&&(t.innerHTML="",t.classList.add("no-comment"))})},i=(e,i)=>{n?t(n,e,i):btf.getCSS("https://cdn.jsdelivr.net/npm/@waline/client@2/dist/waline.min.css").then(()=>import("https://cdn.jsdelivr.net/npm/@waline/client@2/dist/waline.min.js")).then(({init:o})=>{n=o||Waline.init,t(n,e,i),window.walineFn=n})};e?window.shuoshuoComment={loadComment:i}:setTimeout(i,0)})()</script></div><script src="/static/custom.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> Loading Database</span></div><div class="local-search-input"><input placeholder="Looking for something?üîç" type="text"></div><hr><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>